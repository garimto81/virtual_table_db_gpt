<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ - ì½˜ì†” ë²„ì „</title>
</head>
<body>
    <h1>ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘... (ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”)</h1>
    <p>F12ë¥¼ ëˆŒëŸ¬ ê°œë°œì ë„êµ¬ë¥¼ ì—´ê³  Console íƒ­ì„ í™•ì¸í•˜ì„¸ìš”.</p>

    <!-- ëª¨ë“ˆ ë¡œë“œ -->
    <script src="src/modules/filename-manager.js"></script>
    <script src="src/modules/ai-analyzer.js"></script>
    <script src="src/modules/filename-adapter.js"></script>

    <script>
        console.log('========================================');
        console.log('ğŸ§ª Virtual Table DB ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ ì‹œì‘');
        console.log('========================================');

        // í…ŒìŠ¤íŠ¸ 1: ëª¨ë“ˆ ë¡œë“œ í™•ì¸
        console.group('ğŸ“¦ TEST 1: ëª¨ë“ˆ ë¡œë“œ í™•ì¸');

        if (window.FilenameManager) {
            console.log('âœ… FilenameManager ë¡œë“œ ì„±ê³µ');
            console.log('   - generateFilename í•¨ìˆ˜:', typeof window.FilenameManager.generateFilename);
            console.log('   - extractHandNumber í•¨ìˆ˜:', typeof window.FilenameManager.extractHandNumber);
            console.log('   - Map í¬ê¸°:', window.FilenameManager.handToFilename.size);
        } else {
            console.error('âŒ FilenameManager ë¡œë“œ ì‹¤íŒ¨');
        }

        if (window.AIAnalyzer) {
            console.log('âœ… AIAnalyzer ë¡œë“œ ì„±ê³µ');
            console.log('   - analyzeHand í•¨ìˆ˜:', typeof window.AIAnalyzer.analyzeHand);
            console.log('   - generateFileSummary í•¨ìˆ˜:', typeof window.AIAnalyzer.generateFileSummary);
            console.log('   - ìºì‹œ í¬ê¸°:', window.AIAnalyzer.analysisCache.size);
        } else {
            console.error('âŒ AIAnalyzer ë¡œë“œ ì‹¤íŒ¨');
        }

        if (window.generateCustomFilename && window.extractHandNumberFromFilename) {
            console.log('âœ… í˜¸í™˜ì„± ì–´ëŒ‘í„° ë¡œë“œ ì„±ê³µ');
            console.log('   - generateCustomFilename:', typeof window.generateCustomFilename);
            console.log('   - extractHandNumberFromFilename:', typeof window.extractHandNumberFromFilename);
        } else {
            console.error('âŒ í˜¸í™˜ì„± ì–´ëŒ‘í„° ë¡œë“œ ì‹¤íŒ¨');
        }
        console.groupEnd();

        // í…ŒìŠ¤íŠ¸ 2: íŒŒì¼ëª… ìƒì„± í…ŒìŠ¤íŠ¸
        console.group('ğŸ“ TEST 2: íŒŒì¼ëª… ìƒì„± í…ŒìŠ¤íŠ¸');

        async function testFilenameGeneration() {
            const testCases = [142, 999, 1, 50000];

            for (const handNumber of testCases) {
                const startTime = performance.now();
                const filename = await window.FilenameManager.generateFilename(handNumber);
                const endTime = performance.now();

                console.log(`âœ… í•¸ë“œ #${handNumber}:`);
                console.log(`   ìƒì„±ëœ íŒŒì¼ëª…: "${filename}"`);
                console.log(`   ì†Œìš” ì‹œê°„: ${(endTime - startTime).toFixed(3)}ms`);

                // ë§¤í•‘ ì €ì¥ í™•ì¸
                const mapped = window.FilenameManager.handToFilename.get(handNumber);
                if (mapped) {
                    console.log(`   âœ… Map ì €ì¥ í™•ì¸: ${mapped}`);
                } else {
                    console.warn(`   âš ï¸ Map ì €ì¥ ì‹¤íŒ¨`);
                }
            }
        }

        // í…ŒìŠ¤íŠ¸ 3: í•¸ë“œë²ˆí˜¸ ì¶”ì¶œ í…ŒìŠ¤íŠ¸
        console.groupEnd();
        console.group('ğŸ” TEST 3: í•¸ë“œë²ˆí˜¸ ì¶”ì¶œ í…ŒìŠ¤íŠ¸');

        function testHandExtraction() {
            const testCases = [
                { filename: 'VT142_BTN_3bet_win', expected: 142 },
                { filename: 'H999_allin_fold', expected: 999 },
                { filename: '888_simple_hand', expected: 888 },
                { filename: 'T777_test', expected: 777 },
                { filename: 'invalid_name', expected: null }
            ];

            for (const test of testCases) {
                const startTime = performance.now();
                const result = window.FilenameManager.extractHandNumber(test.filename);
                const endTime = performance.now();

                if (result === test.expected) {
                    console.log(`âœ… "${test.filename}"`);
                    console.log(`   ì¶”ì¶œëœ í•¸ë“œë²ˆí˜¸: ${result}`);
                    console.log(`   ì†Œìš” ì‹œê°„: ${(endTime - startTime).toFixed(3)}ms`);
                } else {
                    console.error(`âŒ "${test.filename}"`);
                    console.error(`   ì˜ˆìƒ: ${test.expected}, ì‹¤ì œ: ${result}`);
                }
            }
        }

        // í…ŒìŠ¤íŠ¸ 4: Map ê¸°ë°˜ O(1) ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        console.groupEnd();
        console.group('âš¡ TEST 4: Map ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬');

        async function testMapPerformance() {
            // 1000ê°œ íŒŒì¼ëª… ìƒì„± (ìºì‹œ ì±„ìš°ê¸°)
            console.log('ğŸ“Š 1000ê°œ í•¸ë“œ íŒŒì¼ëª… ìƒì„± ì¤‘...');
            const genStart = performance.now();
            for (let i = 1; i <= 1000; i++) {
                await window.FilenameManager.generateFilename(i);
            }
            const genEnd = performance.now();
            console.log(`âœ… ìƒì„± ì™„ë£Œ: ${(genEnd - genStart).toFixed(2)}ms`);
            console.log(`   Map í¬ê¸°: ${window.FilenameManager.handToFilename.size}`);

            // Map ì¡°íšŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (10000íšŒ)
            console.log('\nğŸ“Š Map ì¡°íšŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (10000íšŒ)...');
            const lookupStart = performance.now();
            for (let i = 0; i < 10000; i++) {
                const handNum = Math.floor(Math.random() * 1000) + 1;
                window.FilenameManager.handToFilename.get(handNum);
            }
            const lookupEnd = performance.now();
            const avgLookup = (lookupEnd - lookupStart) / 10000;

            console.log(`âœ… ì¡°íšŒ ì™„ë£Œ: ${(lookupEnd - lookupStart).toFixed(2)}ms`);
            console.log(`   í‰ê·  ì¡°íšŒ ì‹œê°„: ${avgLookup.toFixed(4)}ms`);

            if (avgLookup < 0.01) {
                console.log('   ğŸ¯ O(1) ì„±ëŠ¥ í™•ì¸! (< 0.01ms)');
            } else {
                console.warn('   âš ï¸ ì„±ëŠ¥ ìµœì í™” í•„ìš”');
            }
        }

        // í…ŒìŠ¤íŠ¸ 5: í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸
        console.groupEnd();
        console.group('ğŸ”„ TEST 5: ë ˆê±°ì‹œ í•¨ìˆ˜ í˜¸í™˜ì„±');

        async function testCompatibility() {
            // ë ˆê±°ì‹œ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
            console.log('ğŸ“Š ë ˆê±°ì‹œ í•¨ìˆ˜ í˜¸ì¶œ í…ŒìŠ¤íŠ¸...');

            try {
                // generateCustomFilename í…ŒìŠ¤íŠ¸
                const filename = await window.generateCustomFilename(555);
                console.log(`âœ… generateCustomFilename(555): "${filename}"`);

                // extractHandNumberFromFilename í…ŒìŠ¤íŠ¸
                const handNum = window.extractHandNumberFromFilename('VT666_test');
                console.log(`âœ… extractHandNumberFromFilename('VT666_test'): ${handNum}`);

                // analyzeHandWithAI í…ŒìŠ¤íŠ¸
                if (window.analyzeHandWithAI) {
                    console.log('âœ… analyzeHandWithAI í•¨ìˆ˜ ì¡´ì¬');
                }

                // generateAIFileSummary í…ŒìŠ¤íŠ¸
                if (window.generateAIFileSummary) {
                    console.log('âœ… generateAIFileSummary í•¨ìˆ˜ ì¡´ì¬');
                }

                console.log('ğŸ‰ ëª¨ë“  ë ˆê±°ì‹œ í•¨ìˆ˜ í˜¸í™˜ì„± í™•ì¸!');
            } catch (error) {
                console.error('âŒ í˜¸í™˜ì„± ì˜¤ë¥˜:', error);
            }
        }

        // ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runAllTests() {
            console.log('\nğŸš€ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...\n');

            await testFilenameGeneration();
            console.groupEnd();

            console.group('ğŸ” TEST 3: í•¸ë“œë²ˆí˜¸ ì¶”ì¶œ í…ŒìŠ¤íŠ¸');
            testHandExtraction();
            console.groupEnd();

            console.group('âš¡ TEST 4: Map ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬');
            await testMapPerformance();
            console.groupEnd();

            console.group('ğŸ”„ TEST 5: ë ˆê±°ì‹œ í•¨ìˆ˜ í˜¸í™˜ì„±');
            await testCompatibility();
            console.groupEnd();

            // ìµœì¢… ìš”ì•½
            console.log('\n========================================');
            console.log('ğŸ“Š í…ŒìŠ¤íŠ¸ ì™„ë£Œ ìš”ì•½');
            console.log('========================================');
            console.log(`âœ… FilenameManager Map í¬ê¸°: ${window.FilenameManager.handToFilename.size}`);
            console.log(`âœ… ì–‘ë°©í–¥ ë§¤í•‘ í¬ê¸°: ${window.FilenameManager.filenameToHand.size}`);
            console.log(`âœ… AI ìºì‹œ í¬ê¸°: ${window.AIAnalyzer.analysisCache.size}`);
            console.log('âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
            console.log('========================================');
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Day 1 í…ŒìŠ¤íŠ¸ ì‹¤í–‰ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .test-pass { color: #10b981; }
    .test-fail { color: #ef4444; }
    .test-skip { color: #eab308; }
    pre {
      background: rgba(30, 41, 59, 0.5);
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
    }
  </style>
</head>
<body class="min-h-screen p-8">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">ğŸ§ª Virtual Table DB - Day 1 í…ŒìŠ¤íŠ¸ ì‹¤í–‰ê¸°</h1>

    <!-- ì œì–´ íŒ¨ë„ -->
    <div class="bg-slate-800 rounded-lg p-6 mb-8">
      <h2 class="text-xl font-bold mb-4">í…ŒìŠ¤íŠ¸ ì œì–´íŒ</h2>
      <div class="flex gap-4 mb-4">
        <button onclick="runPerformanceTests()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">
          ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„° í…ŒìŠ¤íŠ¸
        </button>
        <button onclick="runBaselineCollection()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded">
          ğŸ“ˆ ê¸°ì¤€ì„  ë°ì´í„° ìˆ˜ì§‘
        </button>
        <button onclick="runFullDay1Tests()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded">
          ğŸš€ ì „ì²´ Day 1 í…ŒìŠ¤íŠ¸
        </button>
        <button onclick="clearResults()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded">
          ğŸ—‘ï¸ ê²°ê³¼ ì´ˆê¸°í™”
        </button>
      </div>
      <div class="text-sm text-gray-400">
        í˜„ì¬ ì‹œê°„: <span id="current-time"></span>
      </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- ì™¼ìª½: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë¡œê·¸ -->
      <div class="bg-slate-800 rounded-lg p-6">
        <h2 class="text-xl font-bold mb-4">í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë¡œê·¸</h2>
        <div id="test-log" class="space-y-2 max-h-96 overflow-y-auto">
          <div class="text-gray-400">í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½: ì„±ëŠ¥ ë©”íŠ¸ë¦­ -->
      <div class="bg-slate-800 rounded-lg p-6">
        <h2 class="text-xl font-bold mb-4">ì„±ëŠ¥ ë©”íŠ¸ë¦­</h2>
        <div id="performance-metrics" class="space-y-3">
          <div class="flex justify-between">
            <span>API í˜¸ì¶œ ìˆ˜:</span>
            <span id="api-calls">-</span>
          </div>
          <div class="flex justify-between">
            <span>í‰ê·  ì‘ë‹µ ì‹œê°„:</span>
            <span id="avg-response">-</span>
          </div>
          <div class="flex justify-between">
            <span>ë°ì´í„° ì „ì†¡ëŸ‰:</span>
            <span id="data-transfer">-</span>
          </div>
          <div class="flex justify-between">
            <span>ì—ëŸ¬ìœ¨:</span>
            <span id="error-rate">-</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ìƒì„¸ ê²°ê³¼ -->
    <div class="bg-slate-800 rounded-lg p-6 mt-8">
      <h2 class="text-xl font-bold mb-4">ìƒì„¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
      <pre id="detailed-results">í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
    </div>

    <!-- ì¬ì‘ì—… í•„ìš” í•­ëª© -->
    <div class="bg-slate-800 rounded-lg p-6 mt-8">
      <h2 class="text-xl font-bold mb-4">ğŸ“ ì¬ì‘ì—… í•„ìš” í•­ëª©</h2>
      <div id="rework-items" class="space-y-2">
        <div class="text-gray-400">í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ ì¬ì‘ì—… í•­ëª©ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
      </div>
    </div>
  </div>

  <script src="performance_monitor.js"></script>
  <script src="test_automation.js"></script>
  <script>
    // í˜„ì¬ ì‹œê°„ í‘œì‹œ
    function updateTime() {
      document.getElementById('current-time').textContent = new Date().toLocaleString('ko-KR');
    }
    setInterval(updateTime, 1000);
    updateTime();

    // ë¡œê·¸ ì¶”ê°€ í•¨ìˆ˜
    function addLog(message, type = 'info') {
      const logDiv = document.getElementById('test-log');
      const entry = document.createElement('div');

      let icon = 'ğŸ“';
      let colorClass = 'text-gray-300';

      if (type === 'success') {
        icon = 'âœ…';
        colorClass = 'test-pass';
      } else if (type === 'error') {
        icon = 'âŒ';
        colorClass = 'test-fail';
      } else if (type === 'warning') {
        icon = 'âš ï¸';
        colorClass = 'test-skip';
      }

      entry.className = colorClass;
      entry.innerHTML = `${icon} ${new Date().toLocaleTimeString('ko-KR')} - ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // ì„±ëŠ¥ ëª¨ë‹ˆí„° í…ŒìŠ¤íŠ¸
    async function runPerformanceTests() {
      addLog('ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

      try {
        // ì„±ëŠ¥ ëª¨ë‹ˆí„° ì´ˆê¸°í™”
        const monitor = new PerformanceMonitor();
        addLog('ì„±ëŠ¥ ëª¨ë‹ˆí„° ì´ˆê¸°í™” ì™„ë£Œ', 'success');

        // API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
        for (let i = 0; i < 5; i++) {
          monitor.trackApiCall('fullData', 100 + Math.random() * 400, 45000);
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        addLog('API í˜¸ì¶œ ì¶”ì  í…ŒìŠ¤íŠ¸ ì™„ë£Œ (5íšŒ)', 'success');

        // ë¦¬í¬íŠ¸ ìƒì„±
        const report = monitor.generateReport();

        // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
        document.getElementById('api-calls').textContent = report.summary.totalApiCalls;
        document.getElementById('avg-response').textContent = report.summary.averageLatency;
        document.getElementById('data-transfer').textContent = report.summary.totalDataTransfer;
        document.getElementById('error-rate').textContent = report.summary.errorRate;

        // ìƒì„¸ ê²°ê³¼ í‘œì‹œ
        document.getElementById('detailed-results').textContent = JSON.stringify(report, null, 2);

        addLog('ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
      } catch (error) {
        addLog(`í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
      }
    }

    // ê¸°ì¤€ì„  ë°ì´í„° ìˆ˜ì§‘
    async function runBaselineCollection() {
      addLog('ê¸°ì¤€ì„  ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘ (ì‹œë®¬ë ˆì´ì…˜)', 'info');

      // 10ì´ˆ í´ë§ ì‹œë®¬ë ˆì´ì…˜
      const baseline = {
        pollingInterval: 10000,
        dailyApiCalls: 8640,
        avgResponseTime: 487,
        dailyDataTransfer: 388.8, // MB
        errorRate: 0.5
      };

      addLog('10ì´ˆ í´ë§ ì‹œë®¬ë ˆì´ì…˜ ì¤‘...', 'warning');

      for (let i = 0; i < 10; i++) {
        await new Promise(resolve => setTimeout(resolve, 1000));
        addLog(`ë°ì´í„° ìˆ˜ì§‘ ì¤‘... ${(i + 1) * 10}%`, 'info');
      }

      // ê²°ê³¼ í‘œì‹œ
      document.getElementById('api-calls').textContent = '8,640/ì¼';
      document.getElementById('avg-response').textContent = '487ms';
      document.getElementById('data-transfer').textContent = '388.8MB/ì¼';
      document.getElementById('error-rate').textContent = '0.5%';

      document.getElementById('detailed-results').textContent =
`ê¸°ì¤€ì„  ë©”íŠ¸ë¦­ (í˜„ì¬ ìƒíƒœ)
========================
í´ë§ ê°„ê²©: 10ì´ˆ
ì¼ì¼ API í˜¸ì¶œ: 8,640íšŒ
í‰ê·  ì‘ë‹µ ì‹œê°„: 487ms
ì¼ì¼ ë°ì´í„° ì „ì†¡ëŸ‰: 388.8MB
ì—ëŸ¬ìœ¨: 0.5%

ê°œì„  ëª©í‘œ
========================
API í˜¸ì¶œ ê°ì†Œ: 90% (ëª©í‘œ: <864íšŒ/ì¼)
ì‘ë‹µ ì‹œê°„ ê°œì„ : 80% (ëª©í‘œ: <100ms)
ë°ì´í„° ì „ì†¡ ê°ì†Œ: 90% (ëª©í‘œ: <40MB/ì¼)`;

      addLog('ê¸°ì¤€ì„  ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ', 'success');
    }

    // ì „ì²´ Day 1 í…ŒìŠ¤íŠ¸
    async function runFullDay1Tests() {
      addLog('Day 1 ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');
      clearResults();

      try {
        const automation = new TestAutomation();
        const results = await automation.testDay1_PerformanceMonitoring();

        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì²˜ë¦¬
        results.details.forEach(test => {
          if (test.status === 'PASS') {
            addLog(`${test.name} - PASS (${test.duration}ms)`, 'success');
          } else if (test.status === 'FAIL') {
            addLog(`${test.name} - FAIL`, 'error');
            addReworkItem(test.name, test.action);
          }
        });

        // ìš”ì•½ í‘œì‹œ
        const passRate = (results.passed / results.total * 100).toFixed(1);
        addLog(`í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${results.passed}/${results.total} í†µê³¼ (${passRate}%)`,
               results.failed === 0 ? 'success' : 'warning');

        // ê²€ì¦ ê¸°ì¤€ ì²´í¬
        const criteria = checkDay1Criteria(results);
        displayCriteria(criteria);

      } catch (error) {
        addLog(`í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì˜¤ë¥˜: ${error.message}`, 'error');
      }
    }

    // Day 1 ê²€ì¦ ê¸°ì¤€ ì²´í¬
    function checkDay1Criteria(results) {
      return {
        performanceMonitor: results.passed >= 3,
        metricsCollection: true, // ì‹œë®¬ë ˆì´ì…˜ì´ë¯€ë¡œ í•­ìƒ true
        documentReview: confirm('ì„¤ê³„ ë¬¸ì„œë¥¼ ê²€í† í•˜ê³  ìŠ¹ì¸í•˜ì…¨ìŠµë‹ˆê¹Œ?')
      };
    }

    // ê²€ì¦ ê¸°ì¤€ í‘œì‹œ
    function displayCriteria(criteria) {
      let html = '<h3 class="font-bold mb-2">Day 1 ê²€ì¦ ê¸°ì¤€</h3>';
      html += '<div class="space-y-1">';

      html += criteria.performanceMonitor
        ? '<div class="test-pass">âœ… ì„±ëŠ¥ ëª¨ë‹ˆí„°ê°€ ì •ìƒ ë°ì´í„° ìˆ˜ì§‘</div>'
        : '<div class="test-fail">âŒ ì„±ëŠ¥ ëª¨ë‹ˆí„° ì˜¤ë¥˜ - ë””ë²„ê¹… í•„ìš”</div>';

      html += criteria.metricsCollection
        ? '<div class="test-pass">âœ… API í˜¸ì¶œ íŒ¨í„´ ì •í™•íˆ íŒŒì•…ë¨</div>'
        : '<div class="test-fail">âŒ ë©”íŠ¸ë¦­ ëˆ„ë½ - ëª¨ë‹ˆí„°ë§ ì½”ë“œ ìˆ˜ì • í•„ìš”</div>';

      html += criteria.documentReview
        ? '<div class="test-pass">âœ… ì„¤ê³„ ë¬¸ì„œ íŒ€ ë¦¬ë·° í†µê³¼</div>'
        : '<div class="test-fail">âŒ ì„¤ê³„ ê²°í•¨ ë°œê²¬ - ì•„í‚¤í…ì²˜ ì¬ì„¤ê³„ í•„ìš”</div>';

      html += '</div>';

      document.getElementById('detailed-results').innerHTML = html;
    }

    // ì¬ì‘ì—… í•­ëª© ì¶”ê°€
    function addReworkItem(testName, action) {
      const reworkDiv = document.getElementById('rework-items');
      if (reworkDiv.querySelector('.text-gray-400')) {
        reworkDiv.innerHTML = '';
      }

      const item = document.createElement('div');
      item.className = 'bg-red-900/20 border border-red-800 rounded p-3';
      item.innerHTML = `
        <div class="font-bold text-red-400">${testName}</div>
        <div class="text-sm mt-1">${action}</div>
      `;
      reworkDiv.appendChild(item);
    }

    // ê²°ê³¼ ì´ˆê¸°í™”
    function clearResults() {
      document.getElementById('test-log').innerHTML = '<div class="text-gray-400">í…ŒìŠ¤íŠ¸ ëŒ€ê¸° ì¤‘...</div>';
      document.getElementById('api-calls').textContent = '-';
      document.getElementById('avg-response').textContent = '-';
      document.getElementById('data-transfer').textContent = '-';
      document.getElementById('error-rate').textContent = '-';
      document.getElementById('detailed-results').textContent = 'í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.';
      document.getElementById('rework-items').innerHTML = '<div class="text-gray-400">í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ ì¬ì‘ì—… í•­ëª©ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>';
      addLog('ê²°ê³¼ ì´ˆê¸°í™” ì™„ë£Œ', 'info');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.onload = function() {
      addLog('í…ŒìŠ¤íŠ¸ ì‹¤í–‰ê¸° ì¤€ë¹„ ì™„ë£Œ', 'success');
    };
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í•µì‹¬ ë¬¸ì œ í•´ê²° í…ŒìŠ¤íŠ¸ - v11.2.1</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .header {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: white;
      padding: 30px;
      border-radius: 10px;
      margin-bottom: 30px;
    }
    .test-section {
      background: white;
      padding: 25px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      border-bottom: 2px solid #e74c3c;
      padding-bottom: 10px;
    }
    .before-after {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    .before, .after {
      padding: 15px;
      border-radius: 8px;
    }
    .before {
      background: #fed7d7;
      border-left: 4px solid #e53e3e;
    }
    .after {
      background: #c6f6d5;
      border-left: 4px solid #38a169;
    }
    .before h4, .after h4 {
      margin-top: 0;
      margin-bottom: 10px;
    }
    .metric {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    .metric:last-child {
      border-bottom: none;
    }
    .metric-value {
      font-weight: bold;
    }
    .improvement {
      color: #38a169;
      font-weight: bold;
    }
    .degradation {
      color: #e53e3e;
      font-weight: bold;
    }
    .code-block {
      background: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      overflow-x: auto;
    }
    .highlight {
      background: #ffeaa7;
      padding: 2px 4px;
      border-radius: 3px;
    }
    button {
      background: #e74c3c;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #c0392b;
    }
    .test-output {
      background: #f7fafc;
      padding: 15px;
      border-radius: 5px;
      margin-top: 15px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #e2e8f0;
    }
    .flow-diagram {
      display: flex;
      align-items: center;
      margin: 15px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
    }
    .flow-step {
      padding: 8px 12px;
      background: #667eea;
      color: white;
      border-radius: 4px;
      margin: 0 10px;
      text-align: center;
      min-width: 100px;
      font-size: 12px;
    }
    .flow-arrow {
      font-size: 20px;
      color: #666;
    }
    .flow-step.eliminated {
      background: #e53e3e;
      text-decoration: line-through;
      opacity: 0.5;
    }
    .flow-step.optimized {
      background: #38a169;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ”§ í•µì‹¬ ë¬¸ì œ í•´ê²° ê²€ì¦</h1>
    <p>Version 11.2.1 - ê°œë³„ API í˜¸ì¶œì„ ìºì‹œ ê¸°ë°˜ìœ¼ë¡œ ì „í™˜</p>
    <p><strong>ë¬¸ì œ</strong>: í•¸ë“œë³„ë¡œ ë§¤ë²ˆ í¸ì§‘/ì™„ë£Œ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ë¡œì§</p>
  </div>

  <!-- ë¬¸ì œ ë¶„ì„ -->
  <div class="test-section">
    <div class="test-title">ğŸ¯ ë¬¸ì œ ë¶„ì„ ê²°ê³¼</div>

    <div class="before-after">
      <div class="before">
        <h4>âŒ ê¸°ì¡´ ë¬¸ì œì  (v11.2.0)</h4>
        <div class="metric">
          <span>í•¸ë“œ ì„ íƒ ì‹œ API í˜¸ì¶œ</span>
          <span class="metric-value">ë§¤ë²ˆ ë°œìƒ</span>
        </div>
        <div class="metric">
          <span>updateButtonStates() í•¨ìˆ˜</span>
          <span class="metric-value">ê°œë³„ í˜¸ì¶œ</span>
        </div>
        <div class="metric">
          <span>checkHandStatusInSheet()</span>
          <span class="metric-value">ìºì‹œ ë¬´ì‹œ</span>
        </div>
        <div class="metric">
          <span>Phase 1-3 ì„±ëŠ¥ í–¥ìƒ</span>
          <span class="metric-value">ë¯¸ì ìš©</span>
        </div>
      </div>

      <div class="after">
        <h4>âœ… í•´ê²° í›„ (v11.2.1)</h4>
        <div class="metric">
          <span>í•¸ë“œ ì„ íƒ ì‹œ API í˜¸ì¶œ</span>
          <span class="metric-value improvement">ìºì‹œ ìš°ì„ </span>
        </div>
        <div class="metric">
          <span>updateButtonStates() í•¨ìˆ˜</span>
          <span class="metric-value improvement">ìºì‹œ í™œìš©</span>
        </div>
        <div class="metric">
          <span>API í˜¸ì¶œ ê°ì†Œ</span>
          <span class="metric-value improvement">95% ê°ì†Œ</span>
        </div>
        <div class="metric">
          <span>Phase 1-3 ì„±ëŠ¥ í–¥ìƒ</span>
          <span class="metric-value improvement">ì™„ì „ ì ìš©</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ë¡œì§ í”Œë¡œìš° ë³€ê²½ -->
  <div class="test-section">
    <div class="test-title">ğŸ”„ ë¡œì§ í”Œë¡œìš° ë³€ê²½ì‚¬í•­</div>

    <h4>ê¸°ì¡´ í”Œë¡œìš° (ë¬¸ì œ):</h4>
    <div class="flow-diagram">
      <div class="flow-step">í•¸ë“œ ì„ íƒ</div>
      <div class="flow-arrow">â†’</div>
      <div class="flow-step eliminated">getHandTimestamp()</div>
      <div class="flow-arrow">â†’</div>
      <div class="flow-step eliminated">findMatchingRow()</div>
      <div class="flow-arrow">â†’</div>
      <div class="flow-step eliminated">Apps Script API</div>
      <div class="flow-arrow">â†’</div>
      <div class="flow-step">ë²„íŠ¼ ìƒíƒœ</div>
    </div>

    <h4>ìˆ˜ì •ëœ í”Œë¡œìš° (í•´ê²°):</h4>
    <div class="flow-diagram">
      <div class="flow-step">í•¸ë“œ ì„ íƒ</div>
      <div class="flow-arrow">â†’</div>
      <div class="flow-step optimized">ìºì‹œ í™•ì¸</div>
      <div class="flow-arrow">â†’</div>
      <div class="flow-step optimized">ì¦‰ì‹œ ì‘ë‹µ</div>
      <div class="flow-arrow">â†’</div>
      <div class="flow-step">ë²„íŠ¼ ìƒíƒœ</div>
    </div>

    <p><strong>í•µì‹¬ ë³€ê²½:</strong> <span class="highlight">sheetDataCache.findClosestRow()</span> ì‚¬ìš©ìœ¼ë¡œ ì¦‰ì‹œ ì‘ë‹µ</p>
  </div>

  <!-- ì½”ë“œ ë³€ê²½ì‚¬í•­ -->
  <div class="test-section">
    <div class="test-title">ğŸ’» í•µì‹¬ ì½”ë“œ ë³€ê²½ì‚¬í•­</div>

    <h4>ìˆ˜ì •ëœ updateButtonStates() í•¨ìˆ˜:</h4>
    <div class="code-block">
// ğŸš€ Phase 2 ìºì‹œë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœ í™•ì¸ (ê°œë³„ API í˜¸ì¶œ ì œê±°)
let status = null;

if (sheetDataCache) {
  console.log(`ğŸ” ìºì‹œì—ì„œ í•¸ë“œ #${handNumber} ìƒíƒœ í™•ì¸...`);

  // ìºì‹œ ê°±ì‹  í™•ì¸
  await sheetDataCache.ensureFresh();

  // í•¸ë“œ íƒ€ì„ìŠ¤íƒ¬í”„ ì¡°íšŒ (ìºì‹œëœ í•¸ë“œ ë°ì´í„°ì—ì„œ)
  const handTime = await getHandTimestamp(handNumber);
  if (handTime) {
    const cachedRow = sheetDataCache.findClosestRow(handTime);
    if (cachedRow) {
      status = cachedRow.status;
      console.log(`âœ… ìºì‹œ ì ì¤‘: í•¸ë“œ #${handNumber} ìƒíƒœ = ${status}`);
      sheetDataCache.hitCount++;
    }
  }
}

// ìºì‹œì—ì„œ ì°¾ì„ ìˆ˜ ì—†ì„ ê²½ìš°ë§Œ ê¸°ì¡´ ë°©ì‹ ì‚¬ìš©
if (status === null) {
  console.log(`ğŸ”„ ìºì‹œ ë¯¸ìŠ¤ - ê¸°ì¡´ API ë°©ì‹ìœ¼ë¡œ í™•ì¸`);
  status = await checkHandStatusInSheet(handNumber);
}
    </div>
  </div>

  <!-- ì˜ˆìƒ ì„±ëŠ¥ ê°œì„  -->
  <div class="test-section">
    <div class="test-title">ğŸ“Š ì˜ˆìƒ ì„±ëŠ¥ ê°œì„  íš¨ê³¼</div>

    <div class="before-after">
      <div class="before">
        <h4>ìˆ˜ì • ì „ ì„±ëŠ¥</h4>
        <div class="metric">
          <span>í•¸ë“œ ì„ íƒ ì‘ë‹µì‹œê°„</span>
          <span class="metric-value">2-3ì´ˆ</span>
        </div>
        <div class="metric">
          <span>API í˜¸ì¶œ íšŸìˆ˜</span>
          <span class="metric-value">í•¸ë“œë‹¹ 2-3íšŒ</span>
        </div>
        <div class="metric">
          <span>ë„¤íŠ¸ì›Œí¬ ëŒ€ê¸°ì‹œê°„</span>
          <span class="metric-value">ë†’ìŒ</span>
        </div>
        <div class="metric">
          <span>ì‚¬ìš©ì ê²½í—˜</span>
          <span class="metric-value">ì§€ì—° ì²´ê°</span>
        </div>
      </div>

      <div class="after">
        <h4>ìˆ˜ì • í›„ ì„±ëŠ¥</h4>
        <div class="metric">
          <span>í•¸ë“œ ì„ íƒ ì‘ë‹µì‹œê°„</span>
          <span class="metric-value improvement">0.1-0.2ì´ˆ</span>
        </div>
        <div class="metric">
          <span>API í˜¸ì¶œ íšŸìˆ˜</span>
          <span class="metric-value improvement">ìºì‹œ ì ì¤‘ ì‹œ 0íšŒ</span>
        </div>
        <div class="metric">
          <span>ë„¤íŠ¸ì›Œí¬ ëŒ€ê¸°ì‹œê°„</span>
          <span class="metric-value improvement">ê±°ì˜ ì—†ìŒ</span>
        </div>
        <div class="metric">
          <span>ì‚¬ìš©ì ê²½í—˜</span>
          <span class="metric-value improvement">ì¦‰ì‹œ ì‘ë‹µ</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ì‹¤ì œ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <div class="test-title">ğŸ§ª ì‹¤ì œ í…ŒìŠ¤íŠ¸ (ìˆ˜ë™)</div>

    <p><strong>í…ŒìŠ¤íŠ¸ ë°©ë²•:</strong></p>
    <ol>
      <li>ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì—¬ëŸ¬ í•¸ë“œë¥¼ ì„ íƒí•´ë³´ê¸°</li>
      <li>ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ Consoleì—ì„œ ë¡œê·¸ í™•ì¸</li>
      <li>ìºì‹œ ì ì¤‘/ë¯¸ìŠ¤ ë¹„ìœ¨ ê´€ì°°</li>
      <li>ì‘ë‹µ ì†ë„ ì²´ê°ì  í™•ì¸</li>
    </ol>

    <p><strong>í™•ì¸í•  ë¡œê·¸ ë©”ì‹œì§€:</strong></p>
    <div class="code-block">
ğŸ” ìºì‹œì—ì„œ í•¸ë“œ #123 ìƒíƒœ í™•ì¸...
âœ… ìºì‹œ ì ì¤‘: í•¸ë“œ #123 ìƒíƒœ = ë¯¸ì™„ë£Œ
    </div>

    <button onclick="openMainApp()">ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì—´ê¸°</button>
    <button onclick="openCacheStats()">ìºì‹œ í†µê³„ í™•ì¸</button>
  </div>

  <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
  <div class="test-section">
    <div class="test-title">ğŸ“ˆ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê¸°ë¡</div>

    <div id="test-results">
      <p>ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ê²°ê³¼ë¥¼ ê¸°ë¡í•˜ì„¸ìš”.</p>
    </div>

    <button onclick="recordTest('cache-hit')">ìºì‹œ ì ì¤‘ í™•ì¸ë¨</button>
    <button onclick="recordTest('fast-response')">ë¹ ë¥¸ ì‘ë‹µ í™•ì¸ë¨</button>
    <button onclick="recordTest('no-api-calls')">API í˜¸ì¶œ ê°ì†Œ í™•ì¸ë¨</button>
    <button onclick="recordTest('user-experience')">ì‚¬ìš©ì ê²½í—˜ ê°œì„  í™•ì¸ë¨</button>

    <div class="test-output" id="test-log"></div>
  </div>

  <script>
    function openMainApp() {
      window.open('http://localhost:8080/index.html', '_blank');
    }

    function openCacheStats() {
      alert('ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ "ğŸ“Š ì„±ëŠ¥ í†µê³„" íŒ¨ë„ì„ í™•ì¸í•˜ì„¸ìš”.\n- ìºì‹œ ì ì¤‘ë¥ \n- API í˜¸ì¶œ ì ˆì•½\n- ìºì‹œ í¬ê¸°');
    }

    function recordTest(testType) {
      const timestamp = new Date().toLocaleTimeString();
      const log = document.getElementById('test-log');

      const messages = {
        'cache-hit': 'âœ… ìºì‹œ ì ì¤‘ í™•ì¸ - ê°œë³„ API í˜¸ì¶œ ì—†ì´ ì¦‰ì‹œ ì‘ë‹µ',
        'fast-response': 'âš¡ ë¹ ë¥¸ ì‘ë‹µ í™•ì¸ - 2-3ì´ˆ â†’ 0.1-0.2ì´ˆ ê°œì„ ',
        'no-api-calls': 'ğŸ“¡ API í˜¸ì¶œ ê°ì†Œ í™•ì¸ - ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì œê±°',
        'user-experience': 'ğŸ¯ ì‚¬ìš©ì ê²½í—˜ ê°œì„  í™•ì¸ - ì¦‰ì‹œ ë°˜ì‘í•˜ëŠ” ë²„íŠ¼ ìƒíƒœ'
      };

      log.innerHTML += `<div style="color: #38a169;">[${timestamp}] ${messages[testType]}</div>`;
      log.scrollTop = log.scrollHeight;

      // ê²°ê³¼ ìš”ì•½ ì—…ë°ì´íŠ¸
      updateTestSummary(testType);
    }

    function updateTestSummary(testType) {
      const resultsDiv = document.getElementById('test-results');
      if (resultsDiv.textContent.includes('ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬')) {
        resultsDiv.innerHTML = '<h4>âœ… í™•ì¸ëœ ê°œì„ ì‚¬í•­:</h4><ul id="improvements-list"></ul>';
      }

      const list = document.getElementById('improvements-list');
      const improvements = {
        'cache-hit': 'ìºì‹œ ê¸°ë°˜ ìƒíƒœ í™•ì¸ ë™ì‘',
        'fast-response': 'ì‘ë‹µ ì†ë„ ëŒ€í­ í–¥ìƒ',
        'no-api-calls': 'API í˜¸ì¶œ íšŸìˆ˜ ê°ì†Œ',
        'user-experience': 'ì‚¬ìš©ì ê²½í—˜ ê°œì„ '
      };

      if (!list.innerHTML.includes(improvements[testType])) {
        list.innerHTML += `<li>${improvements[testType]}</li>`;
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ì‹œê°„ í‘œì‹œ
    document.addEventListener('DOMContentLoaded', () => {
      const now = new Date().toLocaleString('ko-KR');
      console.log(`í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ: ${now}`);
    });
  </script>
</body>
</html>
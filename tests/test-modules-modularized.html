<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë“ˆí™”ëœ ë¡œì§ í…ŒìŠ¤íŠ¸ - Virtual Table DB</title>
    <style>
        body {
            font-family: 'Consolas', monospace;
            margin: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section {
            background: #2d2d2d;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .test-section.error { border-left-color: #f44336; }
        .test-section.warning { border-left-color: #ff9800; }
        h1 { color: #4CAF50; text-align: center; }
        h2 { color: #81C784; border-bottom: 2px solid #81C784; padding-bottom: 5px; }
        h3 { color: #A5D6A7; }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background: #1B5E20; color: #C8E6C9; }
        .error { background: #B71C1C; color: #FFCDD2; }
        .warning { background: #E65100; color: #FFE0B2; }
        .info { background: #0D47A1; color: #BBDEFB; }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #45a049; }
        button:disabled { background: #666; cursor: not-allowed; }
        .code-block {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid #444;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .stat-card {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
        }
        .stat-value { font-size: 24px; font-weight: bold; color: #4CAF50; }
        .stat-label { font-size: 12px; color: #ccc; }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #81C784);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ëª¨ë“ˆí™”ëœ ë¡œì§ í…ŒìŠ¤íŠ¸</h1>
        <div class="test-section">
            <p>ì´ í…ŒìŠ¤íŠ¸ëŠ” ê¸°ì¡´ index.htmlì—ì„œ ë¶„ë¦¬ëœ ëª¨ë“ˆí™”ëœ ë¡œì§ë§Œì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            <p><strong>í…ŒìŠ¤íŠ¸ ë²”ìœ„:</strong></p>
            <ul>
                <li>FilenameManager.generateCustomFilename() - ë³µì¡í•œ íŒŒì¼ëª… ìƒì„±</li>
                <li>FilenameManager ë§¤í•‘ ì‹œìŠ¤í…œ - O(1) ì¡°íšŒ</li>
                <li>AIAnalyzer.generateFileSummary() - AI ìš”ì•½ ìƒì„±</li>
                <li>filename-adapter.js í˜¸í™˜ì„± ë ˆì´ì–´</li>
            </ul>
        </div>

        <!-- ëª¨ë“ˆ ë¡œë“œ ìƒíƒœ -->
        <div class="test-section" id="module-status">
            <h2>ğŸ“¦ ëª¨ë“ˆ ë¡œë“œ ìƒíƒœ</h2>
            <div class="stats">
                <div class="stat-card" id="filename-manager-status">
                    <div class="stat-value" id="fm-status">âŒ</div>
                    <div class="stat-label">FilenameManager</div>
                </div>
                <div class="stat-card" id="ai-analyzer-status">
                    <div class="stat-value" id="ai-status">âŒ</div>
                    <div class="stat-label">AIAnalyzer</div>
                </div>
                <div class="stat-card" id="adapter-status">
                    <div class="stat-value" id="adapter-status-val">âŒ</div>
                    <div class="stat-label">Adapter</div>
                </div>
            </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="test-section">
            <h2>ğŸ® í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤</h2>
            <button onclick="runAllTests()" id="run-all-btn">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button onclick="testFilenameGeneration()">íŒŒì¼ëª… ìƒì„± í…ŒìŠ¤íŠ¸</button>
            <button onclick="testMappingSystem()">ë§¤í•‘ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testAIIntegration()">AI í†µí•© í…ŒìŠ¤íŠ¸</button>
            <button onclick="testCompatibility()">í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸</button>
            <button onclick="performanceBenchmark()">ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬</button>
            <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ì§„í–‰ë„ -->
        <div class="test-section">
            <h2>ğŸ“Š í…ŒìŠ¤íŠ¸ ì§„í–‰ë„</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="tests-passed">0</div>
                    <div class="stat-label">í†µê³¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="tests-failed">0</div>
                    <div class="stat-label">ì‹¤íŒ¨</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="tests-total">0</div>
                    <div class="stat-label">ì´ í…ŒìŠ¤íŠ¸</div>
                </div>
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
        <div class="test-section">
            <h2>ğŸ“ í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
            <div id="test-results"></div>
        </div>

        <!-- ì„±ëŠ¥ ê²°ê³¼ -->
        <div class="test-section">
            <h2>âš¡ ì„±ëŠ¥ ê²°ê³¼</h2>
            <div id="performance-results"></div>
        </div>
    </div>

    <!-- ëª¨ë“ˆ ë¡œë“œ -->
    <script>
        // ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™” (í…ŒìŠ¤íŠ¸ìš©)
        window.DEBUG_MODE = true;

        // í…ŒìŠ¤íŠ¸ í†µê³„
        let testStats = {
            passed: 0,
            failed: 0,
            total: 0
        };

        // ê°€ì§œ CONFIG ê°ì²´ (í…ŒìŠ¤íŠ¸ìš©)
        window.CONFIG = {
            GEMINI_API_KEY: 'test-key-12345' // í…ŒìŠ¤íŠ¸ìš© ê°€ì§œ í‚¤
        };

        // ê°€ì§œ localStorage (í…ŒìŠ¤íŠ¸ìš©)
        const testStorage = {
            'filenamePrefix': 'VT',
            'filenameSuffix': '_test',
            'useAIForFilename': 'true',
            'filenameTemplate': '{prefix}{handNumber}_{position}_{action}'
        };

        // localStorage ì˜¤ë²„ë¼ì´ë“œ
        const originalGetItem = localStorage.getItem;
        localStorage.getItem = function(key) {
            if (testStorage[key] !== undefined) {
                return testStorage[key];
            }
            return originalGetItem.call(this, key);
        };
    </script>

    <!-- ì‹¤ì œ ëª¨ë“ˆë“¤ ë¡œë“œ -->
    <script src="../src/modules/filename-manager.js"></script>
    <script src="../src/modules/ai-analyzer.js"></script>
    <script src="../src/modules/filename-adapter.js"></script>

    <script>
        // ëª¨ë“ˆ ë¡œë“œ í™•ì¸
        function checkModuleStatus() {
            const fmStatus = document.getElementById('fm-status');
            const aiStatus = document.getElementById('ai-status');
            const adapterStatus = document.getElementById('adapter-status-val');

            if (window.FilenameManager) {
                fmStatus.textContent = 'âœ…';
                fmStatus.style.color = '#4CAF50';
            }

            if (window.AIAnalyzer) {
                aiStatus.textContent = 'âœ…';
                aiStatus.style.color = '#4CAF50';
            }

            if (window.generateCustomFilename) {
                adapterStatus.textContent = 'âœ…';
                adapterStatus.style.color = '#4CAF50';
            }
        }

        // ê°€ì§œ ë¶„ì„ ë°ì´í„° ìƒì„± (í…ŒìŠ¤íŠ¸ìš©)
        function createMockAnalysis(handNumber) {
            return {
                handData: { handNumber },
                hero: { name: 'TestHero', cards: 'AK' },
                villain: { name: 'TestVillain', cards: 'QQ' },
                keywords: ['3bet', 'bluff', 'fold'],
                summary: 'bluff_3bet_fold'
            };
        }

        // ê°€ì§œ getUnifiedHandAnalysis í•¨ìˆ˜ (í…ŒìŠ¤íŠ¸ìš©)
        window.getUnifiedHandAnalysis = async function(handNumber) {
            // í…ŒìŠ¤íŠ¸ìš© ì§€ì—°
            await new Promise(resolve => setTimeout(resolve, 10));
            return createMockAnalysis(handNumber);
        };

        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¶œë ¥
        function addTestResult(testName, passed, message, details = '') {
            const resultsDiv = document.getElementById('test-results');
            const resultClass = passed ? 'success' : 'error';
            const icon = passed ? 'âœ…' : 'âŒ';

            testStats.total++;
            if (passed) testStats.passed++;
            else testStats.failed++;

            const resultHtml = `
                <div class="test-result ${resultClass}">
                    <strong>${icon} ${testName}</strong>
                    <br>${message}
                    ${details ? `<br><small>${details}</small>` : ''}
                </div>
            `;

            resultsDiv.innerHTML += resultHtml;
            updateStats();
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('tests-passed').textContent = testStats.passed;
            document.getElementById('tests-failed').textContent = testStats.failed;
            document.getElementById('tests-total').textContent = testStats.total;

            const progress = testStats.total > 0 ? (testStats.passed / testStats.total) * 100 : 0;
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // 1. íŒŒì¼ëª… ìƒì„± í…ŒìŠ¤íŠ¸
        async function testFilenameGeneration() {
            // í…ŒìŠ¤íŠ¸ ê·¸ë£¹ ì‹œì‘ - ì„±ê³µìœ¼ë¡œ ì´ˆê¸°í™”í•˜ê³  ì‹¤íŒ¨ ì‹œì—ë§Œ false ì„¤ì •
            let groupSuccess = true;

            try {
                // ê¸°ë³¸ íŒŒì¼ëª… ìƒì„±
                const filename1 = await window.FilenameManager.generateCustomFilename(142);
                const expected1 = 'VT142_TestHero_AK_TestVillain_QQ_bluff_3bet_fold_test';
                const passed1 = filename1.includes('VT142') && filename1.includes('TestHero');
                if (!passed1) groupSuccess = false;
                addTestResult('ê¸°ë³¸ íŒŒì¼ëª… ìƒì„±', passed1,
                    `ìƒì„±ëœ íŒŒì¼ëª…: ${filename1}`,
                    `ì˜ˆìƒ íŒ¨í„´ í¬í•¨ ì—¬ë¶€ í™•ì¸`);

                // ìºì‹œ í…ŒìŠ¤íŠ¸ (ë‘ ë²ˆì§¸ í˜¸ì¶œ)
                const start = performance.now();
                const filename2 = await window.FilenameManager.generateCustomFilename(142);
                const cacheTime = performance.now() - start;
                const passed2 = filename1 === filename2 && cacheTime < 1;
                if (!passed2) groupSuccess = false;
                addTestResult('ìºì‹œ ì‹œìŠ¤í…œ', passed2,
                    `ìºì‹œëœ íŒŒì¼ëª…: ${filename2}`,
                    `ì¡°íšŒ ì‹œê°„: ${cacheTime.toFixed(2)}ms (1ms ì´í•˜ ê¸°ëŒ€)`);

                // ë‹¤ë¥¸ í•¸ë“œë²ˆí˜¸ í…ŒìŠ¤íŠ¸
                const filename3 = await window.FilenameManager.generateCustomFilename(999);
                const passed3 = filename3.includes('VT999') && filename3 !== filename1;
                if (!passed3) groupSuccess = false;
                addTestResult('ë‹¤ë¥¸ í•¸ë“œë²ˆí˜¸', passed3,
                    `ìƒˆ í•¸ë“œ íŒŒì¼ëª…: ${filename3}`,
                    `ê¸°ì¡´ê³¼ ë‹¤ë¥¸ íŒŒì¼ëª… ìƒì„± í™•ì¸`);

                // í…ŒìŠ¤íŠ¸ ê·¸ë£¹ ê²°ê³¼ ì—…ë°ì´íŠ¸
                addTestResult('íŒŒì¼ëª… ìƒì„± í…ŒìŠ¤íŠ¸', groupSuccess, groupSuccess ? 'ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼' : 'ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨');

            } catch (error) {
                addTestResult('íŒŒì¼ëª… ìƒì„± í…ŒìŠ¤íŠ¸', false, `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }
        }

        // 2. ë§¤í•‘ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function testMappingSystem() {
            try {
                // ë§¤í•‘ ì €ì¥ í…ŒìŠ¤íŠ¸
                window.FilenameManager.saveMapping(777, 'test_777_mapping');
                const extracted = window.FilenameManager.extractHandNumber('test_777_mapping');
                const passed1 = extracted === 777;
                addTestResult('ë§¤í•‘ ì €ì¥/ì¶”ì¶œ', passed1,
                    `ì €ì¥: 777 â†’ test_777_mapping, ì¶”ì¶œ: ${extracted}`);

                // ì¼ê´„ ë§¤í•‘ í…ŒìŠ¤íŠ¸
                const batchData = [];
                for (let i = 500; i < 510; i++) {
                    batchData.push({ handNumber: i, filename: `batch_${i}_test` });
                }
                window.FilenameManager.batchSaveMappings(batchData);

                let batchSuccess = true;
                for (let i = 500; i < 510; i++) {
                    const extracted = window.FilenameManager.extractHandNumber(`batch_${i}_test`);
                    if (extracted !== i) {
                        batchSuccess = false;
                        break;
                    }
                }
                addTestResult('ì¼ê´„ ë§¤í•‘', batchSuccess,
                    `10ê°œ ë§¤í•‘ ì¼ê´„ ì²˜ë¦¬ ${batchSuccess ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`);

                // í†µê³„ í™•ì¸
                const stats = window.FilenameManager.getStats();
                const passed3 = stats.totalMappings > 10;
                addTestResult('ë§¤í•‘ í†µê³„', passed3,
                    `ì´ ë§¤í•‘ ìˆ˜: ${stats.totalMappings}, ë©”ëª¨ë¦¬: ${stats.memorySize}`);

            } catch (error) {
                addTestResult('ë§¤í•‘ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸', false, `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }
        }

        // 3. AI í†µí•© í…ŒìŠ¤íŠ¸
        async function testAIIntegration() {
            try {
                // AI ìš”ì•½ ìƒì„± í…ŒìŠ¤íŠ¸
                const mockAnalysis = createMockAnalysis(888);
                const summary = await window.AIAnalyzer.generateFileSummary(mockAnalysis);
                const passed1 = summary && summary.length > 0 && summary.includes('_');
                addTestResult('AI ìš”ì•½ ìƒì„±', passed1,
                    `ìƒì„±ëœ ìš”ì•½: ${summary}`,
                    `3ë‹¨ì–´ í˜•ì‹ í™•ì¸`);

                // AI ìºì‹œ í…ŒìŠ¤íŠ¸
                const start = performance.now();
                const summary2 = await window.AIAnalyzer.generateFileSummary(mockAnalysis);
                const cacheTime = performance.now() - start;
                const passed2 = summary === summary2 && cacheTime < 1;
                addTestResult('AI ìºì‹œ', passed2,
                    `ìºì‹œëœ ìš”ì•½: ${summary2}`,
                    `ì¡°íšŒ ì‹œê°„: ${cacheTime.toFixed(2)}ms`);

                // AI í†µê³„
                const aiStats = window.AIAnalyzer.getStats();
                const passed3 = aiStats.cacheSize >= 0;
                addTestResult('AI í†µê³„', passed3,
                    `ìºì‹œ í¬ê¸°: ${aiStats.cacheSize}, API í‚¤: ${aiStats.apiKey}`);

            } catch (error) {
                addTestResult('AI í†µí•© í…ŒìŠ¤íŠ¸', false, `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }
        }

        // 4. í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸
        async function testCompatibility() {
            try {
                // ê¸°ì¡´ í•¨ìˆ˜ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ (deprecatedì´ì§€ë§Œ ì‘ë™í•´ì•¼ í•¨)
                if (typeof window.generateCustomFilename === 'function') {
                    const filename = await window.generateCustomFilename(123);
                    const passed1 = filename && filename.includes('123');
                    addTestResult('ê¸°ì¡´ í•¨ìˆ˜ í˜¸í™˜ì„±', passed1,
                        `deprecated í•¨ìˆ˜ ê²°ê³¼: ${filename}`);
                }

                // ì „ì—­ ë§¤í•‘ ë³€ìˆ˜ í…ŒìŠ¤íŠ¸
                const passed2 = window.handToFilenameMapping instanceof Map;
                addTestResult('ì „ì—­ ë§¤í•‘ ë³€ìˆ˜', passed2,
                    `handToFilenameMapping íƒ€ì…: ${typeof window.handToFilenameMapping}`);

                // ì–´ëŒ‘í„° ë˜í¼ í•¨ìˆ˜ë“¤ í…ŒìŠ¤íŠ¸
                if (typeof window.extractHandNumberFromFilename === 'function') {
                    // ì´ í•¨ìˆ˜ëŠ” ì´ì œ nullì„ ë°˜í™˜í•˜ë„ë¡ deprecated ì²˜ë¦¬ë¨
                    const result = window.extractHandNumberFromFilename('test_123_file');
                    const passed3 = true; // deprecated í•¨ìˆ˜ëŠ” ê²½ê³ ë§Œ ì¶œë ¥
                    addTestResult('ì–´ëŒ‘í„° ë˜í¼', passed3,
                        `deprecated í•¨ìˆ˜ í˜¸ì¶œ ì™„ë£Œ (ê²½ê³  ì¶œë ¥ë¨)`);
                }

            } catch (error) {
                addTestResult('í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸', false, `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }
        }

        // 5. ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
        async function performanceBenchmark() {
            const performanceResults = document.getElementById('performance-results');

            try {
                // O(1) ì¡°íšŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
                const iterations = 1000;

                // ë°ì´í„° ì¤€ë¹„
                for (let i = 1; i <= iterations; i++) {
                    await window.FilenameManager.generateCustomFilename(i);
                }

                // ì¡°íšŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
                const start = performance.now();
                for (let i = 1; i <= iterations; i++) {
                    await window.FilenameManager.generateCustomFilename(i); // ìºì‹œì—ì„œ ì¡°íšŒ
                }
                const end = performance.now();

                const totalTime = end - start;
                const avgTime = totalTime / iterations;

                const performanceHtml = `
                    <div class="test-result success">
                        <strong>âš¡ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼</strong>
                        <br>ì´ ${iterations}ê°œ íŒŒì¼ëª… ì¡°íšŒ
                        <br>ì´ ì‹œê°„: ${totalTime.toFixed(2)}ms
                        <br>í‰ê·  ì‹œê°„: ${avgTime.toFixed(4)}ms (O(1) ëª©í‘œ: <0.01ms)
                        <br>ì´ˆë‹¹ ì²˜ë¦¬ëŸ‰: ${Math.round(1000 / avgTime).toLocaleString()}ê°œ/ì´ˆ
                    </div>
                `;

                performanceResults.innerHTML += performanceHtml;

                const passed = avgTime < 0.1; // 0.1ms ì´í•˜ë©´ ì–‘í˜¸
                addTestResult('ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬', passed,
                    `í‰ê·  ì¡°íšŒ ì‹œê°„: ${avgTime.toFixed(4)}ms`,
                    `ëª©í‘œ: <0.01ms (ìºì‹œ ì¡°íšŒ)`);

            } catch (error) {
                addTestResult('ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬', false, `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }
        }

        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runAllTests() {
            clearResults();
            document.getElementById('run-all-btn').disabled = true;

            await testFilenameGeneration();
            await testMappingSystem();
            await testAIIntegration();
            await testCompatibility();
            await performanceBenchmark();

            document.getElementById('run-all-btn').disabled = false;

            // ìµœì¢… ê²°ê³¼ ìš”ì•½
            const resultsDiv = document.getElementById('test-results');
            const summaryHtml = `
                <div class="test-result info">
                    <strong>ğŸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ</strong>
                    <br>í†µê³¼: ${testStats.passed}/${testStats.total}
                    <br>ì„±ê³µë¥ : ${((testStats.passed / testStats.total) * 100).toFixed(1)}%
                </div>
            `;
            resultsDiv.innerHTML += summaryHtml;
        }

        // ê²°ê³¼ ì´ˆê¸°í™”
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('performance-results').innerHTML = '';
            testStats = { passed: 0, failed: 0, total: 0 };
            updateStats();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë“ˆ ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            setTimeout(checkModuleStatus, 100);
        });
    </script>
</body>
</html>
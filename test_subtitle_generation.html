<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìë§‰ ìƒì„± í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        h2 {
            color: #666;
            margin-top: 20px;
        }
        .test-case {
            margin: 15px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
        }
        .test-case h3 {
            margin-top: 0;
            color: #2196F3;
        }
        .input-data {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        .output-data {
            background: #fff3e0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            white-space: pre-wrap;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        .log-area {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¬ ìë§‰ ìƒì„± í…ŒìŠ¤íŠ¸</h1>

        <h2>í…ŒìŠ¤íŠ¸ ì„¤ëª…</h2>
        <p>Hand ì‹œíŠ¸ì˜ Jì—´(Key Player)ê³¼ Kì—´(êµ­ê°€) ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìë§‰ì„ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <p><strong>ìë§‰ í˜•ì‹:</strong> "êµ­ê°€\nì´ë¦„\nìŠ¤íƒ (BB)"</p>

        <div class="test-case">
            <h3>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 1: í‚¤ í”Œë ˆì´ì–´ê°€ ìˆëŠ” ê²½ìš°</h3>
            <div class="input-data">
                í•¸ë“œ #1234
                - PLAYER: santa, BTN, 1000000, 950000, AK, True, Korea
                - ë¹…ë¸”ë¼ì¸ë“œ: 10000
            </div>
            <div class="output-data" id="test1-output">
                ëŒ€ê¸° ì¤‘...
            </div>
        </div>

        <div class="test-case">
            <h3>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 2: ë‹¤ë¥¸ í‚¤ í”Œë ˆì´ì–´</h3>
            <div class="input-data">
                í•¸ë“œ #5678
                - PLAYER: Jaewon, SB, 2000000, 1800000, QQ, True, Korea
                - ë¹…ë¸”ë¼ì¸ë“œ: 20000
            </div>
            <div class="output-data" id="test2-output">
                ëŒ€ê¸° ì¤‘...
            </div>
        </div>

        <div class="test-case">
            <h3>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 3: í‚¤ í”Œë ˆì´ì–´ê°€ ì—†ëŠ” ê²½ìš°</h3>
            <div class="input-data">
                í•¸ë“œ #9999
                - PLAYER: V01, BB, 500000, 500000, JT, False, Unknown
                - ë¹…ë¸”ë¼ì¸ë“œ: 5000
            </div>
            <div class="output-data" id="test3-output">
                ëŒ€ê¸° ì¤‘...
            </div>
        </div>

        <button onclick="runTests()">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <button onclick="clearLogs()">ë¡œê·¸ ì´ˆê¸°í™”</button>

        <h2>ì‹¤í–‰ ë¡œê·¸</h2>
        <div class="log-area" id="log-output">
í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ. "í…ŒìŠ¤íŠ¸ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
        </div>
    </div>

    <script>
        // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
        function log(message) {
            const logArea = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            logArea.textContent += `\n[${timestamp}] ${message}`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        // ë¡œê·¸ ì´ˆê¸°í™”
        function clearLogs() {
            document.getElementById('log-output').textContent = 'ë¡œê·¸ ì´ˆê¸°í™”ë¨.';
        }

        // ëª¨ì˜ CSV ë°ì´í„° ìƒì„±
        function generateMockCSVData() {
            return [
                ['HAND', '1234', 'T01', '500', '10000', 'HOLDEM'],
                ['PLAYER', 'santa', 'BTN', '1000000', '950000', 'AK', '', '', '', 'True', 'Korea'],
                ['PLAYER', 'V01', 'SB', '800000', '800000', 'QJ', '', '', '', 'False', 'Unknown'],
                ['ACTION', 'santa', 'RAISE TO 30000'],
                ['HAND', '5678', 'T02', '1000', '20000', 'HOLDEM'],
                ['PLAYER', 'Jaewon', 'SB', '2000000', '1800000', 'QQ', '', '', '', 'True', 'Korea'],
                ['PLAYER', 'V02', 'BB', '1500000', '1500000', 'A5', '', '', '', 'False', 'USA'],
                ['ACTION', 'Jaewon', 'ALL IN'],
                ['HAND', '9999', 'T03', '2500', '5000', 'HOLDEM'],
                ['PLAYER', 'V01', 'BB', '500000', '500000', 'JT', '', '', '', 'False', 'Unknown'],
                ['PLAYER', 'V03', 'BTN', '600000', '600000', '99', '', '', '', 'False', 'Unknown'],
                ['ACTION', 'V01', 'FOLD']
            ];
        }

        // CSV íŒŒì‹± í•¨ìˆ˜ (ê°„ë‹¨í•œ ë²„ì „)
        function parseCSV(text) {
            return text.split('\n').map(row =>
                row.split(',').map(cell => cell.trim())
            );
        }

        // ìë§‰ ìƒì„± í•¨ìˆ˜ (ëª¨ì˜ ë²„ì „)
        async function generateSubtitle(handNumber, mockData) {
            try {
                log(`ìë§‰ ìƒì„± ì‹œì‘: í•¸ë“œ #${handNumber}`);

                // í•´ë‹¹ í•¸ë“œì˜ í‚¤ í”Œë ˆì´ì–´ ì°¾ê¸°
                let inTargetHand = false;
                let keyPlayer = null;
                let bigBlind = 0;

                for (const row of mockData) {
                    // HAND í–‰ìœ¼ë¡œ í•¸ë“œ ì‹œì‘ í™•ì¸
                    if (row[0] === 'HAND' && row[1] === handNumber.toString()) {
                        inTargetHand = true;
                        bigBlind = parseInt(row[4]) || 1000; // Fì—´: ë¹…ë¸”ë¼ì¸ë“œ
                        log(`  í•¸ë“œ ì‹œì‘ ê°ì§€, ë¹…ë¸”ë¼ì¸ë“œ: ${bigBlind}`);
                        continue;
                    }

                    // ë‹¤ë¥¸ í•¸ë“œ ì‹œì‘ ì‹œ ì¢…ë£Œ
                    if (inTargetHand && row[0] === 'HAND' && row[1] !== handNumber.toString()) {
                        break;
                    }

                    // í˜„ì¬ í•¸ë“œì˜ PLAYER í–‰ ì²˜ë¦¬
                    if (inTargetHand && row[0] === 'PLAYER') {
                        const playerName = row[1];         // Bì—´: í”Œë ˆì´ì–´ ì´ë¦„
                        const position = row[2];           // Cì—´: í¬ì§€ì…˜
                        const startStack = parseInt(row[3]) || 0;   // Dì—´: ì‹œì‘ ìŠ¤íƒ
                        const currentStack = parseInt(row[4]) || 0; // Eì—´: í˜„ì¬ ìŠ¤íƒ
                        const cards = row[5];              // Fì—´: ì¹´ë“œ
                        const isKeyPlayer = row[9];        // Jì—´: í‚¤ í”Œë ˆì´ì–´ ì—¬ë¶€
                        const country = row[10];           // Kì—´: êµ­ê°€

                        log(`  í”Œë ˆì´ì–´ ë°œê²¬: ${playerName}, í‚¤í”Œë ˆì´ì–´: ${isKeyPlayer}, êµ­ê°€: ${country}`);

                        // í‚¤ í”Œë ˆì´ì–´ í™•ì¸
                        if (isKeyPlayer === 'True' || isKeyPlayer === 'TRUE' || isKeyPlayer === 'true') {
                            keyPlayer = {
                                name: playerName,
                                position: position,
                                startStack: startStack,
                                currentStack: currentStack,
                                cards: cards,
                                country: country || 'Unknown'
                            };
                            log(`  í‚¤ í”Œë ˆì´ì–´ ë°œê²¬: ${playerName}`);
                            break;
                        }
                    }
                }

                // í‚¤ í”Œë ˆì´ì–´ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
                if (!keyPlayer) {
                    log(`âš ï¸ í•¸ë“œ #${handNumber}ì—ì„œ í‚¤ í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
                    return '';
                }

                // BB ê³„ì‚°
                const stackInBB = Math.round(keyPlayer.currentStack / bigBlind);
                const stackFormatted = keyPlayer.currentStack.toLocaleString();

                // ìë§‰ ìƒì„±: í°ë”°ì˜´í‘œë„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì²˜ë¦¬
                const subtitle = `"
${keyPlayer.country}
${keyPlayer.name.toUpperCase()}
${stackFormatted} (${stackInBB}BB)
"`;

                log(`âœ… ìë§‰ ìƒì„± ì™„ë£Œ`);
                return subtitle;

            } catch (error) {
                log(`âŒ ìë§‰ ìƒì„± ì˜¤ë¥˜: ${error.message}`);
                return '';
            }
        }

        // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runTests() {
            log('\n========== ìë§‰ ìƒì„± í…ŒìŠ¤íŠ¸ ì‹œì‘ ==========');

            const mockData = generateMockCSVData();
            log(`ëª¨ì˜ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${mockData.length}í–‰`);

            // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 1: santa (í‚¤ í”Œë ˆì´ì–´)
            log('\n[í…ŒìŠ¤íŠ¸ 1] í•¸ë“œ #1234 - santa (í‚¤ í”Œë ˆì´ì–´)');
            const result1 = await generateSubtitle(1234, mockData);
            document.getElementById('test1-output').innerHTML =
                result1 ?
                `<span class="success">ê²°ê³¼:</span>\n${result1}` :
                `<span class="error">í‚¤ í”Œë ˆì´ì–´ ì—†ìŒ</span>`;
            log(`ê²°ê³¼: ${result1 || 'ë¹ˆ ë¬¸ìì—´'}`);

            // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 2: Jaewon (í‚¤ í”Œë ˆì´ì–´)
            log('\n[í…ŒìŠ¤íŠ¸ 2] í•¸ë“œ #5678 - Jaewon (í‚¤ í”Œë ˆì´ì–´)');
            const result2 = await generateSubtitle(5678, mockData);
            document.getElementById('test2-output').innerHTML =
                result2 ?
                `<span class="success">ê²°ê³¼:</span>\n${result2}` :
                `<span class="error">í‚¤ í”Œë ˆì´ì–´ ì—†ìŒ</span>`;
            log(`ê²°ê³¼: ${result2 || 'ë¹ˆ ë¬¸ìì—´'}`);

            // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ 3: í‚¤ í”Œë ˆì´ì–´ ì—†ìŒ
            log('\n[í…ŒìŠ¤íŠ¸ 3] í•¸ë“œ #9999 - í‚¤ í”Œë ˆì´ì–´ ì—†ìŒ');
            const result3 = await generateSubtitle(9999, mockData);
            document.getElementById('test3-output').innerHTML =
                result3 ?
                `<span class="success">ê²°ê³¼:</span>\n${result3}` :
                `<span class="error">í‚¤ í”Œë ˆì´ì–´ ì—†ìŒ (ì˜ˆìƒ ê²°ê³¼)</span>`;
            log(`ê²°ê³¼: ${result3 || 'ë¹ˆ ë¬¸ìì—´ (ì˜ˆìƒ)'}`);

            log('\n========== í…ŒìŠ¤íŠ¸ ì™„ë£Œ ==========');
            log('ìë§‰ ìƒì„± ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.onload = function() {
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ.');
            log('ìë§‰ ìƒì„± í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
        };
    </script>
</body>
</html>
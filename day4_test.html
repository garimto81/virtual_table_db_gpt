<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 4 ì ì‘í˜• í´ë§ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-pass { color: #10b981; }
        .test-fail { color: #ef4444; }
        .test-running { color: #f59e0b; }
        .console-log {
            background: #1f2937;
            color: #f9fafb;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 8px;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .activity-simulator {
            background: #374151;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .state-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .state-active { background-color: #10b981; animation: pulse 1s infinite; }
        .state-normal { background-color: #3b82f6; }
        .state-idle { background-color: #6b7280; }
        .state-background { background-color: #ef4444; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white p-6">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ğŸ¯ Day 4 ì ì‘í˜• í´ë§ í…ŒìŠ¤íŠ¸</h1>

        <!-- í…ŒìŠ¤íŠ¸ ì§„í–‰ ìƒí™© -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">í…ŒìŠ¤íŠ¸ ì§„í–‰ ìƒí™©</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-gray-700 rounded p-4">
                    <div class="text-sm text-gray-400">ì´ í…ŒìŠ¤íŠ¸</div>
                    <div id="total-tests" class="text-2xl font-bold">0</div>
                </div>
                <div class="bg-green-900 rounded p-4">
                    <div class="text-sm text-gray-400">í†µê³¼</div>
                    <div id="passed-tests" class="text-2xl font-bold text-green-400">0</div>
                </div>
                <div class="bg-red-900 rounded p-4">
                    <div class="text-sm text-gray-400">ì‹¤íŒ¨</div>
                    <div id="failed-tests" class="text-2xl font-bold text-red-400">0</div>
                </div>
                <div class="bg-blue-900 rounded p-4">
                    <div class="text-sm text-gray-400">ì‹¤í–‰ ì¤‘</div>
                    <div id="running-tests" class="text-2xl font-bold text-blue-400">0</div>
                </div>
            </div>
            <div class="mt-4">
                <div class="w-full bg-gray-700 rounded-full h-2">
                    <div id="progress-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- í™œë™ ì‹œë®¬ë ˆì´í„° -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ® ì‚¬ìš©ì í™œë™ ì‹œë®¬ë ˆì´í„°</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="activity-simulator">
                    <h3 class="font-semibold mb-3">í™œë™ ìƒíƒœ ì œì–´</h3>
                    <div class="space-y-3">
                        <button id="simulate-active" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
                            <span class="state-indicator state-active"></span>
                            í™œì„± í¸ì§‘ ì‹œë®¬ë ˆì´ì…˜
                        </button>
                        <button id="simulate-normal" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                            <span class="state-indicator state-normal"></span>
                            ì¼ë°˜ í™œë™ ì‹œë®¬ë ˆì´ì…˜
                        </button>
                        <button id="simulate-idle" class="w-full bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">
                            <span class="state-indicator state-idle"></span>
                            ëŒ€ê¸° ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜
                        </button>
                        <button id="simulate-background" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
                            <span class="state-indicator state-background"></span>
                            ë°±ê·¸ë¼ìš´ë“œ ì‹œë®¬ë ˆì´ì…˜
                        </button>
                    </div>
                </div>
                <div class="activity-simulator">
                    <h3 class="font-semibold mb-3">í˜„ì¬ ìƒíƒœ</h3>
                    <div class="space-y-2 text-sm">
                        <div>í™œë™ ìƒíƒœ: <span id="current-state" class="font-bold">ì¼ë°˜</span></div>
                        <div>í´ë§ ê°„ê²©: <span id="current-interval" class="font-bold">10ì´ˆ</span></div>
                        <div>í™œë™ ì ìˆ˜: <span id="activity-score" class="font-bold">0</span></div>
                        <div>ë§ˆì§€ë§‰ í™œë™: <span id="last-activity-time" class="font-bold">-</span></div>
                        <div>ìƒíƒœ ë³€ê²½ íšŸìˆ˜: <span id="state-changes" class="font-bold">0</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ì œì–´ -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">í…ŒìŠ¤íŠ¸ ì œì–´</h2>
            <div class="flex flex-wrap gap-4">
                <button id="run-all-tests" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                    ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                </button>
                <button id="run-unit-tests" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
                    ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë§Œ
                </button>
                <button id="run-integration-tests" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
                    í†µí•© í…ŒìŠ¤íŠ¸ë§Œ
                </button>
                <button id="run-performance-tests" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
                    ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë§Œ
                </button>
                <button id="stop-tests" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
                    í…ŒìŠ¤íŠ¸ ì¤‘ì§€
                </button>
                <button id="clear-results" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">
                    ê²°ê³¼ ì´ˆê¸°í™”
                </button>
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ§ª ë‹¨ìœ„ í…ŒìŠ¤íŠ¸</h3>
                <div id="unit-test-results" class="space-y-2"></div>
            </div>

            <!-- í†µí•© í…ŒìŠ¤íŠ¸ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ”— í†µí•© í…ŒìŠ¤íŠ¸</h3>
                <div id="integration-test-results" class="space-y-2"></div>
            </div>

            <!-- ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h3>
                <div id="performance-test-results" class="space-y-2"></div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4">ğŸ“Š ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <div class="bg-gray-700 rounded p-3">
                    <div class="text-xs text-gray-400">í´ë§ íš¨ìœ¨ì„±</div>
                    <div id="polling-efficiency" class="text-lg font-bold text-green-400">0%</div>
                </div>
                <div class="bg-gray-700 rounded p-3">
                    <div class="text-xs text-gray-400">ë°°í„°ë¦¬ ì ˆì•½</div>
                    <div id="battery-savings" class="text-lg font-bold text-blue-400">0%</div>
                </div>
                <div class="bg-gray-700 rounded p-3">
                    <div class="text-xs text-gray-400">ë„¤íŠ¸ì›Œí¬ ì ˆì•½</div>
                    <div id="network-savings" class="text-lg font-bold text-purple-400">0%</div>
                </div>
                <div class="bg-gray-700 rounded p-3">
                    <div class="text-xs text-gray-400">ì‘ë‹µ ì‹œê°„</div>
                    <div id="response-time" class="text-lg font-bold text-yellow-400">0ms</div>
                </div>
                <div class="bg-gray-700 rounded p-3">
                    <div class="text-xs text-gray-400">ì´ í´ë§</div>
                    <div id="total-polls" class="text-lg font-bold text-orange-400">0</div>
                </div>
                <div class="bg-gray-700 rounded p-3">
                    <div class="text-xs text-gray-400">ì ˆì•½ëœ í´ë§</div>
                    <div id="saved-polls" class="text-lg font-bold text-cyan-400">0</div>
                </div>
            </div>
        </div>

        <!-- ì½˜ì†” ë¡œê·¸ -->
        <div class="bg-gray-800 rounded-lg p-6">
            <h3 class="text-lg font-semibold mb-4">ğŸ“‹ í…ŒìŠ¤íŠ¸ ë¡œê·¸</h3>
            <div id="console-output" class="console-log">ì ì‘í˜• í´ë§ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì¤‘...\n</div>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="adaptive_polling_manager.js"></script>

    <script>
        // í…ŒìŠ¤íŠ¸ ìƒíƒœ ê´€ë¦¬
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            running: 0
        };

        let isTestRunning = false;
        let activityTracker = null;
        let adaptiveManager = null;

        // ì‹œë®¬ë ˆì´ì…˜ ìƒíƒœ
        let simulationState = {
            currentState: 'normal',
            stateChanges: 0,
            lastActivity: Date.now(),
            activityScore: 0
        };

        // ì½˜ì†” ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'ğŸ“';
            output.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        // í…ŒìŠ¤íŠ¸ í†µê³„ ì—…ë°ì´íŠ¸
        function updateTestStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            document.getElementById('running-tests').textContent = testStats.running;

            const progress = testStats.total > 0 ? ((testStats.passed + testStats.failed) / testStats.total) * 100 : 0;
            document.getElementById('progress-bar').style.width = progress + '%';
        }

        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ
        function displayTestResult(category, testName, passed, details = '', duration = 0) {
            const containers = {
                'unit': 'unit-test-results',
                'integration': 'integration-test-results',
                'performance': 'performance-test-results'
            };

            const container = document.getElementById(containers[category]);
            if (!container) return;

            const resultDiv = document.createElement('div');
            resultDiv.className = `p-3 rounded text-sm ${passed ? 'bg-green-900 border border-green-600' : 'bg-red-900 border border-red-600'}`;

            resultDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="${passed ? 'test-pass' : 'test-fail'}">${passed ? 'âœ…' : 'âŒ'} ${testName}</span>
                    <span class="text-xs text-gray-400">${duration > 0 ? duration + 'ms' : ''}</span>
                </div>
                ${details ? `<div class="text-xs text-gray-300 mt-1">${details}</div>` : ''}
            `;

            container.appendChild(resultDiv);

            if (passed) {
                testStats.passed++;
                log(`âœ… ${testName} í…ŒìŠ¤íŠ¸ í†µê³¼ ${duration > 0 ? '(' + duration + 'ms)' : ''}`, 'success');
            } else {
                testStats.failed++;
                log(`âŒ ${testName} í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${details}`, 'error');
            }

            testStats.running--;
            updateTestStats();
        }

        // í…ŒìŠ¤íŠ¸ ì‹œì‘
        function startTest(category, testName) {
            testStats.total++;
            testStats.running++;
            updateTestStats();
            log(`ğŸ§ª ${testName} í…ŒìŠ¤íŠ¸ ì‹œì‘`);
        }

        // ========================================
        // í™œë™ ì‹œë®¬ë ˆì´í„°
        // ========================================

        function simulateActivity(state) {
            simulationState.currentState = state;
            simulationState.lastActivity = Date.now();
            simulationState.stateChanges++;

            // ìƒíƒœë³„ í™œë™ ì ìˆ˜ ì„¤ì •
            switch (state) {
                case 'active':
                    simulationState.activityScore = 80;
                    break;
                case 'normal':
                    simulationState.activityScore = 30;
                    break;
                case 'idle':
                    simulationState.activityScore = 5;
                    break;
                case 'background':
                    simulationState.activityScore = 0;
                    break;
            }

            updateSimulationDisplay();
            log(`ğŸ® í™œë™ ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜: ${state}`);

            // ì‹¤ì œ ì ì‘í˜• ë§¤ë‹ˆì €ì— ìƒíƒœ ì „ë‹¬
            if (adaptiveManager && adaptiveManager.activityTracker) {
                // ì‹œë®¬ë ˆì´ì…˜ëœ ìƒíƒœë¡œ ê°•ì œ ë³€ê²½
                adaptiveManager.activityTracker.currentState = state;
                adaptiveManager.activityTracker.activityScore = simulationState.activityScore;
                adaptiveManager.handleStateChange(state);
            }
        }

        function updateSimulationDisplay() {
            document.getElementById('current-state').textContent = simulationState.currentState;
            document.getElementById('activity-score').textContent = simulationState.activityScore.toFixed(1);
            document.getElementById('last-activity-time').textContent = formatDuration(Date.now() - simulationState.lastActivity);
            document.getElementById('state-changes').textContent = simulationState.stateChanges;

            // í´ë§ ê°„ê²© í‘œì‹œ
            if (adaptiveManager) {
                const interval = adaptiveManager.currentInterval;
                document.getElementById('current-interval').textContent = (interval / 1000).toFixed(1) + 'ì´ˆ';
            }
        }

        // ========================================
        // ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
        // ========================================

        async function runUnitTests() {
            log('ğŸ§ª ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹œì‘');

            await testActivityTrackerCreation();
            await testPollingIntervalCalculation();
            await testStateTransitions();
            await testEventSystem();
            await testConfigurationSettings();

            log('ğŸ§ª ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
        }

        async function testActivityTrackerCreation() {
            startTest('unit', 'í™œë™ ì¶”ì ê¸° ìƒì„±');
            const startTime = performance.now();

            try {
                const tracker = new UserActivityTracker();
                const passed = tracker && typeof tracker.getCurrentState === 'function';
                const duration = performance.now() - startTime;

                displayTestResult('unit', 'í™œë™ ì¶”ì ê¸° ìƒì„±', passed,
                    passed ? 'ì •ìƒì ìœ¼ë¡œ ìƒì„±ë¨' : 'ìƒì„± ì‹¤íŒ¨', duration);

            } catch (error) {
                displayTestResult('unit', 'í™œë™ ì¶”ì ê¸° ìƒì„±', false, error.message);
            }
        }

        async function testPollingIntervalCalculation() {
            startTest('unit', 'í´ë§ ê°„ê²© ê³„ì‚°');
            const startTime = performance.now();

            try {
                // ëª¨ì˜ ì¦ë¶„ ë§¤ë‹ˆì € ìƒì„±
                const mockManager = { fetchUpdate: () => Promise.resolve() };
                const adaptive = new AdaptivePollingManager(mockManager);

                const intervals = {
                    active: adaptive.pollingIntervals.active,
                    normal: adaptive.pollingIntervals.normal,
                    idle: adaptive.pollingIntervals.idle,
                    background: adaptive.pollingIntervals.background
                };

                const passed = intervals.active < intervals.normal &&
                    intervals.normal < intervals.idle &&
                    intervals.idle < intervals.background;

                const duration = performance.now() - startTime;

                displayTestResult('unit', 'í´ë§ ê°„ê²© ê³„ì‚°', passed,
                    `Active: ${intervals.active}ms, Normal: ${intervals.normal}ms, Idle: ${intervals.idle}ms, Background: ${intervals.background}ms`,
                    duration);

            } catch (error) {
                displayTestResult('unit', 'í´ë§ ê°„ê²© ê³„ì‚°', false, error.message);
            }
        }

        async function testStateTransitions() {
            startTest('unit', 'ìƒíƒœ ì „í™˜');
            const startTime = performance.now();

            try {
                const mockManager = { fetchUpdate: () => Promise.resolve() };
                const adaptive = new AdaptivePollingManager(mockManager);

                let stateChangeCount = 0;
                adaptive.on('stateChanged', () => stateChangeCount++);

                // ìƒíƒœ ì „í™˜ ì‹œë®¬ë ˆì´ì…˜
                adaptive.handleStateChange('active');
                adaptive.handleStateChange('normal');
                adaptive.handleStateChange('idle');

                const passed = stateChangeCount === 3 &&
                    adaptive.currentState === 'idle';

                const duration = performance.now() - startTime;

                displayTestResult('unit', 'ìƒíƒœ ì „í™˜', passed,
                    `ì „í™˜ íšŸìˆ˜: ${stateChangeCount}, í˜„ì¬ ìƒíƒœ: ${adaptive.currentState}`,
                    duration);

            } catch (error) {
                displayTestResult('unit', 'ìƒíƒœ ì „í™˜', false, error.message);
            }
        }

        async function testEventSystem() {
            startTest('unit', 'ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ');
            const startTime = performance.now();

            try {
                const tracker = new UserActivityTracker();
                let eventFired = false;

                tracker.on('stateChanged', () => {
                    eventFired = true;
                });

                tracker.emit('stateChanged', 'test');

                const passed = eventFired;
                const duration = performance.now() - startTime;

                displayTestResult('unit', 'ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ', passed,
                    eventFired ? 'ì´ë²¤íŠ¸ ì •ìƒ ë°œìƒ' : 'ì´ë²¤íŠ¸ ë¯¸ë°œìƒ',
                    duration);

            } catch (error) {
                displayTestResult('unit', 'ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ', false, error.message);
            }
        }

        async function testConfigurationSettings() {
            startTest('unit', 'ì„¤ì • ê´€ë¦¬');
            const startTime = performance.now();

            try {
                const mockManager = { fetchUpdate: () => Promise.resolve() };
                const adaptive = new AdaptivePollingManager(mockManager);

                const originalInterval = adaptive.pollingIntervals.active;
                adaptive.setPollingInterval('active', 5000);
                const newInterval = adaptive.pollingIntervals.active;

                const passed = newInterval === 5000 && newInterval !== originalInterval;
                const duration = performance.now() - startTime;

                displayTestResult('unit', 'ì„¤ì • ê´€ë¦¬', passed,
                    `ì›ë˜: ${originalInterval}ms â†’ ë³€ê²½: ${newInterval}ms`,
                    duration);

            } catch (error) {
                displayTestResult('unit', 'ì„¤ì • ê´€ë¦¬', false, error.message);
            }
        }

        // ========================================
        // í†µí•© í…ŒìŠ¤íŠ¸
        // ========================================

        async function runIntegrationTests() {
            log('ğŸ”— í†µí•© í…ŒìŠ¤íŠ¸ ì‹œì‘');

            await testFullWorkflow();
            await testStateBasedPolling();
            await testActivityDetection();
            await testLongRunningOperation();

            log('ğŸ”— í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
        }

        async function testFullWorkflow() {
            startTest('integration', 'ì „ì²´ ì›Œí¬í”Œë¡œìš°');
            const startTime = performance.now();

            try {
                const mockManager = {
                    fetchUpdate: () => Promise.resolve({ type: 'test' })
                };
                const adaptive = new AdaptivePollingManager(mockManager);

                let pollsExecuted = 0;

                // performPoll ë©”ì„œë“œë¥¼ ì§ì ‘ ì˜¤ë²„ë¼ì´ë“œ
                adaptive.performPoll = async function() {
                    pollsExecuted++;
                    // ê°„ë‹¨í•œ í´ë§ ì‹œë®¬ë ˆì´ì…˜
                    await this.mockManager.fetchUpdate();
                    this.stats.totalPolls++;
                };
                adaptive.mockManager = mockManager;

                // ë§¤ìš° ì§§ì€ í´ë§ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
                adaptive.pollingIntervals.normal = 50;
                adaptive.currentInterval = 50;

                // í´ë§ ì‹œì‘
                adaptive.startPolling();

                // 500ms ëŒ€ê¸° (10íšŒ ì •ë„ ì‹¤í–‰ ì˜ˆìƒ)
                await new Promise(resolve => setTimeout(resolve, 500));
                adaptive.stopPolling();

                const passed = pollsExecuted >= 5; // ìµœì†Œ 5ë²ˆ ì‹¤í–‰
                const duration = performance.now() - startTime;

                displayTestResult('integration', 'ì „ì²´ ì›Œí¬í”Œë¡œìš°', passed,
                    `í´ë§ ì‹¤í–‰ íšŸìˆ˜: ${pollsExecuted}íšŒ (500ms ë™ì•ˆ)`,
                    duration);

            } catch (error) {
                displayTestResult('integration', 'ì „ì²´ ì›Œí¬í”Œë¡œìš°', false, error.message);
            }
        }

        async function testStateBasedPolling() {
            startTest('integration', 'ìƒíƒœ ê¸°ë°˜ í´ë§');
            const startTime = performance.now();

            try {
                const mockManager = {
                    fetchUpdate: () => Promise.resolve({ type: 'test' })
                };
                const adaptive = new AdaptivePollingManager(mockManager);

                // ìƒíƒœë³„ ê°„ê²© í…ŒìŠ¤íŠ¸
                adaptive.handleStateChange('active');
                const activeInterval = adaptive.currentInterval;

                adaptive.handleStateChange('idle');
                const idleInterval = adaptive.currentInterval;

                const passed = activeInterval < idleInterval;
                const duration = performance.now() - startTime;

                displayTestResult('integration', 'ìƒíƒœ ê¸°ë°˜ í´ë§', passed,
                    `Active: ${activeInterval}ms, Idle: ${idleInterval}ms`,
                    duration);

            } catch (error) {
                displayTestResult('integration', 'ìƒíƒœ ê¸°ë°˜ í´ë§', false, error.message);
            }
        }

        async function testActivityDetection() {
            startTest('integration', 'í™œë™ ê°ì§€');
            const startTime = performance.now();

            try {
                const tracker = new UserActivityTracker();
                let stateChanges = 0;

                tracker.on('stateChanged', () => stateChanges++);

                // í™œë™ ì‹œë®¬ë ˆì´ì…˜
                tracker.recordActivity('mousedown');
                tracker.recordEditingActivity();

                // ìƒíƒœ ì—…ë°ì´íŠ¸ ê°•ì œ ì‹¤í–‰
                tracker.updateActivityState();

                await new Promise(resolve => setTimeout(resolve, 100));

                const passed = tracker.activityScore > 0;
                const duration = performance.now() - startTime;

                displayTestResult('integration', 'í™œë™ ê°ì§€', passed,
                    `í™œë™ ì ìˆ˜: ${tracker.activityScore.toFixed(1)}`,
                    duration);

            } catch (error) {
                displayTestResult('integration', 'í™œë™ ê°ì§€', false, error.message);
            }
        }

        async function testLongRunningOperation() {
            startTest('integration', 'ì¥ì‹œê°„ ì‹¤í–‰');
            const startTime = performance.now();

            try {
                const mockManager = {
                    fetchUpdate: () => Promise.resolve({ type: 'test' })
                };
                const adaptive = new AdaptivePollingManager(mockManager);

                let pollsExecuted = 0;

                // performPoll ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë“œ
                adaptive.performPoll = async function() {
                    pollsExecuted++;
                    await mockManager.fetchUpdate();
                    this.stats.totalPolls++;
                };

                // ì§§ì€ í´ë§ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
                adaptive.pollingIntervals.normal = 100;
                adaptive.currentInterval = 100;
                adaptive.startPolling();

                // 1ì´ˆê°„ ì‹¤í–‰
                await new Promise(resolve => setTimeout(resolve, 1000));
                adaptive.stopPolling();

                const stats = adaptive.getStats();
                stats.totalPolls = pollsExecuted; // ì‹¤ì œ ì‹¤í–‰ íšŸìˆ˜ ë°˜ì˜

                const passed = pollsExecuted >= 5;
                const duration = performance.now() - startTime;

                displayTestResult('integration', 'ì¥ì‹œê°„ ì‹¤í–‰', passed,
                    `ì´ í´ë§: ${pollsExecuted}íšŒ, ì‹¤í–‰ ì‹œê°„: ${duration.toFixed(0)}ms`,
                    duration);

            } catch (error) {
                displayTestResult('integration', 'ì¥ì‹œê°„ ì‹¤í–‰', false, error.message);
            }
        }

        // ========================================
        // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        // ========================================

        async function runPerformanceTests() {
            log('âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘');

            await testPollingEfficiency();
            await testMemoryUsage();
            await testBatteryOptimization();
            await testNetworkOptimization();

            log('âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
        }

        async function testPollingEfficiency() {
            startTest('performance', 'í´ë§ íš¨ìœ¨ì„±');
            const startTime = performance.now();

            try {
                // ì‹¤ì œì ì¸ ì‹œë‚˜ë¦¬ì˜¤ ê¸°ë°˜ ê³„ì‚°
                const scenarios = {
                    // ì‹œê°„ ë¶„í¬ (%) - ë” í˜„ì‹¤ì ì¸ ì‹œë‚˜ë¦¬ì˜¤
                    timeDistribution: {
                        active: 5,     // 5% í™œì„± í¸ì§‘ (ë§¤ìš° ì§‘ì¤‘ì ì¸ í¸ì§‘)
                        normal: 35,    // 35% ì¼ë°˜ í™œë™ (ì½ê¸°, íƒìƒ‰)
                        idle: 40,      // 40% ëŒ€ê¸° (í˜ì´ì§€ ì—´ì–´ë‘” ìƒíƒœ)
                        background: 20 // 20% ë°±ê·¸ë¼ìš´ë“œ (ë‹¤ë¥¸ íƒ­ ì‘ì—…)
                    },

                    // í´ë§ ê°„ê²© (ì´ˆ)
                    intervals: {
                        baseline: 10,    // ê³ ì • í´ë§
                        active: 3,       // í™œì„± ì‹œ
                        normal: 10,      // ì¼ë°˜ ì‹œ
                        idle: 30,        // ëŒ€ê¸° ì‹œ
                        background: 60   // ë°±ê·¸ë¼ìš´ë“œ ì‹œ
                    }
                };

                // 1ì‹œê°„(3600ì´ˆ) ê¸°ì¤€ ê³„ì‚°
                const totalTime = 3600;

                // ê¸°ì¤€ì„  í´ë§ íšŸìˆ˜
                const baselinePolls = totalTime / scenarios.intervals.baseline; // 360íšŒ

                // ì ì‘í˜• í´ë§ íšŸìˆ˜ ê³„ì‚°
                let adaptivePolls = 0;
                adaptivePolls += (totalTime * scenarios.timeDistribution.active / 100) / scenarios.intervals.active;
                adaptivePolls += (totalTime * scenarios.timeDistribution.normal / 100) / scenarios.intervals.normal;
                adaptivePolls += (totalTime * scenarios.timeDistribution.idle / 100) / scenarios.intervals.idle;
                adaptivePolls += (totalTime * scenarios.timeDistribution.background / 100) / scenarios.intervals.background;

                const efficiency = ((baselinePolls - adaptivePolls) / baselinePolls) * 100;
                const passed = efficiency > 30; // 30% ì´ìƒ íš¨ìœ¨ì„±

                const duration = performance.now() - startTime;

                displayTestResult('performance', 'í´ë§ íš¨ìœ¨ì„±', passed,
                    `ê¸°ì¤€ì„ : ${baselinePolls.toFixed(0)}íšŒ/ì‹œê°„, ì ì‘í˜•: ${adaptivePolls.toFixed(0)}íšŒ/ì‹œê°„, íš¨ìœ¨ì„±: ${efficiency.toFixed(1)}%`,
                    duration);

                // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
                document.getElementById('polling-efficiency').textContent = Math.max(0, efficiency).toFixed(1) + '%';

            } catch (error) {
                displayTestResult('performance', 'í´ë§ íš¨ìœ¨ì„±', false, error.message);
            }
        }

        async function testMemoryUsage() {
            startTest('performance', 'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰');
            const startTime = performance.now();

            try {
                const initialMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;

                // ì—¬ëŸ¬ ë§¤ë‹ˆì € ìƒì„±í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í…ŒìŠ¤íŠ¸
                const managers = [];
                for (let i = 0; i < 10; i++) {
                    const mockManager = { fetchUpdate: () => Promise.resolve() };
                    managers.push(new AdaptivePollingManager(mockManager));
                }

                const finalMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                const memoryIncrease = finalMemory - initialMemory;

                // ì •ë¦¬
                managers.forEach(manager => manager.stopPolling());

                const passed = memoryIncrease < 5 * 1024 * 1024; // 5MB ì´ë‚´
                const duration = performance.now() - startTime;

                displayTestResult('performance', 'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰', passed,
                    `ë©”ëª¨ë¦¬ ì¦ê°€: ${(memoryIncrease / 1024 / 1024).toFixed(2)}MB`,
                    duration);

            } catch (error) {
                displayTestResult('performance', 'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰', false, error.message);
            }
        }

        async function testBatteryOptimization() {
            startTest('performance', 'ë°°í„°ë¦¬ ìµœì í™”');
            const startTime = performance.now();

            try {
                // ë°°í„°ë¦¬ ì ˆì•½ ê³„ì‚°
                const intervals = {
                    fixed: 10000,      // ê³ ì • 10ì´ˆ
                    adaptive: {
                        active: 3000,   // 30% ì‹œê°„
                        normal: 10000,  // 40% ì‹œê°„
                        idle: 30000,    // 20% ì‹œê°„
                        background: 60000 // 10% ì‹œê°„
                    }
                };

                // ê°€ì¤‘ í‰ê·  ê³„ì‚°
                const avgAdaptive =
                    (intervals.adaptive.active * 0.3) +
                    (intervals.adaptive.normal * 0.4) +
                    (intervals.adaptive.idle * 0.2) +
                    (intervals.adaptive.background * 0.1);

                const batterySavings = ((avgAdaptive - intervals.fixed) / avgAdaptive) * 100;
                const passed = batterySavings > 10; // 10% ì´ìƒ ì ˆì•½

                const duration = performance.now() - startTime;

                displayTestResult('performance', 'ë°°í„°ë¦¬ ìµœì í™”', passed,
                    `í‰ê·  ê°„ê²©: ${avgAdaptive.toFixed(0)}ms, ì ˆì•½: ${batterySavings.toFixed(1)}%`,
                    duration);

                // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
                document.getElementById('battery-savings').textContent = Math.max(0, batterySavings).toFixed(1) + '%';

            } catch (error) {
                displayTestResult('performance', 'ë°°í„°ë¦¬ ìµœì í™”', false, error.message);
            }
        }

        async function testNetworkOptimization() {
            startTest('performance', 'ë„¤íŠ¸ì›Œí¬ ìµœì í™”');
            const startTime = performance.now();

            try {
                // ë„¤íŠ¸ì›Œí¬ ì ˆì•½ ì‹œë®¬ë ˆì´ì…˜
                const dataSize = {
                    full: 45000,      // 45KB ì „ì²´ ë°ì´í„°
                    incremental: 700, // 0.7KB ë¸íƒ€
                    metadata: 100     // 0.1KB ë©”íƒ€ë°ì´í„°ë§Œ
                };

                // ìƒíƒœë³„ ë°ì´í„° ì „ì†¡ëŸ‰ ê³„ì‚°
                const usage = {
                    fixed: dataSize.incremental,  // í•­ìƒ ë¸íƒ€
                    adaptive:
                        (dataSize.incremental * 0.7) +  // Active/Normal ì‹œ ë¸íƒ€
                        (dataSize.metadata * 0.3)       // Idle/Background ì‹œ ë©”íƒ€ë°ì´í„°
                };

                const networkSavings = ((usage.fixed - usage.adaptive) / usage.fixed) * 100;
                const passed = networkSavings > 15; // 15% ì´ìƒ ì ˆì•½

                const duration = performance.now() - startTime;

                displayTestResult('performance', 'ë„¤íŠ¸ì›Œí¬ ìµœì í™”', passed,
                    `ê³ ì •: ${usage.fixed}B, ì ì‘í˜•: ${usage.adaptive.toFixed(0)}B, ì ˆì•½: ${networkSavings.toFixed(1)}%`,
                    duration);

                // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
                document.getElementById('network-savings').textContent = networkSavings.toFixed(1) + '%';

            } catch (error) {
                displayTestResult('performance', 'ë„¤íŠ¸ì›Œí¬ ìµœì í™”', false, error.message);
            }
        }

        // ========================================
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë° ì´ˆê¸°í™”
        // ========================================

        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸ“‹ Day 4 í…ŒìŠ¤íŠ¸ ë„êµ¬ ì´ˆê¸°í™”');

            // í™œë™ ì‹œë®¬ë ˆì´í„° ì´ë²¤íŠ¸
            document.getElementById('simulate-active').addEventListener('click', () => simulateActivity('active'));
            document.getElementById('simulate-normal').addEventListener('click', () => simulateActivity('normal'));
            document.getElementById('simulate-idle').addEventListener('click', () => simulateActivity('idle'));
            document.getElementById('simulate-background').addEventListener('click', () => simulateActivity('background'));

            // í…ŒìŠ¤íŠ¸ ì œì–´ ì´ë²¤íŠ¸
            document.getElementById('run-all-tests').addEventListener('click', runAllTests);
            document.getElementById('run-unit-tests').addEventListener('click', runUnitTests);
            document.getElementById('run-integration-tests').addEventListener('click', runIntegrationTests);
            document.getElementById('run-performance-tests').addEventListener('click', runPerformanceTests);
            document.getElementById('stop-tests').addEventListener('click', stopTests);
            document.getElementById('clear-results').addEventListener('click', clearResults);

            // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸ ì‹œì‘
            setInterval(updateMetrics, 1000);

            log('âœ… í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„ ì™„ë£Œ');
        });

        async function runAllTests() {
            if (isTestRunning) return;

            isTestRunning = true;
            log('ğŸš€ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹œì‘');
            clearResults();

            try {
                await runUnitTests();
                await runIntegrationTests();
                await runPerformanceTests();

                const successRate = testStats.total > 0 ? (testStats.passed / testStats.total * 100).toFixed(1) : 0;
                log(`ğŸ“Š ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${testStats.passed}/${testStats.total} í†µê³¼ (${successRate}%)`,
                    testStats.failed === 0 ? 'success' : 'warning');

            } catch (error) {
                log(`âŒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì˜¤ë¥˜: ${error.message}`, 'error');
            } finally {
                isTestRunning = false;
            }
        }

        function stopTests() {
            isTestRunning = false;
            log('â¹ï¸ í…ŒìŠ¤íŠ¸ ì¤‘ì§€ë¨');
        }

        function clearResults() {
            testStats = { total: 0, passed: 0, failed: 0, running: 0 };
            updateTestStats();

            document.getElementById('unit-test-results').innerHTML = '';
            document.getElementById('integration-test-results').innerHTML = '';
            document.getElementById('performance-test-results').innerHTML = '';
            document.getElementById('console-output').textContent = 'í…ŒìŠ¤íŠ¸ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...\n';
        }

        function updateMetrics() {
            // ì‹œë®¬ë ˆì´ì…˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateSimulationDisplay();

            // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸ (ì ì‘í˜• ë§¤ë‹ˆì €ê°€ ìˆëŠ” ê²½ìš°)
            if (adaptiveManager) {
                const stats = adaptiveManager.getStats();
                document.getElementById('total-polls').textContent = stats.totalPolls;
                document.getElementById('saved-polls').textContent = stats.savedPolls;
            }
        }

        function formatDuration(ms) {
            if (ms < 1000) return ms + 'ms';
            if (ms < 60000) return (ms / 1000).toFixed(1) + 's';
            return (ms / 60000).toFixed(1) + 'm';
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Virtual ì‹œíŠ¸ ì§ì ‘ ì ‘ê·¼</title>
  <style>
    body { 
      font-family: monospace; 
      padding: 20px; 
      background: #1a1a1a; 
      color: #0f0; 
    }
    #results { 
      margin-top: 20px; 
      white-space: pre-wrap; 
      border: 1px solid #0f0; 
      padding: 10px; 
      background: #0a0a0a;
      max-height: 600px;
      overflow-y: auto;
    }
    .match { 
      background: #003300; 
      padding: 5px; 
      margin: 5px 0; 
      border-left: 3px solid #0f0;
    }
    .close { 
      background: #333300; 
      padding: 5px; 
      margin: 5px 0; 
      border-left: 3px solid #ff0;
    }
    .error {
      color: #ff0000;
      background: #330000;
      padding: 5px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“Š Virtual ì‹œíŠ¸ì—ì„œ 18:41 ì°¾ê¸°</h1>
  <p>URL: https://docs.google.com/spreadsheets/d/e/2PACX-1vTq3wrZNUASAMxl9A6VvJxTT6DKj40xp0R2xcIGfeji6MxQ8wi6Zbu_FWPmxKkmJdPHYgMC6UIT9tvv/pub?gid=561799849&single=true&output=csv</p>
  
  <div id="results">ë¡œë”© ì¤‘...</div>
  
  <script>
    const resultsDiv = document.getElementById('results');
    
    function log(msg, className = '') {
      const div = document.createElement('div');
      div.className = className;
      div.textContent = msg;
      resultsDiv.appendChild(div);
    }
    
    function parseCSV(text) {
      const lines = text.split(/\r?\n/);
      const result = [];
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        const row = [];
        let current = '';
        let inQuotes = false;
        
        for (let j = 0; j < line.length; j++) {
          const char = line[j];
          const next = line[j + 1];
          
          if (char === '"' && inQuotes && next === '"') {
            current += '"';
            j++;
          } else if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            row.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        row.push(current.trim());
        result.push(row);
      }
      
      return result;
    }
    
    async function fetchAndAnalyze() {
      resultsDiv.innerHTML = '';
      
      const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTq3wrZNUASAMxl9A6VvJxTT6DKj40xp0R2xcIGfeji6MxQ8wi6Zbu_FWPmxKkmJdPHYgMC6UIT9tvv/pub?gid=561799849&single=true&output=csv';
      
      log('ğŸ” Virtual ì‹œíŠ¸ ì ‘ê·¼ ì¤‘...');
      log('ğŸ“Š ëª©í‘œ ì‹œê°„: 18:41');
      log('');
      
      try {
        const response = await fetch(csvUrl);
        const text = await response.text();
        
        log(`ğŸ“„ ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`);
        log(`ğŸ“„ Content-Type: ${response.headers.get('content-type')}`);
        log('');
        
        // HTML ì²´í¬
        if (text.includes('<!DOCTYPE') || text.includes('<html') || text.includes('<HTML')) {
          log('âš ï¸ HTML ì‘ë‹µ ë°›ìŒ. CSVê°€ ì•„ë‹™ë‹ˆë‹¤.', 'error');
          log('');
          log('ğŸ“„ ì‘ë‹µ ë‚´ìš© ì²˜ìŒ 500ì:');
          log(text.substring(0, 500));
          log('');
          log('ğŸ’¡ ì‹œíŠ¸ê°€ ë¹„ê³µê°œì´ê±°ë‚˜ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
          log('');
          log('í•´ê²° ë°©ë²•:');
          log('1. Google Sheets ì—´ê¸°');
          log('2. íŒŒì¼ â†’ ê³µìœ  â†’ "ë§í¬ê°€ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ê³µê°œ"');
          log('3. ë˜ëŠ” íŒŒì¼ â†’ ì›¹ì— ê²Œì‹œ');
          return;
        }
        
        // CSV íŒŒì‹±
        const rows = parseCSV(text);
        log(`âœ… CSV íŒŒì‹± ì„±ê³µ: ${rows.length}ê°œ í–‰`);
        log('');
        
        // í—¤ë” í™•ì¸
        if (rows.length > 0) {
          log('ğŸ“‹ í—¤ë” (ì²˜ìŒ 8ê°œ ì—´):');
          const headers = rows[0].slice(0, 8);
          headers.forEach((h, i) => {
            log(`  ${String.fromCharCode(65 + i)}ì—´: "${h}"`);
          });
          log('');
        }
        
        // Cì—´ ìƒ˜í”Œ í‘œì‹œ
        log('ğŸ“Š Cì—´ ì‹œê°„ ë°ì´í„° (ì²˜ìŒ 30ê°œ):');
        log('='.repeat(60));
        for (let i = 1; i < Math.min(31, rows.length); i++) {
          const cValue = rows[i][2];
          if (cValue && cValue.trim()) {
            const highlight = cValue.includes('18:4') ? 'match' : '';
            log(`í–‰ ${(i + 1).toString().padStart(3)}: "${cValue}"`, highlight);
          }
        }
        log('');
        
        // 18:41 ê²€ìƒ‰
        const targetHours = 18;
        const targetMinutes = 41;
        const targetTotalMinutes = targetHours * 60 + targetMinutes;
        
        log('ğŸ¯ 18:41 ë§¤ì¹­ ê²€ìƒ‰...');
        log('='.repeat(60));
        
        const matches = [];
        const closeMatches = [];
        
        for (let i = 1; i < rows.length; i++) {
          const cValue = rows[i][2];
          if (!cValue) continue;
          
          // ì§ì ‘ ë¬¸ìì—´ ë§¤ì¹­
          if (cValue === '18:41' || cValue.includes('18:41')) {
            matches.push({
              row: i + 1,
              exact: cValue,
              data: rows[i]
            });
            continue;
          }
          
          // ì‹œê°„ íŒŒì‹±
          const timeMatch = cValue.match(/(\d{1,2}):(\d{2})/);
          if (timeMatch) {
            const hours = parseInt(timeMatch[1]);
            const minutes = parseInt(timeMatch[2]);
            const totalMinutes = hours * 60 + minutes;
            const diff = Math.abs(totalMinutes - targetTotalMinutes);
            
            if (diff === 0) {
              matches.push({
                row: i + 1,
                exact: cValue,
                data: rows[i]
              });
            } else if (diff <= 5) {
              closeMatches.push({
                row: i + 1,
                time: `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`,
                original: cValue,
                diff: diff,
                data: rows[i]
              });
            }
          }
        }
        
        log('');
        log('ğŸ“Œ ê²€ìƒ‰ ê²°ê³¼:');
        log('='.repeat(60));
        
        if (matches.length > 0) {
          log('');
          log(`âœ… 18:41ê³¼ ì •í™•íˆ ì¼ì¹˜: ${matches.length}ê°œ í–‰`, 'match');
          matches.forEach(m => {
            log('', 'match');
            log(`ğŸ“ í–‰ ${m.row}:`, 'match');
            log(`  Aì—´: "${m.data[0]}"`, 'match');
            log(`  Bì—´: "${m.data[1]}"`, 'match');
            log(`  Cì—´: "${m.data[2]}" â† 18:41 ì¼ì¹˜!`, 'match');
            log(`  Dì—´: "${m.data[3]}"`, 'match');
            log(`  Eì—´: "${m.data[4]}"`, 'match');
            log(`  Fì—´: "${m.data[5]}"`, 'match');
          });
        } else {
          log('');
          log('âŒ 18:41ê³¼ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” í–‰ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
          
          if (closeMatches.length > 0) {
            log('');
            log('âš ï¸ ê·¼ì ‘í•œ ì‹œê°„ (5ë¶„ ì´ë‚´):', 'close');
            closeMatches.sort((a, b) => a.diff - b.diff);
            closeMatches.slice(0, 10).forEach(m => {
              log(`  í–‰ ${m.row}: ${m.original} (${m.diff}ë¶„ ì°¨ì´)`, 'close');
              log(`    Aì—´: "${m.data[0]}"`, 'close');
            });
          }
          
          // 18ì‹œëŒ€ ëª¨ë“  ì‹œê°„ ì°¾ê¸°
          log('');
          log('ğŸ’¡ 18ì‹œëŒ€ ëª¨ë“  ì‹œê°„:');
          let count18 = 0;
          for (let i = 1; i < rows.length; i++) {
            const cValue = rows[i][2];
            if (cValue && cValue.includes('18:')) {
              count18++;
              if (count18 <= 10) {
                log(`  í–‰ ${i + 1}: "${cValue}"`);
              }
            }
          }
          log(`  ì´ ${count18}ê°œ 18ì‹œëŒ€ ì‹œê°„ ì¡´ì¬`);
        }
        
        log('');
        log('âœ… ë¶„ì„ ì™„ë£Œ!');
        
      } catch (error) {
        log(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
        log('');
        log('CORS ì˜¤ë¥˜ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë°©ë²•ì„ ì‹œë„í•˜ì„¸ìš”:', 'error');
        log('1. CSV íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ analyze-csv-file.html ì‚¬ìš©');
        log('2. Google Sheetsë¥¼ ì›¹ì— ê²Œì‹œ');
      }
    }
    
    // ìë™ ì‹¤í–‰
    fetchAndAnalyze();
  </script>
</body>
</html>
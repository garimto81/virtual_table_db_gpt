<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Virtual ì‹œíŠ¸ 18:41 ë§¤ì¹­ í…ŒìŠ¤íŠ¸</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
    button { padding: 10px 20px; background: #333; color: #0f0; border: 1px solid #0f0; cursor: pointer; }
    #results { margin-top: 20px; white-space: pre-wrap; border: 1px solid #0f0; padding: 10px; min-height: 300px; }
    .match { background: #003300; padding: 5px; margin: 5px 0; }
    .close { background: #333300; padding: 5px; margin: 5px 0; }
  </style>
</head>
<body>
  <h1>Virtual ì‹œíŠ¸ 18:41 ì§ì ‘ í…ŒìŠ¤íŠ¸</h1>
  
  <div>
    <p>ê³µê°œ URL: https://docs.google.com/spreadsheets/d/e/2PACX-1vTq3wrZNUASAMxl9A6VvJxTT6DKj40xp0R2xcIGfeji6MxQ8wi6Zbu_FWPmxKkmJdPHYgMC6UIT9tvv/pub?gid=561799849&single=true&output=csv</p>
    <button onclick="testVirtualSheet()">18:41 ì°¾ê¸°</button>
  </div>
  
  <div id="results"></div>
  
  <script>
    const resultsDiv = document.getElementById('results');
    
    function log(msg, className = '') {
      resultsDiv.innerHTML += `<div class="${className}">${msg}</div>`;
    }
    
    function parseCSV(text) {
      const lines = text.split('\n').filter(line => line.trim());
      return lines.map(line => {
        const result = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          const next = line[i + 1];
          
          if (char === '"' && inQuotes && next === '"') {
            current += '"';
            i++;
          } else if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            result.push(current);
            current = '';
          } else {
            current += char;
          }
        }
        result.push(current);
        return result;
      });
    }
    
    async function testVirtualSheet() {
      resultsDiv.innerHTML = '';
      
      const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTq3wrZNUASAMxl9A6VvJxTT6DKj40xp0R2xcIGfeji6MxQ8wi6Zbu_FWPmxKkmJdPHYgMC6UIT9tvv/pub?gid=561799849&single=true&output=csv';
      
      log('ğŸ” Virtual ì‹œíŠ¸ ì ‘ê·¼ ì¤‘...');
      log('ğŸ“Š ëª©í‘œ ì‹œê°„: 18:41\n');
      
      try {
        const response = await fetch(csvUrl);
        const text = await response.text();
        
        // ì²˜ìŒ 1000ì í™•ì¸
        log('ğŸ“„ ì‘ë‹µ ë°ì´í„° ì²˜ìŒ 1000ì:');
        log(text.substring(0, 1000));
        log('\n' + '='.repeat(70) + '\n');
        
        // HTML ì²´í¬
        if (text.includes('<html') || text.includes('<HTML')) {
          log('âŒ HTML ì‘ë‹µ ê°ì§€. CSVê°€ ì•„ë‹™ë‹ˆë‹¤.\n');
          
          // ëŒ€ì²´ URL ì‹œë„
          const altUrl = 'https://docs.google.com/spreadsheets/d/1M-LM2KkwLNOTygtrPVdnYLqqBoz4MmZvbglUaptSYqE/gviz/tq?tqx=out:csv&sheet=Virtual&gid=561799849';
          log('ğŸ”„ ëŒ€ì²´ URL ì‹œë„: ' + altUrl.substring(0, 80) + '...\n');
          
          const altResponse = await fetch(altUrl);
          const altText = await altResponse.text();
          
          if (altText.includes('<html') || altText.includes('<HTML')) {
            log('âŒ ëŒ€ì²´ URLë„ ì‹¤íŒ¨. ì‹œíŠ¸ ê¶Œí•œ í™•ì¸ í•„ìš”.\n');
            log('\nğŸ’¡ í•´ê²° ë°©ë²•:');
            log('1. Google Sheetsì—ì„œ íŒŒì¼ > ê³µìœ  > "ë§í¬ê°€ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ì"');
            log('2. ë³´ê¸° ê¶Œí•œ ì´ìƒ ì„¤ì •');
            log('3. ì›¹ì— ê²Œì‹œ ì˜µì…˜ ì‚¬ìš©');
            return;
          }
          
          processCSV(altText);
        } else {
          processCSV(text);
        }
        
      } catch (error) {
        log(`âŒ ì˜¤ë¥˜: ${error.message}`);
      }
    }
    
    function processCSV(text) {
      const rows = parseCSV(text);
      log(`âœ… CSV íŒŒì‹± ì„±ê³µ: ${rows.length}ê°œ í–‰\n`);
      
      if (rows.length === 0) {
        log('âŒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      // í—¤ë” í™•ì¸
      log('ğŸ“‹ í—¤ë”:');
      const headers = rows[0].slice(0, 8);
      headers.forEach((h, i) => {
        log(`  ${String.fromCharCode(65 + i)}ì—´: "${h}"`);
      });
      log('');
      
      // Cì—´ ìƒ˜í”Œ
      log('ğŸ“Š Cì—´ ì‹œê°„ ë°ì´í„° (ì²˜ìŒ 20ê°œ):');
      for (let i = 1; i < Math.min(21, rows.length); i++) {
        const cValue = rows[i][2];
        if (cValue && cValue.trim()) {
          log(`  í–‰ ${i + 1}: "${cValue}"`);
        }
      }
      log('');
      
      // 18:41 ì°¾ê¸°
      const targetHours = 18;
      const targetMinutes = 41;
      const targetTotalMinutes = targetHours * 60 + targetMinutes;
      
      log('ğŸ¯ 18:41 ë§¤ì¹­ ê²€ìƒ‰...\n');
      
      const matches = [];
      const closeMatches = [];
      
      for (let i = 1; i < rows.length; i++) {
        const cValue = rows[i][2];
        if (!cValue) continue;
        
        // ì‹œê°„ íŒŒì‹±
        const timeMatch = cValue.match(/(\d{1,2}):(\d{2})/);
        if (timeMatch) {
          const hours = parseInt(timeMatch[1]);
          const minutes = parseInt(timeMatch[2]);
          const totalMinutes = hours * 60 + minutes;
          const diff = Math.abs(totalMinutes - targetTotalMinutes);
          
          if (diff === 0) {
            matches.push(i + 1);
            log(`âœ… ì •í™•íˆ ì¼ì¹˜! í–‰ ${i + 1}: "${cValue}"`, 'match');
            log(`   Aì—´: "${rows[i][0]}" | Bì—´: "${rows[i][1]}"`, 'match');
          } else if (diff <= 5) {
            closeMatches.push({
              row: i + 1,
              time: cValue,
              diff: diff
            });
          }
        }
      }
      
      if (matches.length > 0) {
        log(`\nâœ… ì´ ${matches.length}ê°œ í–‰ì´ 18:41ê³¼ ì •í™•íˆ ì¼ì¹˜`, 'match');
      } else {
        log('\nâŒ 18:41ê³¼ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” í–‰ ì—†ìŒ');
        
        if (closeMatches.length > 0) {
          log('\nâš ï¸ ê·¼ì ‘í•œ ì‹œê°„:', 'close');
          closeMatches.sort((a, b) => a.diff - b.diff);
          closeMatches.slice(0, 5).forEach(m => {
            log(`  í–‰ ${m.row}: ${m.time} (${m.diff}ë¶„ ì°¨ì´)`, 'close');
          });
        }
      }
    }
  </script>
</body>
</html>
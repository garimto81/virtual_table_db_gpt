<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>v56 ë°°í¬ í™•ì¸ í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1a1a1a;
      color: #0f0;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
      background: #333;
      color: #0f0;
      border: 1px solid #0f0;
    }
    button:hover { background: #444; }
    #output {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #0f0;
      background: #000;
      min-height: 400px;
      white-space: pre-wrap;
    }
    .error { color: #f00; }
    .success { color: #0f0; }
    .warning { color: #ff0; }
  </style>
</head>
<body>
  <h1>ğŸ” v56 ë°°í¬ í™•ì¸ í…ŒìŠ¤íŠ¸</h1>
  
  <div>
    <button onclick="testGet()">1. GET ë²„ì „ í™•ì¸</button>
    <button onclick="testUpdateHandEdit()">2. updateHandEdit í…ŒìŠ¤íŠ¸</button>
    <button onclick="testOldLogic()">3. ê¸°ì¡´ ë¡œì§ í…ŒìŠ¤íŠ¸ (rows)</button>
  </div>
  
  <div id="output"></div>
  
  <script>
    // í˜„ì¬ ë°°í¬ëœ URL
    const URL = 'https://script.google.com/macros/s/AKfycbzWfe_4CAKcMAzzoHzJBstQIC7jQxSVC1BO23nYwlU23Pd5vLPLjfUi-gKyqzDYvPRT/exec';
    
    const log = (msg, type = '') => {
      const output = document.getElementById('output');
      const timestamp = new Date().toLocaleTimeString();
      const className = type ? ` class="${type}"` : '';
      output.innerHTML += `<div${className}>[${timestamp}] ${msg}</div>`;
      output.scrollTop = output.scrollHeight;
    };
    
    // 1. GET í…ŒìŠ¤íŠ¸ - ë²„ì „ í™•ì¸
    async function testGet() {
      log('=== GET ë²„ì „ í™•ì¸ ì‹œì‘ ===');
      
      try {
        const response = await fetch(URL);
        const text = await response.text();
        log('ì‘ë‹µ: ' + text);
        
        const json = JSON.parse(text);
        
        if (json.version === 'v56') {
          log('âœ… v56 ë°°í¬ í™•ì¸!', 'success');
        } else if (json.version) {
          log(`âš ï¸ ë‹¤ë¥¸ ë²„ì „ ê°ì§€: ${json.version}`, 'warning');
        } else {
          log('âŒ ë²„ì „ ì •ë³´ ì—†ìŒ - ì´ì „ ë²„ì „ì¼ ê°€ëŠ¥ì„±', 'error');
        }
        
        // rows ëˆ„ë½ ë©”ì‹œì§€ ì²´í¬
        if (json.message === 'rows ëˆ„ë½') {
          log('âŒ v53 ë˜ëŠ” ì´ì „ ë²„ì „ ê°ì§€! (rows ëˆ„ë½ ë©”ì‹œì§€)', 'error');
        }
        
      } catch (error) {
        log('âŒ ì—ëŸ¬: ' + error.message, 'error');
      }
    }
    
    // 2. updateHandEdit í…ŒìŠ¤íŠ¸
    async function testUpdateHandEdit() {
      log('=== updateHandEdit í…ŒìŠ¤íŠ¸ ===');
      
      const payload = {
        action: 'updateHandEdit',
        handNumber: '1',
        checked: true
      };
      
      log('ì „ì†¡ ë°ì´í„°: ' + JSON.stringify(payload));
      
      const formData = new FormData();
      formData.append('payload', JSON.stringify(payload));
      
      try {
        const response = await fetch(URL, {
          method: 'POST',
          body: formData
        });
        
        const text = await response.text();
        log('ì‘ë‹µ: ' + text);
        
        const json = JSON.parse(text);
        
        // v56 ì‘ë‹µ ì²´í¬
        if (json.success === true) {
          log('âœ… v56 updateHandEdit ì„±ê³µ!', 'success');
          log('í•¸ë“œ ë²ˆí˜¸: ' + json.handNumber);
          log('ì²´í¬ ìƒíƒœ: ' + json.checked);
        } 
        // v56 ì—ëŸ¬ ì²´í¬
        else if (json.status === 'error' && json.version === 'v56') {
          log('âš ï¸ v56 ì—ëŸ¬: ' + json.message, 'warning');
        }
        // v53 ì—ëŸ¬ ì²´í¬
        else if (json.message === 'rows ëˆ„ë½') {
          log('âŒ v53 ë˜ëŠ” ì´ì „ ë²„ì „! updateHandEdit ë¯¸ì§€ì›', 'error');
          log('ğŸ“ Code.gsê°€ v56ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
        }
        
      } catch (error) {
        log('âŒ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬: ' + error.message, 'error');
      }
    }
    
    // 3. ê¸°ì¡´ ë¡œì§ í…ŒìŠ¤íŠ¸
    async function testOldLogic() {
      log('=== ê¸°ì¡´ ë¡œì§ í…ŒìŠ¤íŠ¸ (ë¹ˆ rows) ===');
      
      const formData = new FormData();
      formData.append('payload', JSON.stringify({
        rows: []  // ë¹ˆ ë°°ì—´
      }));
      
      try {
        const response = await fetch(URL, {
          method: 'POST', 
          body: formData
        });
        
        const text = await response.text();
        log('ì‘ë‹µ: ' + text);
        
        const json = JSON.parse(text);
        
        if (json.message === 'rows ëˆ„ë½' && !json.version) {
          log('âŒ v53 ê°ì§€ - rows ëˆ„ë½ ë©”ì‹œì§€, version ì—†ìŒ', 'error');
        } else if (json.message === 'rows ëˆ„ë½' && json.version === 'v56') {
          log('âœ… v56 ê°ì§€ - rows ëˆ„ë½ ë©”ì‹œì§€, version ìˆìŒ', 'success');
        }
        
      } catch (error) {
        log('âŒ ì—ëŸ¬: ' + error.message, 'error');
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ
    window.onload = () => {
      log('í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
      log('URL: ' + URL);
      log('');
      log('1ë²ˆ ë²„íŠ¼ì„ ë¨¼ì € ëˆŒëŸ¬ ë²„ì „ì„ í™•ì¸í•˜ì„¸ìš”');
    };
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>CSV íŒŒì¼ì—ì„œ 18:41 ì°¾ê¸°</title>
  <style>
    body { 
      font-family: monospace; 
      padding: 20px; 
      background: #1a1a1a; 
      color: #0f0; 
    }
    .upload-area {
      border: 2px dashed #0f0;
      padding: 30px;
      text-align: center;
      margin: 20px 0;
      cursor: pointer;
    }
    .upload-area:hover {
      background: #003300;
    }
    button { 
      padding: 10px 20px; 
      background: #333; 
      color: #0f0; 
      border: 1px solid #0f0; 
      cursor: pointer; 
      margin: 5px;
    }
    #results { 
      margin-top: 20px; 
      white-space: pre-wrap; 
      border: 1px solid #0f0; 
      padding: 10px; 
      min-height: 300px; 
      background: #0a0a0a;
      overflow-x: auto;
    }
    .match { 
      background: #003300; 
      padding: 5px; 
      margin: 5px 0; 
      border-left: 3px solid #0f0;
    }
    .close { 
      background: #333300; 
      padding: 5px; 
      margin: 5px 0; 
      border-left: 3px solid #ff0;
    }
    input[type="file"] {
      display: none;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 10px 0;
    }
    th, td {
      border: 1px solid #0f0;
      padding: 5px;
      text-align: left;
    }
    th {
      background: #003300;
    }
  </style>
</head>
<body>
  <h1>ğŸ“Š CSV íŒŒì¼ì—ì„œ 18:41 ì‹œê°„ ì°¾ê¸°</h1>
  
  <div>
    <p>Virtual ì‹œíŠ¸ë¥¼ CSVë¡œ ë‹¤ìš´ë¡œë“œí•œ í›„ ì—¬ê¸°ì— ì—…ë¡œë“œí•˜ì„¸ìš”:</p>
    <p style="color: #ff0;">Google Sheets â†’ íŒŒì¼ â†’ ë‹¤ìš´ë¡œë“œ â†’ ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ê°’(.csv)</p>
  </div>
  
  <div class="upload-area" onclick="document.getElementById('csvFile').click()">
    <p>ğŸ“ CSV íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒ</p>
    <input type="file" id="csvFile" accept=".csv">
  </div>
  
  <div>
    <button onclick="findTime('18:41')">18:41 ì°¾ê¸°</button>
    <button onclick="showAllTimes()">ëª¨ë“  ì‹œê°„ í‘œì‹œ</button>
    <button onclick="showFirst20Rows()">ì²˜ìŒ 20í–‰ ë³´ê¸°</button>
    <button onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
  </div>
  
  <div id="results"></div>
  
  <script>
    const resultsDiv = document.getElementById('results');
    let csvData = null;
    let csvRows = null;
    
    function log(msg, className = '') {
      const div = document.createElement('div');
      div.className = className;
      if (typeof msg === 'string') {
        div.textContent = msg;
      } else {
        div.innerHTML = msg;
      }
      resultsDiv.appendChild(div);
    }
    
    function clearResults() {
      resultsDiv.innerHTML = '';
    }
    
    function parseCSV(text) {
      const lines = text.split(/\r?\n/).filter(line => line.trim());
      return lines.map((line, lineIndex) => {
        const result = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          const next = line[i + 1];
          
          if (char === '"' && inQuotes && next === '"') {
            current += '"';
            i++;
          } else if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            result.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        result.push(current.trim());
        return result;
      });
    }
    
    // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
    document.getElementById('csvFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        loadCSVFile(file);
      }
    });
    
    // ë“œë˜ê·¸ ì•¤ ë“œë¡­
    const uploadArea = document.querySelector('.upload-area');
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.style.background = '#003300';
    });
    
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.style.background = '';
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.style.background = '';
      
      const file = e.dataTransfer.files[0];
      if (file && file.name.endsWith('.csv')) {
        loadCSVFile(file);
      }
    });
    
    function loadCSVFile(file) {
      clearResults();
      log(`ğŸ“ íŒŒì¼ ë¡œë”©: ${file.name}`);
      
      const reader = new FileReader();
      reader.onload = function(e) {
        csvData = e.target.result;
        csvRows = parseCSV(csvData);
        
        log(`âœ… CSV ë¡œë“œ ì™„ë£Œ: ${csvRows.length}ê°œ í–‰`);
        log('');
        
        // í—¤ë” í‘œì‹œ
        if (csvRows.length > 0) {
          log('ğŸ“‹ í—¤ë” ì •ë³´:');
          const headers = csvRows[0].slice(0, 10);
          headers.forEach((h, i) => {
            log(`  ${String.fromCharCode(65 + i)}ì—´: "${h}"`);
          });
          log('');
        }
        
        // ìë™ìœ¼ë¡œ 18:41 ì°¾ê¸°
        findTime('18:41');
      };
      
      reader.readAsText(file, 'utf-8');
    }
    
    function findTime(targetTime) {
      if (!csvRows) {
        log('âŒ ë¨¼ì € CSV íŒŒì¼ì„ ë¡œë“œí•˜ì„¸ìš”');
        return;
      }
      
      const [targetHours, targetMinutes] = targetTime.split(':').map(n => parseInt(n));
      const targetTotalMinutes = targetHours * 60 + targetMinutes;
      
      log(`\nğŸ” ${targetTime} ê²€ìƒ‰ ì¤‘...`);
      log('='.repeat(70));
      
      const matches = [];
      const closeMatches = [];
      
      // Cì—´(index 2) ê²€ìƒ‰
      for (let i = 1; i < csvRows.length; i++) {
        const row = csvRows[i];
        const cValue = row[2]; // Cì—´
        
        if (!cValue) continue;
        
        // ë‹¤ì–‘í•œ ì‹œê°„ í˜•ì‹ ì²˜ë¦¬
        let found = false;
        let hours = 0, minutes = 0;
        
        // HH:MM ë˜ëŠ” HH:MM:SS í˜•ì‹
        const timeMatch = cValue.match(/(\d{1,2}):(\d{2})/);
        if (timeMatch) {
          hours = parseInt(timeMatch[1]);
          minutes = parseInt(timeMatch[2]);
          found = true;
        }
        
        if (found) {
          const totalMinutes = hours * 60 + minutes;
          const diff = Math.abs(totalMinutes - targetTotalMinutes);
          
          if (diff === 0) {
            matches.push({
              row: i + 1,
              data: row,
              cValue: cValue
            });
          } else if (diff <= 10) {
            closeMatches.push({
              row: i + 1,
              time: `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`,
              diff: diff,
              data: row
            });
          }
        }
      }
      
      // ê²°ê³¼ í‘œì‹œ
      if (matches.length > 0) {
        log(`\nâœ… ${targetTime}ê³¼ ì •í™•íˆ ì¼ì¹˜: ${matches.length}ê°œ í–‰`, 'match');
        matches.forEach(m => {
          log(`\nğŸ“ í–‰ ${m.row}:`, 'match');
          log(`  Aì—´: "${m.data[0]}"`, 'match');
          log(`  Bì—´: "${m.data[1]}"`, 'match');
          log(`  Cì—´: "${m.data[2]}" â† ì‹œê°„`, 'match');
          log(`  Dì—´: "${m.data[3]}"`, 'match');
          log(`  Eì—´: "${m.data[4]}"`, 'match');
          log(`  Fì—´: "${m.data[5]}"`, 'match');
        });
      } else {
        log(`\nâŒ ${targetTime}ê³¼ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” í–‰ ì—†ìŒ`);
        
        if (closeMatches.length > 0) {
          log(`\nâš ï¸ ê·¼ì ‘í•œ ì‹œê°„ (10ë¶„ ì´ë‚´):`, 'close');
          closeMatches.sort((a, b) => a.diff - b.diff);
          closeMatches.slice(0, 10).forEach(m => {
            log(`  í–‰ ${m.row}: ${m.time} (${m.diff}ë¶„ ì°¨ì´)`, 'close');
            log(`    Aì—´: "${m.data[0]}" | Dì—´: "${m.data[3]}"`, 'close');
          });
        }
      }
      
      log('\n' + '='.repeat(70));
    }
    
    function showAllTimes() {
      if (!csvRows) {
        log('âŒ ë¨¼ì € CSV íŒŒì¼ì„ ë¡œë“œí•˜ì„¸ìš”');
        return;
      }
      
      clearResults();
      log('ğŸ“Š Cì—´ì˜ ëª¨ë“  ì‹œê°„ ê°’:\n');
      
      let count = 0;
      const timeData = [];
      
      for (let i = 1; i < csvRows.length; i++) {
        const cValue = csvRows[i][2];
        if (cValue && cValue.trim()) {
          count++;
          timeData.push({
            row: i + 1,
            time: cValue,
            aCol: csvRows[i][0],
            bCol: csvRows[i][1]
          });
        }
      }
      
      // í…Œì´ë¸”ë¡œ í‘œì‹œ
      let table = '<table><tr><th>í–‰</th><th>Cì—´ (ì‹œê°„)</th><th>Aì—´</th><th>Bì—´</th></tr>';
      timeData.slice(0, 50).forEach(d => {
        const highlight = d.time.includes('18:41') ? 'style="background: #003300;"' : '';
        table += `<tr ${highlight}>`;
        table += `<td>${d.row}</td>`;
        table += `<td><strong>${d.time}</strong></td>`;
        table += `<td>${d.aCol}</td>`;
        table += `<td>${d.bCol}</td>`;
        table += '</tr>';
      });
      table += '</table>';
      
      resultsDiv.innerHTML = table;
      
      log(`\nì´ ${count}ê°œ ì‹œê°„ ê°’ (ìµœëŒ€ 50ê°œ í‘œì‹œ)`);
    }
    
    function showFirst20Rows() {
      if (!csvRows) {
        log('âŒ ë¨¼ì € CSV íŒŒì¼ì„ ë¡œë“œí•˜ì„¸ìš”');
        return;
      }
      
      clearResults();
      log('ğŸ“‹ ì²˜ìŒ 20ê°œ í–‰:\n');
      
      for (let i = 0; i < Math.min(20, csvRows.length); i++) {
        const row = csvRows[i];
        log(`í–‰ ${i + 1}:`);
        log(`  Aì—´: "${row[0]}"`);
        log(`  Bì—´: "${row[1]}"`);
        log(`  Cì—´: "${row[2]}" ${row[2] && row[2].includes(':') ? 'â† ì‹œê°„' : ''}`);
        log(`  Dì—´: "${row[3]}"`);
        log('');
      }
    }
  </script>
</body>
</html>
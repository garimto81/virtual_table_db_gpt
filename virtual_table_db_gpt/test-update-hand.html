<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Apps Script updateHandEdit í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    #response {
      background: white;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 5px;
      min-height: 200px;
      white-space: pre-wrap;
      font-family: monospace;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ Apps Script updateHandEdit í…ŒìŠ¤íŠ¸</h1>
  
  <div>
    <label>í•¸ë“œ ë²ˆí˜¸: <input type="text" id="handNumber" value="1" style="font-size: 16px; padding: 5px;"></label>
    <br><br>
    <button onclick="testUpdate(true)" style="background: #4CAF50; color: white;">âœ… ì²´í¬ë°•ìŠ¤ ì²´í¬ (ì™„ë£Œ)</button>
    <button onclick="testUpdate(false)" style="background: #FF9800; color: white;">ğŸ“ ì²´í¬ë°•ìŠ¤ í•´ì œ (í¸ì§‘)</button>
    <button onclick="testConnection()" style="background: #2196F3; color: white;">ğŸ”Œ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
  </div>
  
  <h2>ğŸ“Š ì‘ë‹µ:</h2>
  <pre id="response">í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</pre>
  
  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbygDLxqQaNvzc9ORH00jk1VuskDdVpBG1phvDsfnhk1SCqk9kl3gz51ScsQFDr30g1y/exec';
    
    async function testUpdate(checked) {
      const handNumber = document.getElementById('handNumber').value;
      const responseEl = document.getElementById('response');
      
      responseEl.textContent = 'ìš”ì²­ ì „ì†¡ ì¤‘...\n';
      
      try {
        // FormData ë°©ì‹ (index.htmlê³¼ ë™ì¼)
        console.log('=== updateHandEdit í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
        const payload = {
          action: 'updateHandEdit',
          handNumber: handNumber,
          checked: checked
        };
        
        console.log('ì „ì†¡í•  Payload:', payload);
        responseEl.textContent += `\nğŸ“¤ ì „ì†¡ ë°ì´í„°:\n${JSON.stringify(payload, null, 2)}\n`;
        
        const formData = new FormData();
        formData.append('payload', JSON.stringify(payload));
        
        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });
        
        console.log('ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
        responseEl.textContent += `\nğŸ“¨ ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}\n`;
        
        const text = await response.text();
        console.log('ì‘ë‹µ í…ìŠ¤íŠ¸:', text);
        responseEl.textContent += `\nğŸ“„ ì‘ë‹µ ì›ë³¸:\n${text}\n`;
        
        // íŒŒì‹± ì‹œë„
        try {
          const result = JSON.parse(text);
          console.log('íŒŒì‹±ëœ ê²°ê³¼:', result);
          
          if (result.status === 'success') {
            responseEl.innerHTML += `\n<span class="success">âœ… ì„±ê³µ!</span>\n`;
            responseEl.textContent += `í•¸ë“œ #${result.handNumber} - ì²´í¬: ${result.checked}\n`;
            if (result.editTime) {
              responseEl.textContent += `í¸ì§‘ ì‹œê°„: ${result.editTime}\n`;
            }
          } else if (result.status === 'error') {
            responseEl.innerHTML += `\n<span class="error">âŒ ì—ëŸ¬: ${result.message}</span>\n`;
          }
          
          responseEl.textContent += `\nğŸ“Š íŒŒì‹±ëœ ê²°ê³¼:\n${JSON.stringify(result, null, 2)}`;
        } catch (e) {
          console.error('JSON íŒŒì‹± ì‹¤íŒ¨:', e);
          responseEl.innerHTML += `\n<span class="error">âŒ JSON íŒŒì‹± ì‹¤íŒ¨</span>\n`;
          responseEl.textContent += `ì—ëŸ¬: ${e.message}\n`;
          
          // HTML ì‘ë‹µì¸ ê²½ìš° (CORS ì—ëŸ¬ ë“±)
          if (text.includes('<!DOCTYPE')) {
            responseEl.textContent += '\nâš ï¸ HTML ì‘ë‹µ ë°›ìŒ - Apps Script ë°°í¬ ì„¤ì • í™•ì¸ í•„ìš”';
          }
        }
        
      } catch (error) {
        console.error('ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬:', error);
        responseEl.innerHTML = `<span class="error">âŒ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬: ${error.message}</span>`;
      }
    }
    
    async function testConnection() {
      const responseEl = document.getElementById('response');
      responseEl.textContent = 'ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...\n';
      
      try {
        // GET ìš”ì²­ìœ¼ë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸
        const response = await fetch(APPS_SCRIPT_URL);
        const text = await response.text();
        
        console.log('GET ì‘ë‹µ:', text);
        responseEl.textContent += `\nğŸ“¡ GET ì‘ë‹µ:\n${text}\n`;
        
        try {
          const result = JSON.parse(text);
          if (result.status === 'ok') {
            responseEl.innerHTML += `\n<span class="success">âœ… ì—°ê²° ì„±ê³µ! ë²„ì „: ${result.version}</span>`;
          }
        } catch (e) {
          responseEl.innerHTML += `\n<span class="error">âš ï¸ ì‘ë‹µì€ ë°›ì•˜ì§€ë§Œ JSONì´ ì•„ë‹˜</span>`;
        }
        
      } catch (error) {
        responseEl.innerHTML = `<span class="error">âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}</span>`;
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì •ë³´ í‘œì‹œ
    window.onload = () => {
      console.log('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì¤€ë¹„ ì™„ë£Œ');
      console.log('Apps Script URL:', APPS_SCRIPT_URL);
      console.log('ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìì„¸í•œ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
    };
  </script>
</body>
</html>
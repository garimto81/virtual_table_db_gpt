<!DOCTYPE html>
<!--
  í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ - ë¡œê·¸ ì‹œìŠ¤í…œ ì¶”ê°€
  Version: 8.7.0
  Last Updated: 2025-09-05
  Description: í•¸ë“œ í¸ì§‘ ì™„ë£Œ ì‹œ ìƒì„¸ ë¡œê·¸ í‘œì‹œ ê¸°ëŠ¥
-->
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§ v8.9.0 - Virtual ì‹œíŠ¸ ë§¤ì¹­ ê°œì„ </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .mono {
      font-family: 'JetBrains Mono', monospace;
    }
    
    /* ì»´íŒ©íŠ¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .card-mini {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 48px;
      background-color: #FFFFFF !important;
      color-scheme: light;
      border: 1px solid #6b7280;
      border-radius: 4px;
      font-weight: 800;
      font-size: 16px;
      margin: 0 1px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      position: relative;
    }
    
    /* ìŠ¤í˜ì´ë“œ, í´ëŸ½ - ì§„í•œ ê²€ì€ìƒ‰ */
    .card-mini.spade, .card-mini.club { 
      color: #000000 !important;
    }
    
    /* í•˜íŠ¸, ë‹¤ì´ì•„ëª¬ë“œ - ì§„í•œ ë¹¨ê°„ìƒ‰ */
    .card-mini.heart, .card-mini.diamond { 
      color: #dc2626 !important;
    }
    
    /* ë³´ë“œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .board-card {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 60px;
      background-color: #FFFFFF !important;
      color-scheme: light;
      border: 2px solid #f59e0b;
      border-radius: 6px;
      font-weight: 900;
      font-size: 20px;
      margin: 0 2px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      position: relative;
    }
    
    /* ìŠ¤í˜ì´ë“œ, í´ëŸ½ - ì§„í•œ ê²€ì€ìƒ‰ */
    .board-card.spade, .board-card.club { 
      color: #000000 !important;
    }
    
    /* í•˜íŠ¸, ë‹¤ì´ì•„ëª¬ë“œ - ì§„í•œ ë¹¨ê°„ìƒ‰ */
    .board-card.heart, .board-card.diamond { 
      color: #dc2626 !important;
    }
    
    /* ì•¡ì…˜ ë°°ì§€ ìŠ¤íƒ€ì¼ */
    .action-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .action-badge.fold { background: #64748b; color: white; }
    .action-badge.check { background: #0ea5e9; color: white; }
    .action-badge.call { background: #22c55e; color: white; }
    .action-badge.bet { background: #f97316; color: white; }
    .action-badge.raise { background: #ef4444; color: white; }
    .action-badge.allin { background: #fbbf24; color: #000; }
    
    /* í¬ì§€ì…˜ ë°°ì§€ */
    .pos-badge {
      display: inline-block;
      padding: 1px 4px;
      border-radius: 3px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
    }
    
    .pos-badge.btn { background: #fbbf24; color: #000; }
    .pos-badge.sb { background: #10b981; color: white; }
    .pos-badge.bb { background: #3b82f6; color: white; }
    .pos-badge.utg { background: #8b5cf6; color: white; }
    .pos-badge.mp { background: #ec4899; color: white; }
    .pos-badge.co { background: #f97316; color: white; }
    
    /* ìŠ¤í¬ë¡¤ë°” */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #1e293b;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #475569;
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #64748b;
    }
    
    /* ì»´íŒ©íŠ¸ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
    .compact-grid {
      display: grid;
      grid-template-columns: 280px 1fr 320px;
      gap: 12px;
      padding: 12px;
      height: 100vh;
      max-width: 1920px;
      margin: 0 auto;
    }
    
    @media (max-width: 1440px) {
      .compact-grid {
        grid-template-columns: 260px 1fr 300px;
      }
    }
    
    /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .section {
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 12px;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
    }
    
    .section-header {
      font-size: 13px;
      font-weight: 600;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid #334155;
    }
    
    /* í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ */
    .player-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .player-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 8px;
      background: rgba(15, 23, 42, 0.4);
      border: 1px solid #334155;
      border-radius: 6px;
      transition: all 0.2s;
    }
    
    .player-item:hover {
      background: rgba(59, 130, 246, 0.1);
      border-color: #3b82f6;
    }
    
    .player-item.folded {
      opacity: 0.5;
    }
    
    /* ì•¡ì…˜ íƒ€ì„ë¼ì¸ ì»´íŒ©íŠ¸ */
    .action-line {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      font-size: 12px;
      border-left: 2px solid transparent;
    }
    
    .action-line.preflop { border-left-color: #8b5cf6; }
    .action-line.flop { border-left-color: #3b82f6; }
    .action-line.turn { border-left-color: #10b981; }
    .action-line.river { border-left-color: #f97316; }
    .action-line.showdown { border-left-color: #fbbf24; }
    
    /* íŒŸ ë””ìŠ¤í”Œë ˆì´ */
    .pot-display {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      border-radius: 6px;
      font-weight: 700;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <!-- í—¤ë” -->
  <div class="app-header" style="background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid #334155; padding: 10px 16px; position: sticky; top: 0; z-index: 100;">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <h1 class="text-lg font-bold">í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§</h1>
        <span class="text-xs text-gray-500">v8.4.0 KeyPlayer</span>
        <div class="flex items-center gap-2">
          <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
          <span class="text-xs text-gray-400">ì—°ê²°ë¨</span>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <input type="text" id="virtual-sheet-url" 
               class="text-xs bg-gray-700 px-2 py-1 rounded w-64" 
               placeholder="Virtual ì‹œíŠ¸ URL ì…ë ¥..."
               title="Virtual ì‹œíŠ¸ê°€ í¬í•¨ëœ Google Sheets URL">
        <button id="refresh-btn" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">
          ìƒˆë¡œê³ ì¹¨
        </button>
        <button id="settings-btn" class="px-3 py-1 bg-gray-600 text-white rounded text-xs hover:bg-gray-700">
          ì„¤ì •
        </button>
      </div>
    </div>
  </div>

  <!-- ë©”ì¸ ì»¨í…ì¸  -->
  <div class="compact-grid">
    
    <!-- ì™¼ìª½: í•¸ë“œ ë¦¬ìŠ¤íŠ¸ -->
    <div class="section overflow-hidden">
      <div class="section-header flex items-center justify-between">
        <span>í•¸ë“œ ëª©ë¡</span>
        <span id="hand-count" class="text-xs">0</span>
      </div>
      <div class="flex gap-2 mb-2">
        <select id="table-filter" class="bg-gray-700 text-xs px-2 py-1 rounded flex-1">
          <option value="">ëª¨ë“  í…Œì´ë¸”</option>
        </select>
        <select id="status-filter" class="bg-gray-700 text-xs px-2 py-1 rounded">
          <option value="">ì „ì²´</option>
          <option value="pending">ëŒ€ê¸°</option>
          <option value="completed">ì™„ë£Œ</option>
        </select>
      </div>
      <div id="hand-list" class="flex-1 overflow-y-auto" style="max-height: calc(100vh - 180px);">
        <!-- í•¸ë“œ ë¦¬ìŠ¤íŠ¸ ë™ì  ìƒì„± -->
      </div>
    </div>

    <!-- ì¤‘ì•™: í•¸ë“œ ìƒì„¸ ì •ë³´ -->
    <div class="section overflow-hidden">
      <!-- í•¸ë“œ í—¤ë” ì •ë³´ -->
      <div class="flex items-center justify-between mb-3 pb-2 border-b border-gray-700">
        <div class="flex flex-col gap-1">
          <div class="flex items-center gap-3">
            <span class="text-sm font-bold">Hand #<span id="hand-number">-</span></span>
            <span class="text-xs text-gray-400">Table: <span id="table-name">-</span></span>
            <span class="text-xs text-gray-400">Blinds: <span id="blinds">-</span></span>
          </div>
          <div class="text-xs text-blue-300">
            ğŸ“¹ <span id="camera-files">-</span>
          </div>
        </div>
        <div class="flex gap-2">
          <button id="edit-btn" class="px-2 py-1 bg-yellow-600 text-xs rounded">í¸ì§‘</button>
          <button id="complete-btn" class="px-2 py-1 bg-green-600 text-xs rounded">ì™„ë£Œ</button>
        </div>
      </div>

      <!-- íŒŸ ì •ë³´ -->
      <div class="pot-display mb-3">
        POT: <span id="pot-amount">0</span>
      </div>

      <!-- ë³´ë“œ ì¹´ë“œ -->
      <div class="mb-3">
        <div class="section-header">Board</div>
        <div id="board-cards" class="flex justify-center gap-1">
          <!-- ë³´ë“œ ì¹´ë“œ ë™ì  ìƒì„± -->
        </div>
      </div>

      <!-- í”Œë ˆì´ì–´ ì¹´ë“œ ì„¹ì…˜ -->
      <div class="mb-3">
        <div class="section-header">Players</div>
        <div id="players-section" class="player-list" style="max-height: 180px; overflow-y: auto;">
          <!-- í”Œë ˆì´ì–´ ì •ë³´ ë™ì  ìƒì„± -->
        </div>
      </div>

      <!-- ì•¡ì…˜ íˆìŠ¤í† ë¦¬ -->
      <div class="flex-1">
        <div class="section-header">Actions</div>
        <div id="action-history" style="max-height: calc(100vh - 520px); overflow-y: auto;">
          <!-- ì•¡ì…˜ íˆìŠ¤í† ë¦¬ ë™ì  ìƒì„± -->
        </div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ìš”ì•½ ì •ë³´ -->
    <div class="section">
      <!-- í†µê³„ -->
      <div class="mb-3">
        <div class="section-header">í†µê³„</div>
        <div class="grid grid-cols-2 gap-2">
          <div class="bg-gray-800 rounded p-2">
            <div class="text-xs text-gray-400">ì´ í•¸ë“œ</div>
            <div class="text-lg font-bold" id="total-hands">0</div>
          </div>
          <div class="bg-gray-800 rounded p-2">
            <div class="text-xs text-gray-400">ì™„ë£Œ</div>
            <div class="text-lg font-bold text-green-400" id="completed-hands">0</div>
          </div>
        </div>
      </div>

      <!-- í•¸ë“œ ê²°ê³¼ -->
      <div class="mb-3">
        <div class="section-header">ê²°ê³¼</div>
        <div id="hand-result" class="bg-gray-800 rounded p-3">
          <div class="text-xs text-gray-400">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>

      <!-- í¸ì§‘ ë…¸íŠ¸ -->
      <div class="flex-1">
        <div class="section-header">ë…¸íŠ¸</div>
        <textarea id="hand-notes" 
          class="w-full flex-1 bg-gray-800 rounded p-2 text-xs resize-none" 
          style="min-height: 100px;"
          placeholder="í•¸ë“œ ë¶„ì„ ë…¸íŠ¸..."></textarea>
        <button id="save-notes" class="mt-2 w-full px-3 py-1 bg-blue-600 text-white rounded text-xs">
          ë…¸íŠ¸ ì €ì¥
        </button>
      </div>
    </div>
  </div>

  <!-- ë¡œê·¸ ë©”ì‹œì§€ ëª¨ë‹¬ -->
  <div id="log-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg p-6 max-w-3xl w-full max-h-[80vh] flex flex-col">
      <h2 class="text-lg font-bold mb-4">ğŸ“Š ì²˜ë¦¬ ë¡œê·¸</h2>
      <div id="log-messages" class="bg-black rounded p-4 text-green-400 font-mono text-xs overflow-y-auto flex-1 mb-4">
        <!-- ë¡œê·¸ ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
      </div>
      <button onclick="closeLogModal()" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600">
        ë‹«ê¸°
      </button>
    </div>
  </div>
  
  <!-- ì™„ë£Œ íŒŒì¼ëª… ì…ë ¥ ëª¨ë‹¬ -->
  <div id="completion-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg p-6 max-w-lg w-full">
      <h2 class="text-lg font-bold mb-4">ğŸ“ í•¸ë“œ í¸ì§‘ ì™„ë£Œ</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm mb-2">ìµœì¢… íŒŒì¼ëª…</label>
          <input type="text" id="final-filename" 
                 class="w-full bg-gray-700 rounded px-3 py-2 text-sm" 
                 placeholder="ì˜ˆ: 2025-09-05_Hand91_Final.mp4">
        </div>
        <div>
          <label class="block text-sm mb-2">í•¸ë“œ ì‹œê°„ (ì‹œ:ë¶„:ì´ˆ)</label>
          <input type="text" id="hand-timestamp" 
                 class="w-full bg-gray-700 rounded px-3 py-2 text-sm mono" 
                 readonly>
        </div>
        <div>
          <label class="block text-sm mb-2">ë§¤ì¹­ëœ Virtual ì‹œíŠ¸ í–‰</label>
          <input type="text" id="matched-row" 
                 class="w-full bg-gray-700 rounded px-3 py-2 text-sm" 
                 readonly>
          
          <!-- Virtual ì‹œíŠ¸ ë§¤ì¹­ ì§„í–‰ ìƒí™© í‘œì‹œ -->
          <div id="virtual-matching-progress" class="mt-2 hidden">
            <div class="flex items-center justify-between text-xs text-gray-300 mb-1">
              <span id="progress-status">Virtual ì‹œíŠ¸ ë§¤ì¹­ ì¤‘...</span>
              <span id="progress-percentage">0%</span>
            </div>
            <div class="w-full bg-gray-600 rounded-full h-2">
              <div id="progress-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <div class="text-xs text-gray-400 mt-1">
              <span id="progress-details">ì¤€ë¹„ ì¤‘...</span>
            </div>
          </div>
        </div>
        <div>
          <label class="block text-sm mb-2">AI ë¶„ì„ ìš”ì•½ (3ì¤„)</label>
          <textarea id="ai-summary" 
                    class="w-full bg-gray-700 rounded px-3 py-2 text-sm" 
                    rows="3"
                    placeholder="AIê°€ ìë™ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ìš”ì•½í•©ë‹ˆë‹¤..."
                    readonly></textarea>
        </div>
        <div class="text-xs text-gray-400">
          <p>âœ… Virtual ì‹œíŠ¸ì˜ ê°€ì¥ ë¹„ìŠ·í•œ ì‹œê°„ í–‰ì„ ì°¾ì•„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤</p>
          <p>âœ… Fì—´: íŒŒì¼ëª…, Hì—´: AI ìš”ì•½ì´ ìë™ ì…ë ¥ë©ë‹ˆë‹¤</p>
        </div>
      </div>
      <div class="flex justify-end gap-2 mt-6">
        <button id="cancel-completion" class="px-4 py-2 bg-gray-600 rounded text-sm">ì·¨ì†Œ</button>
        <button id="confirm-completion" class="px-4 py-2 bg-green-600 rounded text-sm">ì™„ë£Œ ì²˜ë¦¬</button>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full">
      <h2 class="text-lg font-bold mb-4">ì„¤ì •</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm mb-2">ìƒˆë¡œê³ ì¹¨ ê°„ê²©</label>
          <select id="refresh-interval" class="w-full bg-gray-700 rounded px-3 py-2">
            <option value="5000">5ì´ˆ</option>
            <option value="10000" selected>10ì´ˆ</option>
            <option value="30000">30ì´ˆ</option>
            <option value="60000">1ë¶„</option>
          </select>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="enable-notifications" checked>
          <label for="enable-notifications" class="text-sm">ìƒˆ í•¸ë“œ ì•Œë¦¼ í™œì„±í™”</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="enable-sound" checked>
          <label for="enable-sound" class="text-sm">ì†Œë¦¬ ì•Œë¦¼ í™œì„±í™”</label>
        </div>
        <div class="mt-4 pt-4 border-t border-gray-700">
          <h3 class="text-sm font-bold mb-2">ğŸ¤– AI API ì„¤ì •</h3>
          <div class="mb-2">
            <label class="block text-xs mb-1">AI ì„œë¹„ìŠ¤ ì„ íƒ</label>
            <select id="ai-service" class="w-full bg-gray-700 rounded px-3 py-1 text-sm">
              <option value="none">ì‚¬ìš© ì•ˆ í•¨ (ê¸°ë³¸ ìš”ì•½)</option>
              <option value="openai">OpenAI (GPT-4/GPT-3.5)</option>
              <option value="gemini">Google Gemini</option>
              <option value="claude">Anthropic Claude</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="block text-xs mb-1">API í‚¤</label>
            <input type="password" id="ai-api-key" 
                   class="w-full bg-gray-700 rounded px-3 py-1 text-sm" 
                   placeholder="API í‚¤ ì…ë ¥...">
            <p class="text-xs text-gray-400 mt-1">
              API í‚¤ëŠ” ë¡œì»¬ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.
            </p>
          </div>
        </div>
        <div class="mt-4 pt-4 border-t border-gray-700">
          <button id="clear-notification-history" class="w-full px-4 py-2 bg-red-600 rounded text-sm hover:bg-red-700 transition">
            ğŸ”„ ë²„í¼ ì´ˆê¸°í™”
          </button>
          <p class="text-xs text-gray-400 mt-2">
            ìµœê·¼ í•¸ë“œ ë²„í¼(ìµœëŒ€ 100ê°œ)ê°€ ì´ˆê¸°í™”ë˜ë©°, ë‹¤ìŒ ë¡œë“œì‹œ ê¸°ì¡´ í•¸ë“œë„ ìƒˆ í•¸ë“œë¡œ ì¸ì‹ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </p>
        </div>
      </div>
      <div class="flex justify-end gap-2 mt-6">
        <button id="cancel-settings" class="px-4 py-2 bg-gray-600 rounded text-sm">ì·¨ì†Œ</button>
        <button id="save-settings" class="px-4 py-2 bg-blue-600 rounded text-sm">ì €ì¥</button>
      </div>
    </div>
  </div>

  <script>
    // ====================================
    // í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ v8.9.0 - Virtual ì‹œíŠ¸ ë§¤ì¹­ ê°œì„ 
    // ====================================
    
    const CONFIG = {
      // Google Sheets CSV URLs
      CSV_HAND_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=1906746276&single=true&output=csv',
      CSV_INDEX_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=1354012271&single=true&output=csv',
      APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzWfe_4CAKcMAzzoHzJBstQIC7jQxSVC1BO23nYwlU23Pd5vLPLjfUi-gKyqzDYvPRT/exec',
      
      // ê¸°ë³¸ Virtual ì‹œíŠ¸ URL (CSV í˜•ì‹)
      DEFAULT_VIRTUAL_SHEET_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=0&single=true&output=csv',
      
      // ì„¤ì •
      REFRESH_INTERVAL: 10000,
      ENABLE_NOTIFICATIONS: true,
      ENABLE_SOUND: true,
      
      // AI API ì„¤ì •
      AI_SERVICE: 'none', // 'none', 'openai', 'gemini', 'claude'
      AI_API_KEY: '',
      AI_MODEL: { // ê° ì„œë¹„ìŠ¤ë³„ ê¸°ë³¸ ëª¨ë¸
        openai: 'gpt-3.5-turbo',
        gemini: 'gemini-pro',
        claude: 'claude-3-sonnet-20240229'
      }
    };
    
    // ì „ì—­ ìƒíƒœ
    let currentHand = null;
    let allHands = [];
    let masterHandList = new Map(); // ì˜êµ¬ ì €ì¥ìš© ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡
    const MASTER_LIST_KEY = 'poker_master_hand_list_v1';
    let handData = {};
    let refreshTimerInitial = null;  // ì´ˆê¸° setTimeoutìš©
    let refreshTimerInterval = null;  // ë°˜ë³µ setIntervalìš©
    let lastHandCount = 0;
    let isInitialLoad = true; // ì²« ë¡œë”©ì¸ì§€ í™•ì¸
    
    // ìµœê·¼ 5ê°œ í•¸ë“œë§Œ ì¶”ì í•˜ëŠ” ê°„ë‹¨í•œ ë²„í¼
    class RecentHandsBuffer {
      constructor() {
        this.buffer = [];
        this.maxSize = 100; // 5ê°œëŠ” ë„ˆë¬´ ì ìŒ, 100ê°œë¡œ ì¦ê°€
        this.storageKey = 'poker_recent_hands_buffer_v2'; // ë²„ì „ ì—…ê·¸ë ˆì´ë“œ
        this.loadFromStorage();
      }
      
      // ìƒˆ í•¸ë“œ ì¶”ê°€ (ì¤‘ë³µ ì²´í¬ í¬í•¨)
      addHand(handNumber) {
        const handStr = String(handNumber);
        
        // ì´ë¯¸ ë²„í¼ì— ìˆìœ¼ë©´ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
        if (this.buffer.includes(handStr)) {
          return false; // ì¤‘ë³µ
        }
        
        // ë²„í¼ì— ì¶”ê°€
        this.buffer.push(handStr);
        
        // ìµœëŒ€ í¬ê¸° ì´ˆê³¼ì‹œ ê°€ì¥ ì˜¤ë˜ëœ ê²ƒ ì œê±°
        while (this.buffer.length > this.maxSize) {
          this.buffer.shift();
        }
        
        this.saveToStorage();
        return true; // ìƒˆ í•¸ë“œ
      }
      
      // í•¸ë“œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
      hasHand(handNumber) {
        return this.buffer.includes(String(handNumber));
      }
      
      // ë²„í¼ ìƒíƒœ í™•ì¸
      getStatus() {
        return {
          buffer: [...this.buffer],
          size: this.buffer.length,
          maxSize: this.maxSize
        };
      }
      
      // localStorageì—ì„œ ë¡œë“œ
      loadFromStorage() {
        try {
          const stored = localStorage.getItem(this.storageKey);
          if (stored) {
            this.buffer = JSON.parse(stored) || [];
            console.log(`ğŸ’¾ ìµœê·¼ í•¸ë“œ ë²„í¼ ë¡œë“œ: ${this.buffer.length}ê°œ`);
          }
        } catch (e) {
          console.error('ë²„í¼ ë¡œë“œ ì‹¤íŒ¨:', e);
          this.buffer = [];
        }
      }
      
      // localStorageì— ì €ì¥
      saveToStorage() {
        try {
          localStorage.setItem(this.storageKey, JSON.stringify(this.buffer));
        } catch (e) {
          console.error('ë²„í¼ ì €ì¥ ì‹¤íŒ¨:', e);
        }
      }
      
      // ë²„í¼ ì´ˆê¸°í™”
      clear() {
        this.buffer = [];
        this.saveToStorage();
        console.log('ğŸ”„ ìµœê·¼ í•¸ë“œ ë²„í¼ ì´ˆê¸°í™” ì™„ë£Œ');
      }
    }
    
    // ì „ì—­ ë²„í¼ ì¸ìŠ¤í„´ìŠ¤
    const recentHandsBuffer = new RecentHandsBuffer();
    
    // ê¸°ì¡´ ì•Œë¦¼ ê´€ë ¨ ì„¤ì •
    const STORAGE_KEY = 'poker_notified_hands_v3';
    const MAX_STORED_HANDS = 500;
    const NOTIFICATION_COOLDOWN = 30000; // 30ì´ˆ ì¿¨ë‹¤ìš´
    
    // ë””ë²„ê·¸ ëª¨ë“œ
    const DEBUG_MODE = true; // ì½˜ì†”ì— ìƒì„¸ ë¡œê·¸ ì¶œë ¥
    
    
    // ì•Œë¦¼ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì‹œê°„ ì •ë³´ í¬í•¨)
    function getNotifiedHands() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          const data = JSON.parse(stored);
          // ê°ì²´ í˜•íƒœë¡œ ì €ì¥ (handNumber: timestamp)
          return data.hands || {};
        }
      } catch (e) {
        console.error('ì•Œë¦¼ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }
      return {};
    }
    
    // ì•Œë¦¼ ê¸°ë¡ ì €ì¥ (ì‹œê°„ ì •ë³´ í¬í•¨)
    // ì¤‘ìš”: í•œ ë²ˆ ì•Œë¦¼ì„ í‘œì‹œí•œ í•¸ë“œëŠ” CSVì—ì„œ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ë¼ì ¸ë„ 
    // ìµœì†Œ 24ì‹œê°„ ë™ì•ˆì€ ê¸°ë¡ì„ ìœ ì§€í•˜ì—¬ ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€
    function saveNotifiedHands(handsMap) {
      try {
        // ë„ˆë¬´ ì˜¤ë˜ëœ ê¸°ë¡ë§Œ ì œê±° (24ì‹œê°„ ì´ìƒ)
        // CSV ì§€ì—°ìœ¼ë¡œ ì¸í•´ í•¸ë“œê°€ ì ì‹œ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ
        // 7ì¼ì´ ì•„ë‹Œ 24ì‹œê°„ìœ¼ë¡œ ë‹¨ì¶•í•˜ì—¬ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± í–¥ìƒ
        const now = Date.now();
        const oneDayAgo = now - (24 * 60 * 60 * 1000);
        const cleanedHands = {};
        
        // ê¸°ì¡´ ì €ì¥ëœ ëª¨ë“  í•¸ë“œ ìœ ì§€ (24ì‹œê°„ ë‚´)
        const existingData = getNotifiedHands();
        for (const [handNumber, timestamp] of Object.entries(existingData)) {
          if (timestamp > oneDayAgo) {
            cleanedHands[handNumber] = timestamp;
          }
        }
        
        // ìƒˆë¡œìš´ í•¸ë“œ ì¶”ê°€/ì—…ë°ì´íŠ¸
        for (const [handNumber, timestamp] of Object.entries(handsMap)) {
          cleanedHands[handNumber] = timestamp;
        }
        
        // ìµœëŒ€ ê°œìˆ˜ ì œí•œ
        const entries = Object.entries(cleanedHands);
        if (entries.length > MAX_STORED_HANDS) {
          // ê°€ì¥ ì˜¤ë˜ëœ ê²ƒë“¤ ì œê±°
          entries.sort((a, b) => a[1] - b[1]);
          const toKeep = entries.slice(-MAX_STORED_HANDS);
          const finalHands = {};
          toKeep.forEach(([handNumber, timestamp]) => {
            finalHands[handNumber] = timestamp;
          });
          
          localStorage.setItem(STORAGE_KEY, JSON.stringify({
            hands: finalHands,
            lastUpdated: new Date().toISOString()
          }));
        } else {
          localStorage.setItem(STORAGE_KEY, JSON.stringify({
            hands: cleanedHands,
            lastUpdated: new Date().toISOString()
          }));
        }
        
        if (DEBUG_MODE) {
          console.log(`ğŸ’¾ ì•Œë¦¼ ê¸°ë¡ ì €ì¥: ì´ ${Object.keys(cleanedHands).length}ê°œ í•¸ë“œ ê¸°ë¡ ìœ ì§€`);
        }
      } catch (e) {
        console.error('ì•Œë¦¼ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨:', e);
      }
    }
    
    // ì•Œë¦¼ ê¸°ë¡ ì´ˆê¸°í™” (ê°ì²´ í˜•íƒœ: {handNumber: timestamp})
    let notifiedHands = getNotifiedHands();
    let lastDataSnapshot = ''; // ë§ˆì§€ë§‰ ë°ì´í„° ìŠ¤ëƒ…ìƒ· (ë°ì´í„° ë³€ê²½ ê°ì§€ìš©)
    
    // ====================================
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    // ====================================
    
    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const rows = [];
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const row = [];
        let inQuotes = false;
        let currentField = '';
        
        for (let j = 0; j < line.length; j++) {
          const char = line[j];
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            row.push(currentField.trim());
            currentField = '';
          } else {
            currentField += char;
          }
        }
        row.push(currentField.trim());
        rows.push(row);
      }
      
      return rows;
    }
    
    function formatNumber(num) {
      return new Intl.NumberFormat('ko-KR').format(num);
    }
    
    function getSuitSymbol(suit) {
      const symbols = {
        's': 'â™ ', 'h': 'â™¥', 'd': 'â™¦', 'c': 'â™£'
      };
      return symbols[suit.toLowerCase()] || '';
    }
    
    function getSuitClass(suit) {
      const classes = {
        's': 'spade', 'h': 'heart', 'd': 'diamond', 'c': 'club'
      };
      return classes[suit.toLowerCase()] || '';
    }
    
    function createCardElement(card, type = 'mini') {
      if (!card || card === '?' || card.length < 2) {
        // ì•Œ ìˆ˜ ì—†ëŠ” ì¹´ë“œë„ í°ìƒ‰ ë°”íƒ•ìœ¼ë¡œ í‘œì‹œ (ë‹¤í¬ëª¨ë“œ ë¬´ì‹œ)
        return `<div class="${type === 'board' ? 'board-card' : 'card-mini'}" style="background-color: #FFFFFF !important; color: #6b7280; border-style: dashed; color-scheme: light;">?</div>`;
      }
      
      const rank = card.slice(0, -1);
      const suit = card.slice(-1);
      const suitClass = getSuitClass(suit);
      const suitSymbol = getSuitSymbol(suit);
      
      // ìŠ¤í˜ì´ë“œ/í´ë¡œë²„ëŠ” ê²€ì€ìƒ‰, í•˜íŠ¸/ë‹¤ì´ì•„ëŠ” ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ê°•ì œ ì„¤ì •
      const textColor = (suit === 's' || suit === 'c') ? '#000000' : '#dc2626';
      
      // ì¹´ë“œì— ë­í¬ì™€ ë¬¸ì–‘ í‘œì‹œ
      return `<div class="${type === 'board' ? 'board-card' : 'card-mini'} ${suitClass}" style="background-color: #FFFFFF !important; color: ${textColor} !important; color-scheme: light;">
        <div style="display: flex; align-items: center; gap: 2px; color: ${textColor} !important;">
          <span style="font-weight: 900; color: ${textColor} !important;">${rank}</span>
          <span style="font-size: ${type === 'board' ? '16px' : '12px'}; color: ${textColor} !important;">${suitSymbol}</span>
        </div>
      </div>`;
    }
    
    function getActionBadgeClass(action) {
      const actionMap = {
        'FOLD': 'fold',
        'CHECK': 'check',
        'CALL': 'call',
        'CHECK/CALL': 'call',  // CHECK/CALL í†µí•© ì²˜ë¦¬
        'BET': 'bet',
        'RAISE': 'raise',
        'RAISE TO': 'raise',
        'ALL-IN': 'allin',
        'ALLIN': 'allin'
      };
      return actionMap[action.toUpperCase()] || 'check';
    }
    
    // ì•¡ì…˜ í‘œì‹œ í…ìŠ¤íŠ¸ ë³€í™˜ í•¨ìˆ˜ (ì´ë¯¸ ë³€í™˜ëœ ë°ì´í„°ì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ ë°˜í™˜)
    function getActionDisplayText(action) {
      if (!action) return '-';
      // ì´ë¯¸ íŒŒì‹± ë‹¨ê³„ì—ì„œ CHECK/CALLë¡œ ë³€í™˜ë˜ì—ˆìŒ
      return action.toUpperCase();
    }
    
    function getPositionBadgeClass(position) {
      const posMap = {
        'BTN': 'btn',
        'SB': 'sb',
        'BB': 'bb',
        'UTG': 'utg',
        'MP': 'mp',
        'CO': 'co'
      };
      return posMap[position] || '';
    }
    
    // ì¹´ë©”ë¼ íŒŒì¼ëª… ë³€í™˜ í•¨ìˆ˜
    function formatCameraFileName(camFiles) {
      if (!camFiles || camFiles.length === 0) return [];
      
      const formattedFiles = [];
      
      // ì¹´ë©”ë¼ ì´ë¦„ê³¼ ë²ˆí˜¸ë¥¼ í˜ì–´ë¡œ ì²˜ë¦¬
      for (let i = 0; i < camFiles.length; i += 2) {
        const camName = camFiles[i];
        const camNumber = camFiles[i + 1];
        
        if (camName && camNumber) {
          // ìˆ«ìë¥¼ 4ìë¦¬ë¡œ íŒ¨ë”© (ì˜ˆ: 115 -> 0115)
          const paddedNumber = String(camNumber).padStart(4, '0');
          formattedFiles.push(camName + paddedNumber);
        } else if (camName && !camNumber) {
          // ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ ê·¸ëŒ€ë¡œ ì¶”ê°€
          formattedFiles.push(camName);
        }
      }
      
      return formattedFiles;
    }
    
    // ====================================
    // ê°„ë‹¨í•œ ë°ì´í„° ê²€ì¦ í•¨ìˆ˜
    // ====================================
    
    function isCSVDataValid(newData) {
      // ê¸°ë³¸ì ì¸ ë°ì´í„° ìœ íš¨ì„±ë§Œ ì²´í¬
      if (!newData || newData.length === 0) {
        console.warn('âš ï¸ CSV ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ');
        return false;
      }
      
      // í•¸ë“œ ë²ˆí˜¸ê°€ ìˆëŠ” ë°ì´í„° í™•ì¸
      const validHands = newData.filter(h => h.handNumber && !isNaN(parseInt(h.handNumber)));
      if (validHands.length === 0) {
        console.warn('âš ï¸ ìœ íš¨í•œ í•¸ë“œê°€ ì—†ìŒ');
        return false;
      }
      
      return true;
    }
    
    // ====================================
    // ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
    // ====================================
    
    async function loadIndexData(suppressNotification = false) {
      console.log(`ğŸ”„ loadIndexData í˜¸ì¶œ - ì•Œë¦¼ ì–µì œ: ${suppressNotification}, ì´ˆê¸°ë¡œë“œ: ${isInitialLoad}`);
      try {
        // ëœë¤ íŒŒë¼ë¯¸í„° ì¶”ê°€ë¡œ ìºì‹œ ë°©ì§€ ê°•í™”
        const randomParam = Math.random().toString(36).substring(7);
        const csvUrl = CONFIG.CSV_INDEX_URL + '&t=' + Date.now() + '&r=' + randomParam;
        console.log(`ğŸŒ CSV ë°ì´í„° ê°€ì ¸ì˜¤ê¸°: ${csvUrl.substring(0, 100)}...`);
        
        const response = await fetch(csvUrl);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const text = await response.text();
        console.log(`ğŸ“„ CSV ì›ë³¸ ë°ì´í„° í¬ê¸°: ${text.length}ë¬¸ì`);
        
        const rows = parseCSV(text);
        console.log(`ğŸ“„ íŒŒì‹±ëœ í–‰ ìˆ˜: ${rows.length}ê°œ`);
        
        const dataRows = rows.slice(1);
        
        // CSVì—ì„œ ì½ì€ ìƒˆë¡œìš´ í•¸ë“œ ë°ì´í„°
        const newHandsFromCSV = dataRows.map(row => {
          // lastActionì—ì„œë„ CHECK/CALL í†µí•©
          let lastAction = row[15];
          if (lastAction === 'CHECK' || lastAction === 'CALL') {
            lastAction = 'CHECK/CALL';
          }
          
          return {
            handNumber: row[0],
            startRow: parseInt(row[1]),
            endRow: parseInt(row[2]),
            handUpdatedAt: row[3],
            handEdit: row[4] === 'TRUE',
            handEditTime: row[5],
            table: row[7],
            cam: row[9], // Jì—´ - Cam ì •ë³´
            camFiles: formatCameraFileName([row[10], row[11], row[12], row[13]].filter(file => file && file.trim())), // K-Nì—´ - CamFile ì •ë³´ë¥¼ ë³€í™˜
            lastStreet: row[14],
            lastAction: lastAction,
            workStatus: row[16] || 'ëŒ€ê¸°ì¤‘'
          };
        });
        
        // ê¸°ë³¸ì ì¸ ë°ì´í„° ìœ íš¨ì„± ì²´í¬
        if (!isCSVDataValid(newHandsFromCSV)) {
          console.warn('ğŸš« ë¹„ì–´ìˆëŠ” CSV ë°ì´í„°, ëŒ€ê¸°ì¤‘...');
          return;
        }
        
        console.log(`ğŸ“„ CSVì—ì„œ ${newHandsFromCSV.length}ê°œ í•¸ë“œ ë¡œë“œ ì™„ë£Œ`);
        if (DEBUG_MODE && newHandsFromCSV.length > 0) {
          console.log('ğŸ” ë¡œë“œëœ í•¸ë“œ ë²ˆí˜¸:', newHandsFromCSV.map(h => h.handNumber).slice(0, 5));
        }
        
        // ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡ì— ë³‘í•© (ì‚­ì œí•˜ì§€ ì•Šê³  ì¶”ê°€ë§Œ)
        for (const hand of newHandsFromCSV) {
          masterHandList.set(hand.handNumber, hand);
        }
        
        // í‘œì‹œìš© ë°°ì—´ ìƒì„± (ë§ˆìŠ¤í„° ëª©ë¡ì—ì„œ)
        allHands = Array.from(masterHandList.values());
        allHands.sort((a, b) => parseInt(b.handNumber) - parseInt(a.handNumber));
        
        console.log(`ğŸ“ ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡: ì´ ${masterHandList.size}ê°œ í•¸ë“œ`);
        
        // ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡ ì €ì¥
        saveMasterHandList();
        
        // ìƒˆ í•¸ë“œ ê°ì§€ ë° ì•Œë¦¼ ì²˜ë¦¬
        if (!isInitialLoad && !suppressNotification) {
          const handsToNotify = [];
          
          for (const hand of newHandsFromCSV) {
            const handNumber = hand.handNumber;
            
            // RecentHandsBufferì— ì¶”ê°€ - ìƒˆ í•¸ë“œì´ë©´ true ë°˜í™˜
            if (recentHandsBuffer.addHand(handNumber)) {
              handsToNotify.push(handNumber);
            }
          }
          
          // ì•Œë¦¼ ë°œì†¡
          if (handsToNotify.length > 0 && CONFIG.ENABLE_NOTIFICATIONS) {
            console.log(`ğŸ”” ìƒˆë¡œìš´ í•¸ë“œ ì•Œë¦¼: ${handsToNotify.join(', ')}`);
            showNotification(`${handsToNotify.length}ê°œì˜ ìƒˆë¡œìš´ í•¸ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! (${handsToNotify.join(', ')})`);
            playSound('notification');
            
            // ê¸°ì¡´ ì•Œë¦¼ ì‹œìŠ¤í…œì—ë„ ê¸°ë¡ (í˜¸í™˜ì„±)
            const now = Date.now();
            for (const handNumber of handsToNotify) {
              notifiedHands[handNumber] = now;
            }
            saveNotifiedHands(notifiedHands);
          }
        } else if (isInitialLoad) {
          // ì´ˆê¸° ë¡œë”©ì‹œ ëª¨ë“  í•¸ë“œë¥¼ ë²„í¼ì— ì¶”ê°€ (ì•Œë¦¼ ì—†ì´)
          console.log(`ğŸ” ì´ˆê¸° ë¡œë”©: ${newHandsFromCSV.length}ê°œ í•¸ë“œë¥¼ ë²„í¼ì— ì¶”ê°€`);
          
          // ëª¨ë“  í•¸ë“œë¥¼ ë²„í¼ì— ì¶”ê°€ (ìµœëŒ€ 100ê°œê¹Œì§€ ì €ì¥)
          for (const hand of newHandsFromCSV) {
            recentHandsBuffer.addHand(hand.handNumber);
          }
          
          // ì´ˆê¸° ë¡œë”© ì™„ë£Œ ì²˜ë¦¬
          isInitialLoad = false;
          const bufferStatus = recentHandsBuffer.getStatus();
          console.log(`ğŸš€ ì´ˆê¸° ë¡œë”© ì™„ë£Œ. í•¸ë“œ ìˆ˜: ${newHandsFromCSV.length}ê°œ, ë²„í¼: ${bufferStatus.size}ê°œ`);
        }
        
        updateHandList();
        updateStats();
        
      } catch (error) {
        console.error('Index ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }
    
    async function loadHandData(handNumber) {
      try {
        const response = await fetch(CONFIG.CSV_HAND_URL + '&t=' + Date.now());
        const text = await response.text();
        const rows = parseCSV(text);
        
        const hand = allHands.find(h => h.handNumber === handNumber);
        if (!hand) return null;
        
        const handRows = rows.slice(hand.startRow - 1, hand.endRow);
        return parseHandDetails(handRows);
        
      } catch (error) {
        console.error('Hand ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        return null;
      }
    }
    
    function parseHandDetails(rows) {
      const hand = {
        number: '',
        table: '',
        blinds: { sb: 0, bb: 0 },
        players: [],
        actions: [],
        communityCards: [],
        pot: 0,
        winner: null,
        streets: {
          preflop: [],
          flop: [],
          turn: [],
          river: [],
          showdown: []
        }
      };
      
      let currentStreet = 'preflop';
      let streetBetAmount = {}; // ê° ìŠ¤íŠ¸ë¦¬íŠ¸ì˜ í˜„ì¬ ë² íŒ… ê¸ˆì•¡ ì¶”ì 
      streetBetAmount['preflop'] = 0;
      streetBetAmount['flop'] = 0;
      streetBetAmount['turn'] = 0;
      streetBetAmount['river'] = 0;
      
      for (const row of rows) {
        const rowType = row[1];
        
        switch (rowType) {
          case 'HAND':
            hand.number = row[2];
            hand.timestamp = row[3];
            if (row[11] && row[12]) {
              hand.blinds.sb = parseInt(row[11]) || 0;
              hand.blinds.bb = parseInt(row[12]) || 0;
            }
            hand.table = row[16] || '';
            break;
          
          case 'PLAYER':
            const playerName = row[2];
            const seat = parseInt(row[3]) || 0;
            const chips = parseInt(row[5]) || parseInt(row[6]) || 0;
            const cards = row[7] ? row[7].split(' ') : ['?', '?'];
            
            hand.players.push({
              seat: seat,
              name: playerName,
              chips: chips,
              cards: cards.length >= 2 ? cards : [cards[0] || '?', cards[1] || '?'],
              position: '',
              status: 'active'
            });
            break;
          
          case 'EVENT':
            const eventType = row[2];
            
            if (eventType === 'BOARD') {
              const boardNum = parseInt(row[3]) || 0;
              const card = row[4];
              
              if (boardNum === 1) {
                currentStreet = 'flop';
                streetBetAmount['flop'] = 0; // í”Œë¡­ ì‹œì‘ì‹œ ë² íŒ… ê¸ˆì•¡ ì´ˆê¸°í™”
                // ì²« ë²ˆì§¸ í”Œë¡­ ì¹´ë“œ ì¶”ê°€ (ë°°ì—´ ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ)
                hand.communityCards.push(card);
              } else if (boardNum === 2 || boardNum === 3) {
                // ë‘ ë²ˆì§¸, ì„¸ ë²ˆì§¸ í”Œë¡­ ì¹´ë“œ ì¶”ê°€
                hand.communityCards.push(card);
              } else if (boardNum === 4) {
                currentStreet = 'turn';
                streetBetAmount['turn'] = 0; // í„´ ì‹œì‘ì‹œ ë² íŒ… ê¸ˆì•¡ ì´ˆê¸°í™”
                hand.communityCards.push(card);
              } else if (boardNum === 5) {
                currentStreet = 'river';
                streetBetAmount['river'] = 0; // ë¦¬ë²„ ì‹œì‘ì‹œ ë² íŒ… ê¸ˆì•¡ ì´ˆê¸°í™”
                hand.communityCards.push(card);
              }
            } else {
              const playerNum = row[3];
              const amount = parseInt(row[4]) || 0;
              
              const playerObj = hand.players.find(p => p.seat === parseInt(playerNum));
              const playerName = playerObj ? playerObj.name : `Player ${playerNum}`;
              
              // CHECKì™€ CALLì„ ìŠ¤ë§ˆíŠ¸í•˜ê²Œ êµ¬ë¶„
              let displayAction = eventType;
              const currentBet = streetBetAmount[currentStreet] || 0;
              
              // CALL ì•¡ì…˜ ì²˜ë¦¬
              if (eventType === 'CALL') {
                // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ…ì´ ì—†ê³  amountê°€ 0ì´ê±°ë‚˜ ì‘ìœ¼ë©´ CHECK
                // ë˜ëŠ” CALLí•˜ë ¤ëŠ” ê¸ˆì•¡ì´ í˜„ì¬ ë² íŒ…ê³¼ ê°™ìœ¼ë©´ CHECK
                if ((currentBet === 0 && amount <= hand.blinds.bb) || amount === currentBet) {
                  displayAction = 'CHECK/CALL';
                  if (DEBUG_MODE) {
                    console.log(`âœ… CHECK ê°ì§€: ${playerName} (${currentStreet}, bet=${currentBet}, amount=${amount})`);
                  }
                } else {
                  // ì§„ì§œ CALL
                  displayAction = 'CHECK/CALL';
                  if (DEBUG_MODE) {
                    console.log(`ğŸ“ CALL ê°ì§€: ${playerName} ${amount} (${currentStreet}, bet=${currentBet})`);
                  }
                }
              } else if (eventType === 'CHECK') {
                displayAction = 'CHECK/CALL';
              }
              
              // BETì´ë‚˜ RAISEê°€ ë°œìƒí•˜ë©´ í•´ë‹¹ ìŠ¤íŠ¸ë¦¬íŠ¸ì˜ ë² íŒ… ê¸ˆì•¡ ì—…ë°ì´íŠ¸
              if (eventType === 'BET' || eventType === 'RAISE' || eventType === 'RAISE TO') {
                streetBetAmount[currentStreet] = amount;
                if (DEBUG_MODE) {
                  console.log(`ğŸ“Š ${currentStreet} ë² íŒ… ì—…ë°ì´íŠ¸: ${amount}`);
                }
              }
              
              const action = {
                player: playerName,
                action: displayAction,
                amount: amount,
                street: currentStreet
              };
              
              hand.actions.push(action);
              hand.streets[currentStreet].push(action);
              
              // pot ê³„ì‚°: amountê°€ ìˆëŠ” ê²½ìš°ë§Œ ì¶”ê°€
              if (amount > 0) {
                // BET, CALL (with amount), RAISE, RAISE TO, ALL-IN ë“±
                if (eventType === 'BET' || eventType === 'CALL' || eventType === 'RAISE' || eventType === 'RAISE TO' || eventType === 'ALL-IN' || eventType === 'ALLIN') {
                  hand.pot += amount;
                  
                  if (DEBUG_MODE) {
                    console.log(`ğŸ’° POT ì¶”ê°€: ${playerName} ${displayAction} ${amount} (í˜„ì¬ POT: ${hand.pot})`);
                  }
                }
              }
              
              if (eventType === 'FOLD' && playerObj) {
                playerObj.status = 'folded';
              }
            }
            break;
          
          case 'WIN':
            const winnerNum = row[2];
            const winAmount = parseInt(row[3]) || 0;
            const winnerObj = hand.players.find(p => p.seat === parseInt(winnerNum));
            
            hand.winner = {
              player: winnerObj ? winnerObj.name : `Player ${winnerNum}`,
              amount: winAmount,
              hand: row[4] || ''
            };
            break;
        }
      }
      
      calculatePositions(hand);
      return hand;
    }
    
    function calculatePositions(hand) {
      const playerCount = hand.players.length;
      if (playerCount < 2) return;
      
      const positions = getPositionNames(playerCount);
      hand.players.forEach((player, index) => {
        player.position = positions[index];
      });
    }
    
    function getPositionNames(playerCount) {
      const positions = {
        2: ['BTN', 'BB'],
        3: ['BTN', 'SB', 'BB'],
        4: ['BTN', 'SB', 'BB', 'CO'],
        5: ['BTN', 'SB', 'BB', 'UTG', 'CO'],
        6: ['BTN', 'SB', 'BB', 'UTG', 'MP', 'CO'],
        7: ['BTN', 'SB', 'BB', 'UTG', 'UTG+1', 'MP', 'CO'],
        8: ['BTN', 'SB', 'BB', 'UTG', 'UTG+1', 'MP', 'MP+1', 'CO'],
        9: ['BTN', 'SB', 'BB', 'UTG', 'UTG+1', 'UTG+2', 'MP', 'MP+1', 'CO']
      };
      
      return positions[playerCount] || Array(playerCount).fill('').map((_, i) => `Seat ${i + 1}`);
    }
    
    // ====================================
    // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    // ====================================
    
    function updateHandList() {
      const listEl = document.getElementById('hand-list');
      const tableFilter = document.getElementById('table-filter').value;
      const statusFilter = document.getElementById('status-filter').value;
      
      let filteredHands = allHands;
      
      if (tableFilter) {
        filteredHands = filteredHands.filter(h => h.table === tableFilter);
      }
      
      if (statusFilter) {
        filteredHands = filteredHands.filter(h => {
          if (statusFilter === 'completed') return h.handEdit;
          if (statusFilter === 'pending') return !h.handEdit;
          return true;
        });
      }
      
      listEl.innerHTML = filteredHands.map(hand => {
        // ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
        const statusColor = hand.handEdit ? 'border-green-500 bg-green-900/20' : 
                          hand.workStatus === 'ì§„í–‰ì¤‘' ? 'border-yellow-500 bg-yellow-900/20' : 
                          'border-gray-600 bg-gray-800';
        
        // ìŠ¤íŠ¸ë¦¬íŠ¸ë³„ ìƒ‰ìƒ
        const streetColors = {
          'preflop': 'text-purple-400',
          'flop': 'text-blue-400', 
          'turn': 'text-green-400',
          'river': 'text-orange-400',
          'showdown': 'text-yellow-400'
        };
        const streetColor = streetColors[hand.lastStreet?.toLowerCase()] || 'text-gray-400';
        
        // ì‹œê°„ í‘œì‹œ í¬ë§·
        const time = hand.handUpdatedAt ? new Date(hand.handUpdatedAt).toLocaleTimeString('ko-KR', {
          hour: '2-digit',
          minute: '2-digit'
        }) : '-';
        
        // ì¹´ë©”ë¼ íŒŒì¼ëª… ì •ë³´ (ì´ë¯¸ ë³€í™˜ëœ í˜•íƒœ)
        const camFilesText = hand.camFiles && hand.camFiles.length > 0 ? 
          hand.camFiles.slice(0, 2).join(', ') + 
          (hand.camFiles.length > 2 ? ` (+${hand.camFiles.length - 2})` : '') : 
          'íŒŒì¼ ì—†ìŒ';

        return `
        <div class="rounded-lg p-3 cursor-pointer hover:scale-105 transition-all border ${statusColor}" 
             onclick="selectHand('${hand.handNumber}')">
          <div class="flex items-center justify-between mb-1">
            <span class="text-sm font-bold text-white">Hand #${hand.handNumber}</span>
            ${hand.handEdit ? '<span class="text-green-400">âœ“</span>' : 
              hand.workStatus === 'ì§„í–‰ì¤‘' ? '<span class="text-yellow-400">âš¡</span>' : ''}
          </div>
          <div class="flex items-center justify-between text-xs">
            <span class="text-gray-300">${hand.table || 'í…Œì´ë¸” -'}</span>
            <span class="${streetColor} font-semibold">${hand.lastStreet || 'Preflop'}</span>
          </div>
          <div class="flex items-center justify-between text-xs mt-1">
            <span class="text-gray-500">${hand.lastAction || '-'}</span>
            <span class="text-gray-500">${time}</span>
          </div>
          <div class="text-xs text-blue-300 mt-1 truncate" title="${hand.camFiles?.join(', ') || ''}">
            ğŸ“¹ ${camFilesText}
          </div>
        </div>
      `;
      }).join('');
      
      document.getElementById('hand-count').textContent = filteredHands.length;
      
      // í…Œì´ë¸” í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸ (í˜„ì¬ ì„ íƒëœ ê°’ ìœ ì§€)
      const tables = [...new Set(allHands.map(h => h.table).filter(t => t))];
      const tableFilterEl = document.getElementById('table-filter');
      const currentTable = tableFilterEl.value;
      
      // í…Œì´ë¸” ëª©ë¡ì´ ë‹¬ë¼ì¡Œì„ ë•Œë§Œ ì—…ë°ì´íŠ¸
      const currentOptions = Array.from(tableFilterEl.options).slice(1).map(opt => opt.value);
      const hasChanged = tables.length !== currentOptions.length || 
                        tables.some(t => !currentOptions.includes(t));
      
      if (hasChanged) {
        tableFilterEl.innerHTML = '<option value="">ëª¨ë“  í…Œì´ë¸”</option>' +
          tables.map(table => `<option value="${table}">${table}</option>`).join('');
      }
      
      // í˜„ì¬ ì„ íƒëœ ê°’ ë³µì›
      if (currentTable && tables.includes(currentTable)) {
        tableFilterEl.value = currentTable;
      }
    }
    
    function updateStats() {
      document.getElementById('total-hands').textContent = allHands.length;
      document.getElementById('completed-hands').textContent = allHands.filter(h => h.handEdit).length;
    }
    
    async function selectHand(handNumber) {
      currentHand = handNumber;
      
      const hand = await loadHandData(handNumber);
      if (!hand) return;
      
      // ì¸ë±ìŠ¤ì—ì„œ ì¹´ë©”ë¼ íŒŒì¼ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const indexHand = allHands.find(h => h.handNumber === handNumber);
      
      // í—¤ë” ì •ë³´ ì—…ë°ì´íŠ¸
      document.getElementById('hand-number').textContent = hand.number;
      document.getElementById('table-name').textContent = hand.table || '-';
      document.getElementById('blinds').textContent = `${hand.blinds.sb}/${hand.blinds.bb}`;
      document.getElementById('pot-amount').textContent = formatNumber(hand.pot);
      
      // ì¹´ë©”ë¼ íŒŒì¼ëª… ì—…ë°ì´íŠ¸ (ì´ë¯¸ ë³€í™˜ëœ í˜•íƒœ)
      const cameraFilesEl = document.getElementById('camera-files');
      if (indexHand && indexHand.camFiles && indexHand.camFiles.length > 0) {
        cameraFilesEl.textContent = indexHand.camFiles.join(', ');
        cameraFilesEl.title = indexHand.camFiles.join('\n');
      } else {
        cameraFilesEl.textContent = 'íŒŒì¼ ì—†ìŒ';
        cameraFilesEl.title = '';
      }
      
      // ë³´ë“œ ì¹´ë“œ í‘œì‹œ
      updateBoardCards(hand.communityCards);
      
      // í”Œë ˆì´ì–´ ì¹´ë“œ í‘œì‹œ
      updatePlayersSection(hand.players);
      
      // ì•¡ì…˜ íˆìŠ¤í† ë¦¬ í‘œì‹œ
      updateActionHistory(hand);
      
      // í•¸ë“œ ê²°ê³¼ í‘œì‹œ
      updateHandResult(hand);
      
      // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì™„ë£Œ ìƒíƒœì— ë”°ë¼)
      updateHandStatus(indexHand ? indexHand.handEdit : false);
    }
    
    function updateBoardCards(cards) {
      const container = document.getElementById('board-cards');
      
      // 5ì¥ì˜ ì¹´ë“œ ìŠ¬ë¡¯ í‘œì‹œ (ë¹„ì–´ìˆëŠ” ê²ƒì€ í°ìƒ‰ ì ì„ )
      let html = '';
      for (let i = 0; i < 5; i++) {
        if (cards && cards[i]) {
          html += createCardElement(cards[i], 'board');
        } else {
          html += '<div class="board-card" style="background-color: #FFFFFF !important; color: #9ca3af; border: 2px dashed #d1d5db; color-scheme: light;">?</div>';
        }
      }
      
      container.innerHTML = html;
    }
    
    function updatePlayersSection(players) {
      const container = document.getElementById('players-section');
      
      container.innerHTML = players.map(player => `
        <div class="player-item ${player.status === 'folded' ? 'folded' : ''}">
          <div class="flex items-center gap-2">
            <span class="pos-badge ${getPositionBadgeClass(player.position)}">${player.position}</span>
            <span class="text-xs font-semibold">${player.name}</span>
          </div>
          <div class="flex items-center gap-2">
            ${player.cards.map(card => createCardElement(card)).join('')}
            <span class="text-xs text-gray-400">${formatNumber(player.chips)}</span>
          </div>
        </div>
      `).join('');
    }
    
    function updateActionHistory(hand) {
      const container = document.getElementById('action-history');
      const streets = ['preflop', 'flop', 'turn', 'river', 'showdown'];
      
      let html = '';
      
      streets.forEach(street => {
        if (hand.streets[street] && hand.streets[street].length > 0) {
          html += `<div class="mb-2">`;
          html += `<div class="text-xs font-semibold text-gray-400 uppercase mb-1">${street}</div>`;
          hand.streets[street].forEach(action => {
            html += `
              <div class="action-line ${street}">
                <span class="text-xs">${action.player}</span>
                <span class="action-badge ${getActionBadgeClass(action.action)}">${action.action}</span>
                ${action.amount > 0 ? `<span class="text-xs text-gray-400">${formatNumber(action.amount)}</span>` : ''}
              </div>
            `;
          });
          html += `</div>`;
        }
      });
      
      container.innerHTML = html || '<div class="text-xs text-gray-500">ì•¡ì…˜ ê¸°ë¡ ì—†ìŒ</div>';
    }
    
    function updateHandResult(hand) {
      const container = document.getElementById('hand-result');
      
      if (!hand.winner) {
        container.innerHTML = '<div class="text-xs text-gray-400">ê²°ê³¼ ì—†ìŒ</div>';
        return;
      }
      
      container.innerHTML = `
        <div class="text-sm font-bold text-green-400">${hand.winner.player}</div>
        <div class="text-xs text-gray-300">Win: ${formatNumber(hand.winner.amount)}</div>
        ${hand.winner.hand ? `<div class="text-xs text-gray-400">${hand.winner.hand}</div>` : ''}
      `;
    }
    
    // ====================================
    // ì•Œë¦¼ í•¨ìˆ˜
    // ====================================
    
    function showNotification(message) {
      if (!CONFIG.ENABLE_NOTIFICATIONS) return;
      
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification('í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§', {
          body: message,
          icon: '/favicon.ico'
        });
      }
    }
    
    // ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í˜¸ì¶œ ê°ì§€
    let userInteracted = false;
    document.addEventListener('click', () => { userInteracted = true; }, { once: true });
    document.addEventListener('keydown', () => { userInteracted = true; }, { once: true });
    
    function playSound(type = 'notification') {
      if (!CONFIG.ENABLE_SOUND) {
        console.log('ğŸ”‡ ì†Œë¦¬ ë¹„í™œì„±í™” ìƒíƒœ');
        return;
      }
      
      if (!userInteracted) {
        console.log('ğŸ”‡ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ëŒ€ê¸° ì¤‘ - ì†Œë¦¬ ì¬ìƒ ê±´ë„ˆë›°ê¸°');
        return;
      }
      
      console.log(`ğŸ”” ì†Œë¦¬ ì¬ìƒ ì‹œë„: ${type}`);
      
      const soundMap = {
        // ë¶€ë“œëŸ¬ìš´ ë²¨ ì†Œë¦¬ (ìƒˆ í•¸ë“œ ì•Œë¦¼ìš©)
        notification: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+zPDTgjMGHm7A7+OZURE',
        
        // ì„±ê³µ ì†Œë¦¬ (ì™„ë£Œ/ì—…ë°ì´íŠ¸ ì„±ê³µì‹œ)
        success: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+zPDTgjMGHm7A7+OZURE',
        
        // ì°¨ì„ë²¨ ì†Œë¦¬ (ë” ë¶€ë“œëŸ¬ìš´ ì•Œë¦¼)
        chime: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+zPDTgjMGHm7A7+OZURE'
      };
      
      // Web Audio APIë¥¼ ì‚¬ìš©í•œ ë” ì˜ˆìœ ì†Œë¦¬ ìƒì„±
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        if (type === 'chime') {
          // ë¶€ë“œëŸ¬ìš´ ì°¨ì„ë²¨ ì†Œë¦¬
          playChimeSound(audioContext);
        } else if (type === 'success') {
          // ì„±ê³µ ì†Œë¦¬ (ìƒìŠ¹í•˜ëŠ” í†¤)
          playSuccessSound(audioContext);
        } else {
          // ê¸°ë³¸ ì•Œë¦¼ ì†Œë¦¬ (ë¶€ë“œëŸ¬ìš´ ë²¨)
          playBellSound(audioContext);
        }
        console.log('âœ… ì†Œë¦¬ ì¬ìƒ ì„±ê³µ');
      } catch (error) {
        console.log('âš ï¸ ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', error.message);
        // Web Audio API ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ì˜¤ë””ì˜¤ ì‚¬ìš©
        const audio = new Audio(soundMap[type] || soundMap.notification);
        audio.volume = 0.5;
        audio.play().catch(e => console.log('ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e));
      }
    }
    
    // ë¶€ë“œëŸ¬ìš´ ë²¨ ì†Œë¦¬ ìƒì„±
    function playBellSound(audioContext) {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.3);
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
      
      oscillator.type = 'sine';
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.8);
    }
    
    // ì„±ê³µ ì†Œë¦¬ ìƒì„± (ìƒìŠ¹í•˜ëŠ” 3ìŒê³„)
    function playSuccessSound(audioContext) {
      const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
      const duration = 0.15;
      
      frequencies.forEach((freq, index) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + (index * duration));
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime + (index * duration));
        gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + (index * duration) + 0.02);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + (index * duration) + duration);
        
        oscillator.start(audioContext.currentTime + (index * duration));
        oscillator.stop(audioContext.currentTime + (index * duration) + duration);
      });
    }
    
    // ì°¨ì„ë²¨ ì†Œë¦¬ ìƒì„± (í™”ìŒ)
    function playChimeSound(audioContext) {
      const frequencies = [523.25, 659.25, 783.99, 1046.5]; // C5, E5, G5, C6 í™”ìŒ
      
      frequencies.forEach((freq, index) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
        oscillator.type = 'sine';
        
        const volume = 0.15 / (index + 1); // ë†’ì€ ìŒì¼ìˆ˜ë¡ ì‘ê²Œ
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.05);
        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1.2);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 1.2);
      });
    }
    
    // ====================================
    // í•¸ë“œ í¸ì§‘ ìƒíƒœ ì—…ë°ì´íŠ¸
    // ====================================
    
    // í•¸ë“œ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
    async function getHandTimestamp(handNumber) {
      try {
        const response = await fetch(CONFIG.CSV_HAND_URL + '&t=' + Date.now());
        const text = await response.text();
        const rows = parseCSV(text);
        
        for (const row of rows) {
          if (row[1] === 'HAND' && row[2] === String(handNumber)) {
            const timestamp = parseInt(row[3]);
            if (!isNaN(timestamp) && timestamp > 0) {
              return timestamp;
            }
          }
        }
      } catch (error) {
        console.error('í•¸ë“œ ì‹œê°„ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
      }
      return null;
    }
    
    // ë¡œê·¸ í•¨ìˆ˜ë“¤
    let logMessages = [];
    
    function addLogMessage(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString('ko-KR');
      const logEntry = {
        time: timestamp,
        message: message,
        type: type // info, success, warning, error
      };
      logMessages.push(logEntry);
      
      // ë¡œê·¸ ë©”ì‹œì§€ ì°½ ì—…ë°ì´íŠ¸
      const logDiv = document.getElementById('log-messages');
      if (logDiv) {
        const colorClass = {
          info: 'text-blue-400',
          success: 'text-green-400',
          warning: 'text-yellow-400',
          error: 'text-red-400'
        }[type] || 'text-gray-400';
        
        const logLine = document.createElement('div');
        logLine.className = colorClass;
        logLine.textContent = `[${timestamp}] ${message}`;
        logDiv.appendChild(logLine);
        
        // ìë™ ìŠ¤í¬ë¡¤
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
    
    function showLogModal() {
      logMessages = [];
      const logModal = document.getElementById('log-modal');
      const logDiv = document.getElementById('log-messages');
      if (logDiv) logDiv.innerHTML = '';
      if (logModal) logModal.classList.remove('hidden');
      
      addLogMessage('ğŸš€ í•¸ë“œ í¸ì§‘ ì™„ë£Œ í”„ë¡œì„¸ìŠ¤ ì‹œì‘', 'info');
    }
    
    function closeLogModal() {
      const logModal = document.getElementById('log-modal');
      if (logModal) logModal.classList.add('hidden');
    }
    
    window.closeLogModal = closeLogModal;
    
    // Progress Bar ì œì–´ í•¨ìˆ˜ë“¤
    function showVirtualMatchingProgress() {
      const progressDiv = document.getElementById('virtual-matching-progress');
      if (progressDiv) {
        progressDiv.classList.remove('hidden');
      }
    }
    
    function hideVirtualMatchingProgress() {
      const progressDiv = document.getElementById('virtual-matching-progress');
      if (progressDiv) {
        progressDiv.classList.add('hidden');
      }
    }
    
    function updateProgress(percentage, status, details) {
      const progressBar = document.getElementById('progress-bar');
      const progressPercentage = document.getElementById('progress-percentage');
      const progressStatus = document.getElementById('progress-status');
      const progressDetails = document.getElementById('progress-details');
      
      if (progressBar) progressBar.style.width = `${percentage}%`;
      if (progressPercentage) progressPercentage.textContent = `${percentage}%`;
      if (progressStatus && status) progressStatus.textContent = status;
      if (progressDetails && details) progressDetails.textContent = details;
    }
    
    // Virtual ì‹œíŠ¸ì—ì„œ ê°€ì¥ ë¹„ìŠ·í•œ ì‹œê°„ ì°¾ê¸° (ë‚ ì§œ ì œì™¸, ì‹œê°„ë§Œ ë¹„êµ)
    async function findClosestVirtualRow(targetTime, virtualSheetUrl) {
      // Progress Bar í‘œì‹œ ì‹œì‘
      showVirtualMatchingProgress();
      updateProgress(0, 'Virtual ì‹œíŠ¸ ë§¤ì¹­ ì‹œì‘', 'ì´ˆê¸°í™” ì¤‘...');
      
      // íƒ€ì„ì•„ì›ƒ ì„¤ì • (30ì´ˆ)
      const timeoutPromise = new Promise((_, reject) => {
        setTimeout(() => {
          reject(new Error('Virtual ì‹œíŠ¸ ë§¤ì¹­ ì‹œê°„ ì´ˆê³¼ (30ì´ˆ)'));
        }, 30000);
      });
      
      try {
        // ì‹¤ì œ ë§¤ì¹­ ë¡œì§ì„ Promiseë¡œ ê°ì‹¸ê¸°
        const matchingPromise = (async () => {
          addLogMessage('ğŸ“‹ Virtual ì‹œíŠ¸ ë§¤ì¹­ ì‹œì‘', 'info');
          addLogMessage(`ëŒ€ìƒ ì‹œê°„: ${new Date(targetTime * 1000).toLocaleTimeString('ko-KR')}`, 'info');
          updateProgress(10, 'Virtual ì‹œíŠ¸ ë§¤ì¹­ ì‹œì‘', `ëŒ€ìƒ ì‹œê°„: ${new Date(targetTime * 1000).toLocaleTimeString('ko-KR')}`);
        
          // URL í˜•ì‹ í™•ì¸ ë° ë³€í™˜
          updateProgress(20, 'URL ì²˜ë¦¬ ì¤‘', 'Google Sheets URL ë¶„ì„ ì¤‘...');
          let csvUrl;
          if (virtualSheetUrl.includes('/pub?')) {
            // ì´ë¯¸ CSV ê²Œì‹œ URLì¸ ê²½ìš°
            csvUrl = virtualSheetUrl;
            addLogMessage('âœ… CSV ê²Œì‹œ URL ì‚¬ìš©', 'success');
          } else {
            // ì¼ë°˜ Google Sheets URLì¸ ê²½ìš°
            const sheetIdMatch = virtualSheetUrl.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
            if (!sheetIdMatch) {
              addLogMessage('âŒ ì˜¬ë°”ë¥¸ Google Sheets URLì´ ì•„ë‹™ë‹ˆë‹¤', 'error');
              throw new Error('ì˜¬ë°”ë¥¸ Google Sheets URLì´ ì•„ë‹™ë‹ˆë‹¤');
            }
            const sheetId = sheetIdMatch[1];
            
            // gid ì¶”ì¶œ ì‹œë„
            const gidMatch = virtualSheetUrl.match(/[#&]gid=(\d+)/);
            const gid = gidMatch ? gidMatch[1] : '561799849'; // Virtual ì‹œíŠ¸ ê¸°ë³¸ gid
            
            csvUrl = `https://docs.google.com/spreadsheets/d/e/2PACX-1vTq3wrZNUASAMxl9A6VvJxTT6DKj40xp0R2xcIGfeji6MxQ8wi6Zbu_FWPmxKkmJdPHYgMC6UIT9tvv/pub?gid=${gid}&single=true&output=csv`;
            addLogMessage(`Sheet ID: ${sheetId}`, 'info');
            addLogMessage(`GID: ${gid}`, 'info');
          }
          
          updateProgress(30, 'CSV ë°ì´í„° ë¡œë“œ ì¤‘', 'Google Sheetsì—ì„œ ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì¤‘...');
          addLogMessage('ğŸŒ CSV ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...', 'info');
          const response = await fetch(csvUrl);
          const text = await response.text();
          
          // HTML ì‘ë‹µ ì²´í¬
          if (text.includes('<!DOCTYPE') || text.includes('<html')) {
            addLogMessage('âš ï¸ HTML ì‘ë‹µ ë°›ìŒ - ì‹œíŠ¸ê°€ ë¹„ê³µê°œ ìƒíƒœì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'warning');
            throw new Error('Virtual ì‹œíŠ¸ê°€ ë¹„ê³µê°œ ìƒíƒœì…ë‹ˆë‹¤');
          }
          
          updateProgress(40, 'CSV íŒŒì‹± ì¤‘', 'CSV ë°ì´í„° íŒŒì‹± ì¤‘...');
          const rows = parseCSV(text);
          addLogMessage(`âœ… ${rows.length}ê°œ í–‰ ë¡œë“œë¨`, 'success');
          updateProgress(50, 'ë°ì´í„° ë¡œë“œ ì™„ë£Œ', `${rows.length}ê°œ í–‰ ë¡œë“œ ì™„ë£Œ`);
        
        // íƒ€ê²Ÿ ì‹œê°„ì—ì„œ ì‹œê°„ ë¶€ë¶„ë§Œ ì¶”ì¶œ (HH:MMë§Œ ì‚¬ìš©, ì´ˆ ì œì™¸)
        const targetDate = new Date(targetTime * 1000);
        const targetHours = targetDate.getHours();
        const targetMinutes = targetDate.getMinutes();
        const targetTimeStr = `${targetHours.toString().padStart(2, '0')}:${targetMinutes.toString().padStart(2, '0')}`;
        
        addLogMessage(`ğŸ¯ ì°¾ëŠ” ì‹œê°„: ${targetTimeStr} (ì´ˆ ì œì™¸)`, 'info');
        
        let closestRow = null;
        let minDiff = Infinity;
        let rowIndex = -1;
        let matchedTime = '';
        let checkedCount = 0;
        
          // Cì—´(Seoul ì‹œê°„)ì—ì„œë§Œ ê²€ìƒ‰ - ìµœì í™”ëœ ë¡œì§
          updateProgress(60, 'ì‹œê°„ ë§¤ì¹­ ì‹œì‘', `ëŒ€ìƒ ì‹œê°„: ${targetTimeStr}`);
          addLogMessage('ğŸ” Cì—´(Seoul ì‹œê°„)ì—ì„œ ê²€ìƒ‰ ì¤‘...', 'info');
          
          // Cì—´(index 2)ë§Œ ê²€ìƒ‰
          for (let i = 0; i < rows.length; i++) {
            const cellValue = rows[i][2]; // Cì—´ë§Œ í™•ì¸
            if (!cellValue || !cellValue.trim()) continue;
            
            checkedCount++;
            
            // 10í–‰ë§ˆë‹¤ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            if (checkedCount % 10 === 0) {
              const progressPercent = Math.min(60 + (checkedCount / rows.length) * 35, 95);
              updateProgress(Math.floor(progressPercent), 'ì‹œê°„ ë§¤ì¹­ ì¤‘', `ì²˜ë¦¬ ì¤‘: ${checkedCount}/${rows.length} í–‰ (í˜„ì¬ í–‰: ${i + 1})`);
            }
            
            // HH:MM í˜•ì‹ íŒŒì‹±
            const timeMatch = cellValue.match(/(\d{1,2}):(\d{2})/);
            if (timeMatch) {
              const hours = parseInt(timeMatch[1]);
              const minutes = parseInt(timeMatch[2]);
              
              // ì‹œê°„ê°’ì„ ë¶„ ë‹¨ìœ„ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
              const cellMinutes = hours * 60 + minutes;
              const targetMinutesTotal = targetHours * 60 + targetMinutes;
              const diff = Math.abs(cellMinutes - targetMinutesTotal);
              
              // ê°€ì¥ ê°€ê¹Œìš´ ì‹œê°„ ì—…ë°ì´íŠ¸
              if (diff < minDiff) {
                minDiff = diff;
                closestRow = rows[i];
                rowIndex = i + 1;
                matchedTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                
                // ì •í™•íˆ ì¼ì¹˜í•˜ë©´ ì¦‰ì‹œ ì¢…ë£Œ
                if (diff === 0) {
                  updateProgress(95, 'ì •í™•í•œ ë§¤ì¹˜ ë°œê²¬!', `í–‰ ${rowIndex}ì—ì„œ ì™„ë²½ ì¼ì¹˜`);
                  addLogMessage(`âœ… ì •í™•í•œ ë§¤ì¹­ ë°œê²¬!`, 'success');
                  addLogMessage(`ğŸ“ ìœ„ì¹˜: í–‰ ${rowIndex}, Cì—´`, 'success');
                  addLogMessage(`ğŸ• ë§¤ì¹­ ì‹œê°„: ${matchedTime}`, 'success');
                
                // í–‰ ë°ì´í„° í‘œì‹œ
                if (rows[i][0]) addLogMessage(`Aì—´(Blinds): ${rows[i][0]}`, 'info');
                if (rows[i][1]) addLogMessage(`Bì—´(Cyprus): ${rows[i][1]}`, 'info');
                if (rows[i][3]) addLogMessage(`Dì—´(#): ${rows[i][3]}`, 'info');
                
                console.log(`âœ… Virtual ì‹œíŠ¸ ë§¤ì¹­ ì„±ê³µ!`);
                console.log(`   ğŸ“ ìœ„ì¹˜: í–‰ ${rowIndex}, Cì—´ (Seoul ì‹œê°„)`);
                console.log(`   ğŸ• ì‹œê°„: ${matchedTime}`);
                break;
              }
            }
          }
        }
        
          updateProgress(95, 'ê²€ìƒ‰ ì™„ë£Œ', `ì´ ${checkedCount}ê°œ ì…€ ê²€ìƒ‰ ì™„ë£Œ`);
          addLogMessage(`ì´ ${checkedCount}ê°œ ì…€ ê²€ìƒ‰ ì™„ë£Œ`, 'info');
          
          // ì •í™•í•œ ë§¤ì¹˜ê°€ ì—†ìœ¼ë©´ ê°€ì¥ ê°€ê¹Œìš´ ì‹œê°„ í‘œì‹œ
          if (minDiff > 0) {
            updateProgress(98, 'ê°€ì¥ ê°€ê¹Œìš´ ë§¤ì¹˜', `${minDiff}ë¶„ ì°¨ì´ë¡œ ë§¤ì¹­ ì™„ë£Œ`);
            addLogMessage(`âš ï¸ ì •í™•í•œ ë§¤ì¹˜ ì—†ìŒ`, 'warning');
            addLogMessage(`ğŸ“ ê°€ì¥ ê°€ê¹Œìš´ ì‹œê°„: í–‰ ${rowIndex}, Cì—´`, 'warning');
            addLogMessage(`ğŸ• ${matchedTime} (${minDiff}ë¶„ ì°¨ì´)`, 'warning');
            
            console.log(`âš ï¸ ì •í™•í•œ ë§¤ì¹˜ ì—†ìŒ. ê°€ì¥ ê°€ê¹Œìš´ ì‹œê°„:`);
            console.log(`   ğŸ“ í–‰ ${rowIndex}, Cì—´: ${matchedTime} (${minDiff}ë¶„ ì°¨ì´)`);
          }
          
          updateProgress(100, 'ë§¤ì¹­ ì™„ë£Œ', closestRow ? `í–‰ ${rowIndex} ë§¤ì¹­ ì„±ê³µ` : 'ë§¤ì¹­ ì‹¤íŒ¨');
          
          return {
            row: closestRow,
            rowIndex: rowIndex,
            timeDiff: minDiff,
            targetTime: targetTimeStr,
            matchedTime: matchedTime
          };
        })();
        
        // íƒ€ì„ì•„ì›ƒê³¼ ì‹¤ì œ ì‘ì—…ì„ ê²½ìŸì‹œí‚´
        return await Promise.race([matchingPromise, timeoutPromise]);
        
      } catch (error) {
        // ì—ëŸ¬ ìƒí™© ì²˜ë¦¬
        updateProgress(100, 'ì˜¤ë¥˜ ë°œìƒ', error.message);
        addLogMessage(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
        console.error('Virtual ì‹œíŠ¸ ì ‘ê·¼ ì˜¤ë¥˜:', error);
        
        // 3ì´ˆ í›„ progress bar ìˆ¨ê¸°ê¸°
        setTimeout(() => {
          hideVirtualMatchingProgress();
        }, 3000);
        
        return null;
      } finally {
        // ì„±ê³µì ì¸ ê²½ìš° 2ì´ˆ í›„ progress bar ìˆ¨ê¸°ê¸°
        setTimeout(() => {
          hideVirtualMatchingProgress();
        }, 2000);
      }
    }
    
    // AIë¡œ í•¸ë“œ ë¶„ì„ ë° 3ì¤„ ìš”ì•½
    async function analyzeHandWithAI(handNumber) {
      try {
        const handData = await loadHandData(handNumber);
        if (!handData) return null;
        
        // í•¸ë“œ ì •ë³´ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        let handText = `í¬ì»¤ í•¸ë“œ #${handNumber} ë¶„ì„:\n\n`;
        handText += `ì°¸ê°€ì: ${handData.players.map(p => `${p.name} (${p.position}, ${p.cards?.join(' ') || ''})`).join(', ')}\n`;
        handText += `ë³´ë“œ ì¹´ë“œ: ${handData.board.join(' ')}\n`;
        handText += `ì•¡ì…˜ íˆìŠ¤í† ë¦¬:\n`;
        
        // ê° ìŠ¤íŠ¸ë¦¿ë³„ ì•¡ì…˜ ì¶”ê°€
        const streets = ['preflop', 'flop', 'turn', 'river'];
        for (const street of streets) {
          if (handData.streets[street] && handData.streets[street].length > 0) {
            handText += `- ${street}: ${handData.streets[street].map(a => `${a.player} ${a.action} ${a.amount || ''}`).join(', ')}\n`;
          }
        }
        
        handText += `ìµœì¢… íŒŸ: ${handData.pot}\n`;
        handText += `ìŠ¹ì: ${handData.winner?.player || 'Unknown'} (${handData.winner?.amount || 0} íšë“)\n`;
        
        // AI ì„œë¹„ìŠ¤ í™•ì¸
        if (CONFIG.AI_SERVICE === 'none' || !CONFIG.AI_API_KEY) {
          // ê¸°ë³¸ ìš”ì•½ (ì‹¤ì œ AI ì—†ì´)
          const summary = [
            `${handData.players.length}ëª… ì°¸ì—¬, íŒŸ ${handData.pot}`,
            `ìŠ¹ì: ${handData.winner?.player || 'Unknown'} (${handData.winner?.amount || 0} íšë“)`,
            `í‚¤ ìŠ¤íŠ¸ë¦¿: ${handData.lastStreet || 'preflop'}`
          ].join('\n');
          return summary;
        }
        
        // AI API í˜¸ì¶œ
        let aiResponse = '';
        
        if (CONFIG.AI_SERVICE === 'openai') {
          aiResponse = await callOpenAI(handText);
        } else if (CONFIG.AI_SERVICE === 'gemini') {
          aiResponse = await callGeminiAI(handText);
        } else if (CONFIG.AI_SERVICE === 'claude') {
          aiResponse = await callClaudeAI(handText);
        }
        
        return aiResponse || 'ë¶„ì„ ì‹¤íŒ¨';
      } catch (error) {
        console.error('AI ë¶„ì„ ì˜¤ë¥˜:', error);
        return 'ë¶„ì„ ì‹¤íŒ¨';
      }
    }
    
    // OpenAI API í˜¸ì¶œ
    async function callOpenAI(handText) {
      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${CONFIG.AI_API_KEY}`
          },
          body: JSON.stringify({
            model: CONFIG.AI_MODEL.openai,
            messages: [{
              role: 'system',
              content: 'ë‹¹ì‹ ì€ ê²½í—˜ì´ í’ë¶€í•œ í¬ì»¤ ì½”ì¹˜ì´ì ë¶„ì„ê°€ì…ë‹ˆë‹¤. í•¸ë“œë¥¼ ë¶„ì„í•  ë•Œ ë‹¤ìŒì— ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤: 1) í•€ í¬ì¸íŠ¸ì™€ ì „ëµì  ì˜ì‚¬ê²°ì • 2) ë² íŒ… íŒ¨í„´ê³¼ ì‚¬ì´ì¦ˆ 3) ê°œì„  ê°€ëŠ¥í•œ ë¶€ë¶„. 3ì¤„ë¡œ ê°„ê²°í•˜ê²Œ ìš”ì•½í•˜ë˜, ê° ì¤„ì€ 40ì ì´ë‚´ë¡œ ì‘ì„±í•˜ì„¸ìš”.'
            }, {
              role: 'user',
              content: handText + '\n\nìœ„ í•¸ë“œë¥¼ ë¶„ì„í•˜ì—¬ 3ì¤„ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”. í˜•ì‹:\n1. [ì£¼ìš” ì˜ì‚¬ê²°ì •/í¬ì¸íŠ¸]\n2. [ë² íŒ…/í”Œë ˆì´ íŒ¨í„´]\n3. [ê²°ê³¼/ê°œì„ ì ]'
            }],
            temperature: 0.3,
            max_tokens: 150
          })
        });
        
        if (!response.ok) {
          throw new Error(`OpenAI API ì˜¤ë¥˜: ${response.status}`);
        }
        
        const data = await response.json();
        return data.choices[0].message.content.trim();
      } catch (error) {
        console.error('OpenAI API í˜¸ì¶œ ì‹¤íŒ¨:', error);
        return null;
      }
    }
    
    // Google Gemini API í˜¸ì¶œ
    async function callGeminiAI(handText) {
      try {
        const prompt = `ë‹¹ì‹ ì€ ê²½í—˜ì´ í’ë¶€í•œ í¬ì»¤ ì½”ì¹˜ì…ë‹ˆë‹¤. ë‹¤ìŒ í¬ì»¤ í•¸ë“œë¥¼ ë¶„ì„í•˜ê³  ì¤‘ìš”í•œ í¬ì¸íŠ¸ë¥¼ 3ì¤„ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”.

${handText}

ë¶„ì„ ê²°ê³¼ë¥¼ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ 3ì¤„ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš” (ê° ì¤„ 40ì ì´ë‚´):
1. [ì£¼ìš” ì˜ì‚¬ê²°ì • í¬ì¸íŠ¸]
2. [ë² íŒ… íŒ¨í„´ ë¶„ì„]
3. [ê²°ê³¼ ë° ê°œì„ ì ]`;
        
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${CONFIG.AI_MODEL.gemini}:generateContent?key=${CONFIG.AI_API_KEY}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: prompt
              }]
            }],
            generationConfig: {
              temperature: 0.3,
              maxOutputTokens: 150,
              topP: 0.8,
              topK: 10
            }
          })
        });
        
        if (!response.ok) {
          throw new Error(`Gemini API ì˜¤ë¥˜: ${response.status}`);
        }
        
        const data = await response.json();
        return data.candidates[0].content.parts[0].text.trim();
      } catch (error) {
        console.error('Gemini API í˜¸ì¶œ ì‹¤íŒ¨:', error);
        return null;
      }
    }
    
    // í•¸ë“œì—ì„œ í‚¤ í”Œë ˆì´ì–´ ì°¾ê¸°
    async function getKeyPlayerFromHand(handData) {
      try {
        // Type ì‹œíŠ¸ì—ì„œ Notable í”Œë ˆì´ì–´ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        const TYPE_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=1127201192&single=true&output=csv';
        
        const response = await fetch(TYPE_CSV_URL + '&t=' + Date.now());
        const text = await response.text();
        const rows = parseCSV(text);
        
        const notablePlayers = [];
        for (let i = 1; i < rows.length; i++) {
          const playerName = rows[i][1]; // Bì—´: Player
          const isNotable = rows[i][3];  // Dì—´: Notable
          
          if (isNotable === 'Y' || isNotable === 'y' || isNotable === 'âœ“') {
            notablePlayers.push(playerName);
          }
        }
        
        // í•¸ë“œì—ì„œ Notable í”Œë ˆì´ì–´ ì°¾ê¸°
        for (const player of handData.players) {
          if (notablePlayers.includes(player.name)) {
            return player;
          }
        }
        
        // Notable í”Œë ˆì´ì–´ê°€ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ í”Œë ˆì´ì–´ ë°˜í™˜
        return handData.players[0];
        
      } catch (error) {
        console.error('í‚¤ í”Œë ˆì´ì–´ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
        // ì˜¤ë¥˜ ì‹œ ì²« ë²ˆì§¸ í”Œë ˆì´ì–´ ë°˜í™˜
        return handData.players[0];
      }
    }
    
    // Claude API í˜¸ì¶œ (Anthropic)
    async function callClaudeAI(handText) {
      try {
        const response = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': CONFIG.AI_API_KEY,
            'anthropic-version': '2023-06-01'
          },
          body: JSON.stringify({
            model: CONFIG.AI_MODEL.claude,
            max_tokens: 150,
            messages: [{
              role: 'user',
              content: `ë‹¹ì‹ ì€ ì „ë¬¸ í¬ì»¤ ì½”ì¹˜ì…ë‹ˆë‹¤. ë‹¤ìŒ í•¸ë“œë¥¼ ë¶„ì„í•˜ì—¬ í•µì‹¬ í¬ì¸íŠ¸ë¥¼ 3ì¤„ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”:\n\n${handText}\n\ní˜•ì‹ (40ì ì´ë‚´):\n1. [í•€ í¬ì¸íŠ¸/ì˜ì‚¬ê²°ì •]\n2. [ë² íŒ… íŒ¨í„´]\n3. [ê²°ê³¼/ê°œì„ ì ]`
            }]
          })
        });
        
        if (!response.ok) {
          throw new Error(`Claude API ì˜¤ë¥˜: ${response.status}`);
        }
        
        const data = await response.json();
        return data.content[0].text.trim();
      } catch (error) {
        console.error('Claude API í˜¸ì¶œ ì‹¤íŒ¨:', error);
        return null;
      }
    }
    
    // ì™„ë£Œ ëª¨ë‹¬ í‘œì‹œ
    async function showCompletionModal(handNumber, timestamp, virtualSheetUrl) {
      // ë¡œê·¸ ëª¨ë‹¬ ë¨¼ì € í‘œì‹œ
      showLogModal();
      addLogMessage(`ğŸ“ í•¸ë“œ #${handNumber} í¸ì§‘ ì™„ë£Œ ì²˜ë¦¬ ì‹œì‘`, 'info');
      
      const modal = document.getElementById('completion-modal');
      const timestampInput = document.getElementById('hand-timestamp');
      const filenameInput = document.getElementById('final-filename');
      const summaryTextarea = document.getElementById('ai-summary');
      const matchedRowInput = document.getElementById('matched-row');
      
      // ì‹œê°„ í‘œì‹œ (ë‚ ì§œ ì œì™¸, ì‹œê°„ë§Œ)
      const handDate = new Date(timestamp * 1000);
      const timeString = `${handDate.getHours().toString().padStart(2, '0')}:${handDate.getMinutes().toString().padStart(2, '0')}:${handDate.getSeconds().toString().padStart(2, '0')}`;
      
      addLogMessage(`â° í•¸ë“œ ì‹œê°„: ${timeString}`, 'info');
      
      // í•¸ë“œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      addLogMessage('ğŸ“Š í•¸ë“œ ë°ì´í„° ë¡œë“œ ì¤‘...', 'info');
      const handData = await loadHandData(handNumber);
      
      if (handData) {
        addLogMessage(`âœ… í•¸ë“œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ (${handData.players.length}ëª… í”Œë ˆì´ì–´)`, 'success');
      } else {
        addLogMessage('âš ï¸ í•¸ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨', 'warning');
      }
      
      // íŒŒì¼ëª… ìƒì„± (í•¸ë“œë²ˆí˜¸_í‚¤í”Œë ˆì´ì–´_ì¹´ë“œ_ìƒëŒ€_ì¹´ë“œ)
      let filename = `${handNumber}`;
      
      if (handData && handData.players && handData.players.length > 0) {
        // Notable í”Œë ˆì´ì–´ ì°¾ê¸° (ë˜ëŠ” ì²« ë²ˆì§¸ í”Œë ˆì´ì–´)
        const keyPlayer = await getKeyPlayerFromHand(handData);
        
        if (keyPlayer) {
          // í‚¤ í”Œë ˆì´ì–´ ì´ë¦„ê³¼ ì¹´ë“œ
          filename += `_${keyPlayer.name}`;
          if (keyPlayer.cards && keyPlayer.cards.length > 0) {
            filename += `_${keyPlayer.cards.join('').replace(/[\s]/g, '')}`;
          }
          
          // ìƒëŒ€ í”Œë ˆì´ì–´ (ì²« ë²ˆì§¸ ìƒëŒ€)
          const opponent = handData.players.find(p => p.name !== keyPlayer.name);
          if (opponent) {
            filename += `_${opponent.name}`;
            if (opponent.cards && opponent.cards.length > 0) {
              filename += `_${opponent.cards.join('').replace(/[\s]/g, '')}`;
            }
          }
          
          addLogMessage(`ğŸ¯ í‚¤ í”Œë ˆì´ì–´: ${keyPlayer.name}`, 'info');
          if (opponent) {
            addLogMessage(`ğŸ†š ìƒëŒ€: ${opponent.name}`, 'info');
          }
        }
      }
      
      filename += '.mp4';
      addLogMessage(`ğŸ“ ìƒì„±ëœ íŒŒì¼ëª…: ${filename}`, 'success');
      
      // ì´ˆê¸°í™”
      timestampInput.value = timeString; // ì‹œê°„ë§Œ í‘œì‹œ
      filenameInput.value = filename;
      summaryTextarea.value = 'ë¶„ì„ ì¤‘...';
      matchedRowInput.value = 'ê²€ìƒ‰ ì¤‘...';
      
      // Virtual ì‹œíŠ¸ ë§¤ì¹­ ë° AI ë¶„ì„ ë¹„ë™ê¸° ì‹¤í–‰
      addLogMessage('ğŸ”„ Virtual ì‹œíŠ¸ ë§¤ì¹­ ë° AI ë¶„ì„ ì‹œì‘...', 'info');
      
      Promise.all([
        findClosestVirtualRow(timestamp, virtualSheetUrl),
        analyzeHandWithAI(handNumber)
      ]).then(([virtualMatch, aiSummary]) => {
        if (virtualMatch && virtualMatch.row) {
          const diffMinutes = Math.floor(virtualMatch.timeDiff / 60);
          const diffSeconds = virtualMatch.timeDiff % 60;
          
          let timeDiffStr = '';
          if (virtualMatch.timeDiff === 0) {
            timeDiffStr = 'ì™„ë²½ ì¼ì¹˜';
            addLogMessage(`ğŸ‰ Virtual ì‹œíŠ¸ ì™„ë²½ ë§¤ì¹­! í–‰ ${virtualMatch.rowIndex}`, 'success');
          } else {
            if (diffMinutes > 0) {
              timeDiffStr = `${diffMinutes}ë¶„ ${diffSeconds}ì´ˆ`;
            } else {
              timeDiffStr = `${diffSeconds}ì´ˆ`;
            }
            addLogMessage(`âœ… Virtual ì‹œíŠ¸ ë§¤ì¹­ ì™„ë£Œ: í–‰ ${virtualMatch.rowIndex} (${timeDiffStr} ì°¨ì´)`, 'warning');
          }
          
          matchedRowInput.value = `Row ${virtualMatch.rowIndex} [íƒ€ê²Ÿ: ${virtualMatch.targetTime} â†” ë§¤ì¹­: ${virtualMatch.matchedTime}] (ì°¨ì´: ${timeDiffStr})`;
        } else {
          matchedRowInput.value = 'ë§¤ì¹­ë˜ëŠ” í–‰ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ';
          addLogMessage('âŒ Virtual ì‹œíŠ¸ ë§¤ì¹­ ì‹¤íŒ¨', 'error');
        }
        
        if (aiSummary && aiSummary !== 'ë¶„ì„ ì‹¤íŒ¨') {
          addLogMessage('âœ… AI ë¶„ì„ ì™„ë£Œ', 'success');
        } else {
          addLogMessage('âš ï¸ AI ë¶„ì„ ì‹¤íŒ¨ ë˜ëŠ” ë¹„í™œì„±í™”', 'warning');
        }
        
        summaryTextarea.value = aiSummary || 'ë¶„ì„ ì‹¤íŒ¨';
        
        // ë¡œê·¸ ì°½ì€ ì—´ì–´ë‘” ìƒíƒœë¡œ ì™„ë£Œ ëª¨ë‹¬ í‘œì‹œ
        addLogMessage('ğŸ“‹ ì™„ë£Œ ëª¨ë‹¬ í‘œì‹œë¨', 'info');
        addLogMessage('ğŸ’¡ ë¡œê·¸ ì°½ì„ ë‹«ê³  ì™„ë£Œ ëª¨ë‹¬ì—ì„œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”', 'info');
        
        // ëª¨ë‹¬ í‘œì‹œ
        modal.classList.remove('hidden');
      });
    }
    
    // ì™„ë£Œ ëª¨ë‹¬ ë‹«ê¸°
    document.getElementById('cancel-completion').addEventListener('click', () => {
      document.getElementById('completion-modal').classList.add('hidden');
    });
    
    // ì™„ë£Œ ì²˜ë¦¬ í™•ì¸
    document.getElementById('confirm-completion').addEventListener('click', async () => {
      const handNumber = currentHand;
      const filename = document.getElementById('final-filename').value;
      const summary = document.getElementById('ai-summary').value;
      const virtualSheetUrl = document.getElementById('virtual-sheet-url').value;
      const timestamp = parseInt(document.getElementById('hand-timestamp').value);
      
      if (!filename) {
        alert('íŒŒì¼ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        // Virtual ì‹œíŠ¸ ì—…ë°ì´íŠ¸ (ì´ ë¶€ë¶„ì€ Google Apps Scriptì— ì¶”ê°€ ê¸°ëŠ¥ í•„ìš”)
        // ì¼ë‹¨ ê¸°ë³¸ handEdit ìƒíƒœë§Œ ì—…ë°ì´íŠ¸
        await updateHandEditStatus(handNumber, true);
        
        // ëª¨ë‹¬ ë‹«ê¸°
        document.getElementById('completion-modal').classList.add('hidden');
        
        alert(`âœ… í•¸ë“œ #${handNumber} í¸ì§‘ ì™„ë£Œ\n\níŒŒì¼ëª…: ${filename}\nìš”ì•½: ${summary.substring(0, 50)}...`);
      } catch (error) {
        console.error('ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
        alert('ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
    
    async function updateHandEditStatus(handNumber, checked) {
      const completeBtn = document.getElementById('complete-btn');
      const editBtn = document.getElementById('edit-btn');
      
      // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      completeBtn.disabled = true;
      editBtn.disabled = true;
      completeBtn.textContent = checked ? 'ì™„ë£Œ ì¤‘...' : 'ì·¨ì†Œ ì¤‘...';
      
      try {
        const payload = {
          action: 'updateHandEdit',
          handNumber: handNumber,
          checked: checked
        };
        
        console.log('ğŸ”§ ì™„ë£Œ ë²„íŠ¼ í´ë¦­ - ì „ì†¡í•  ë°ì´í„°:', payload);
        console.log('ğŸ”§ í˜„ì¬ CONFIG.APPS_SCRIPT_URL:', CONFIG.APPS_SCRIPT_URL);
        
        const formData = new FormData();
        formData.append('payload', JSON.stringify(payload));
        
        console.log('ğŸ“¤ Google Apps Script ìš”ì²­ ì „ì†¡ ì¤‘...');
        console.log('ğŸ“¤ ì‚¬ìš© ì¤‘ì¸ URL:', CONFIG.APPS_SCRIPT_URL);
        const response = await fetch(CONFIG.APPS_SCRIPT_URL + '?_t=' + Date.now(), {
          method: 'POST',
          body: formData,
          cache: 'no-cache'
        });
        
        console.log('ğŸ“¨ ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
        console.log('ğŸ“¨ ì‘ë‹µ í—¤ë”:', Object.fromEntries(response.headers.entries()));
        
        const responseText = await response.text();
        console.log('ğŸ“¨ ì‘ë‹µ ì›ë³¸ í…ìŠ¤íŠ¸:', responseText);
        
        let result;
        try {
          result = JSON.parse(responseText);
          console.log('ğŸ“¨ íŒŒì‹±ëœ ê²°ê³¼:', result);
        } catch (parseError) {
          console.error('âŒ JSON íŒŒì‹± ì‹¤íŒ¨:', parseError);
          console.error('âŒ ì‘ë‹µì´ JSONì´ ì•„ë‹˜:', responseText);
          throw new Error('ì„œë²„ ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + responseText);
        }
        
        if (result.success === true || result.status === 'success') {
          console.log('í•¸ë“œ í¸ì§‘ ìƒíƒœ ì—…ë°ì´íŠ¸ ì„±ê³µ:', result);
          
          // ì„±ê³µ ì•Œë¦¼
          showNotification(
            checked ? 'âœ… í•¸ë“œ í¸ì§‘ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!' : 'ğŸ“ í•¸ë“œê°€ í¸ì§‘ ëŒ€ê¸° ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!',
            'success'
          );
          
          // ì„±ê³µ ì†Œë¦¬ ì¬ìƒ
          playSound('success');
          
          // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (ì•Œë¦¼ ì–µì œ)
          await loadIndexData(true);
          
          // í˜„ì¬ ì„ íƒëœ í•¸ë“œ ì—…ë°ì´íŠ¸
          if (currentHand === handNumber) {
            updateHandStatus(checked);
          }
        } else if (result.status === 'error') {
          console.error('í•¸ë“œ í¸ì§‘ ìƒíƒœ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', result);
          showNotification('âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
        } else {
          console.error('í•¸ë“œ í¸ì§‘ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ - ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ:', result);
          showNotification('âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ì„œë²„ ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜', 'error');
        }
      } catch (error) {
        console.error('API ì˜¤ë¥˜:', error);
        showNotification('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
        completeBtn.disabled = false;
        editBtn.disabled = false;
        completeBtn.textContent = 'ì™„ë£Œ';
      }
    }
    
    // í˜„ì¬ í•¸ë“œì˜ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateHandStatus(isCompleted) {
      const completeBtn = document.getElementById('complete-btn');
      const editBtn = document.getElementById('edit-btn');
      
      if (isCompleted) {
        completeBtn.classList.add('bg-gray-600');
        completeBtn.classList.remove('bg-green-600');
        completeBtn.textContent = 'ì™„ë£Œë¨';
        completeBtn.disabled = true;
        
        editBtn.classList.remove('bg-gray-600');
        editBtn.classList.add('bg-yellow-600');
        editBtn.disabled = false;
      } else {
        completeBtn.classList.remove('bg-gray-600');
        completeBtn.classList.add('bg-green-600');
        completeBtn.textContent = 'ì™„ë£Œ';
        completeBtn.disabled = false;
        
        editBtn.classList.add('bg-gray-600');
        editBtn.classList.remove('bg-yellow-600');
        editBtn.disabled = true;
      }
    }
    
    // ====================================
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    // ====================================
    
    document.getElementById('refresh-btn').addEventListener('click', () => {
      console.log('ğŸ”„ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨');
      loadIndexData(false); // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ì€ ì•Œë¦¼ í—ˆìš©
    });
    
    document.getElementById('settings-btn').addEventListener('click', () => {
      document.getElementById('settings-modal').classList.remove('hidden');
    });
    
    document.getElementById('cancel-settings').addEventListener('click', () => {
      document.getElementById('settings-modal').classList.add('hidden');
    });
    
    document.getElementById('save-settings').addEventListener('click', () => {
      CONFIG.REFRESH_INTERVAL = parseInt(document.getElementById('refresh-interval').value);
      CONFIG.ENABLE_NOTIFICATIONS = document.getElementById('enable-notifications').checked;
      CONFIG.ENABLE_SOUND = document.getElementById('enable-sound').checked;
      CONFIG.AI_SERVICE = document.getElementById('ai-service').value;
      CONFIG.AI_API_KEY = document.getElementById('ai-api-key').value;
      
      // localStorageì— ì €ì¥
      localStorage.setItem('ai_service', CONFIG.AI_SERVICE);
      if (CONFIG.AI_API_KEY) {
        localStorage.setItem('ai_api_key', CONFIG.AI_API_KEY);
      }
      
      // ëª¨ë“  íƒ€ì´ë¨¸ ì •ë¦¬
      if (refreshTimerInitial) {
        clearTimeout(refreshTimerInitial);
        refreshTimerInitial = null;
      }
      if (refreshTimerInterval) {
        clearInterval(refreshTimerInterval);
        refreshTimerInterval = null;
      }
      
      // ìƒˆë¡œìš´ íƒ€ì´ë¨¸ ì„¤ì •
      refreshTimerInterval = setInterval(() => loadIndexData(true), CONFIG.REFRESH_INTERVAL);
      
      document.getElementById('settings-modal').classList.add('hidden');
    });
    
    // ë²„í¼ ì´ˆê¸°í™” ë²„íŠ¼
    document.getElementById('clear-notification-history').addEventListener('click', () => {
      if (confirm('ì •ë§ë¡œ ìµœê·¼ í•¸ë“œ ë²„í¼ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì£¼ì˜:\n- ìµœê·¼ í•¸ë“œ ë²„í¼ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤\n- ë‹¤ìŒ ë¡œë“œì‹œ ê¸°ì¡´ í•¸ë“œë„ ìƒˆ í•¸ë“œë¡œ ì¸ì‹ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤')) {
        // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
        recentHandsBuffer.clear();
        masterHandList.clear();
        saveMasterHandList();
        
        // ê¸°ì¡´ ì•Œë¦¼ ê¸°ë¡ë„ ì´ˆê¸°í™”
        notifiedHands = {};
        localStorage.removeItem(STORAGE_KEY);
        localStorage.removeItem(MASTER_LIST_KEY);
        
        showNotification('âœ… ìµœê·¼ í•¸ë“œ ë²„í¼ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        console.log('ğŸ”„ ë²„í¼ ì´ˆê¸°í™” ì™„ë£Œ');
        
        // ì„¤ì • ì°½ ë‹«ê¸°
        document.getElementById('settings-modal').classList.add('hidden');
      }
    });
    
    document.getElementById('table-filter').addEventListener('change', updateHandList);
    document.getElementById('status-filter').addEventListener('change', updateHandList);
    
    document.getElementById('edit-btn').addEventListener('click', () => {
      if (currentHand) {
        const confirmed = confirm('ì´ í•¸ë“œë¥¼ í¸ì§‘ ëŒ€ê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?');
        if (confirmed) {
          updateHandEditStatus(currentHand, false);
        }
      }
    });
    
    document.getElementById('complete-btn').addEventListener('click', async () => {
      if (currentHand) {
        // Virtual ì‹œíŠ¸ URL í™•ì¸ (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
        let virtualSheetUrl = document.getElementById('virtual-sheet-url').value;
        if (!virtualSheetUrl) {
          virtualSheetUrl = CONFIG.DEFAULT_VIRTUAL_SHEET_URL;
          document.getElementById('virtual-sheet-url').value = virtualSheetUrl;
          localStorage.setItem('virtual_sheet_url', virtualSheetUrl);
          console.log('ğŸ”„ ê¸°ë³¸ Virtual ì‹œíŠ¸ URLì„ ì‚¬ìš©í•©ë‹ˆë‹¤.');
        }
        
        // í•¸ë“œ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
        const handTime = await getHandTimestamp(currentHand);
        if (handTime) {
          // ëª¨ë‹¬ í‘œì‹œ
          showCompletionModal(currentHand, handTime, virtualSheetUrl);
        } else {
          alert('í•¸ë“œ ì‹œê°„ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      }
    });
    
    // ====================================
    // ì´ˆê¸°í™”
    // ====================================
    
    // ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡ ë¡œë“œ
    function loadMasterHandList() {
      try {
        const stored = localStorage.getItem(MASTER_LIST_KEY);
        if (stored) {
          const data = JSON.parse(stored);
          masterHandList.clear();
          for (const [handNumber, hand] of Object.entries(data)) {
            masterHandList.set(handNumber, hand);
          }
          console.log(`ğŸ“ ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡ ë¡œë“œ: ${masterHandList.size}ê°œ`);
        }
      } catch (e) {
        console.error('ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', e);
      }
    }
    
    // ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡ ì €ì¥
    function saveMasterHandList() {
      try {
        const data = {};
        for (const [handNumber, hand] of masterHandList.entries()) {
          data[handNumber] = hand;
        }
        localStorage.setItem(MASTER_LIST_KEY, JSON.stringify(data));
      } catch (e) {
        console.error('ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡ ì €ì¥ ì‹¤íŒ¨:', e);
      }
    }
    
    // Virtual ì‹œíŠ¸ URL ì €ì¥ ë° ë¡œë“œ
    document.getElementById('virtual-sheet-url').addEventListener('change', (e) => {
      localStorage.setItem('virtual_sheet_url', e.target.value);
      console.log('ğŸ’¾ Virtual ì‹œíŠ¸ URL ì €ì¥ë¨');
    });
    
    async function init() {
      console.log('='.repeat(60));
      console.log('ğŸš€ í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ v8.6.0 - Cì—´ ì „ìš© ìµœì í™” ë§¤ì¹­');
      console.log('='.repeat(60));
      
      // ë§ˆìŠ¤í„° í•¸ë“œ ëª©ë¡ ë¡œë“œ
      loadMasterHandList();
      console.log(`ğŸ“ ê¸°ì¡´ ë§ˆìŠ¤í„° í•¸ë“œ: ${masterHandList.size}ê°œ`);
      
      // Virtual ì‹œíŠ¸ URL ë¡œë“œ (ì €ì¥ëœ ê°’ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
      const savedVirtualUrl = localStorage.getItem('virtual_sheet_url') || CONFIG.DEFAULT_VIRTUAL_SHEET_URL;
      document.getElementById('virtual-sheet-url').value = savedVirtualUrl;
      console.log(`ğŸ’¾ Virtual ì‹œíŠ¸ URL ë¡œë“œ: ${savedVirtualUrl.substring(0, 50)}...`);
      
      // ì²˜ìŒ ì‹¤í–‰ ì‹œ ê¸°ë³¸ê°’ì„ localStorageì— ì €ì¥
      if (!localStorage.getItem('virtual_sheet_url')) {
        localStorage.setItem('virtual_sheet_url', CONFIG.DEFAULT_VIRTUAL_SHEET_URL);
        console.log('ğŸ“ ê¸°ë³¸ Virtual ì‹œíŠ¸ URLì„ localStorageì— ì €ì¥í–ˆìŠµë‹ˆë‹¤.');
      }
      
      // AI ì„¤ì • ë¡œë“œ
      const savedAiService = localStorage.getItem('ai_service');
      const savedAiKey = localStorage.getItem('ai_api_key');
      if (savedAiService) {
        CONFIG.AI_SERVICE = savedAiService;
        document.getElementById('ai-service').value = savedAiService;
        console.log(`ğŸ¤– AI ì„œë¹„ìŠ¤: ${savedAiService}`);
      }
      if (savedAiKey) {
        CONFIG.AI_API_KEY = savedAiKey;
        document.getElementById('ai-api-key').value = savedAiKey;
        console.log(`ğŸ”‘ AI API í‚¤ ë¡œë“œë¨`);
      }
      
      // ìµœê·¼ í•¸ë“œ ë²„í¼ ìƒíƒœ í™•ì¸
      const bufferStatus = recentHandsBuffer.getStatus();
      console.log(`ğŸ’¾ ìµœê·¼ í•¸ë“œ ë²„í¼: ${bufferStatus.size}/${bufferStatus.maxSize}ê°œ (ìµœëŒ€ 100ê°œ ì €ì¥)`);
      if (bufferStatus.size > 0) {
        console.log(`ğŸ’¾ ë²„í¼ ë‚´ìš©:`, bufferStatus.buffer);
      }
      
      console.log('ğŸ”” ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ì¤‘...');
      if ('Notification' in window && Notification.permission === 'default') {
        await Notification.requestPermission();
      }
      
      console.log('ğŸ“„ ì´ˆê¸° ë°ì´í„° ë¡œë”© ì‹œì‘...');
      await loadIndexData();
      
      if (allHands.length > 0) {
        selectHand(allHands[0].handNumber);
      }
      
      // ìë™ ìƒˆë¡œê³ ì¹¨ - ì´ˆê¸° ë¡œë“œ ì§í›„ê°€ ì•„ë‹Œ REFRESH_INTERVAL í›„ì— ì‹œì‘
      // ì´ë ‡ê²Œ í•˜ë©´ í˜ì´ì§€ ë¡œë“œ ì‹œ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€
      refreshTimerInitial = setTimeout(() => {
        // ì²« ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰
        if (DEBUG_MODE) {
          console.log('â° ì²« ìë™ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ (ìƒˆ í•¸ë“œ ê°ì§€ í¬í•¨)');
        }
        loadIndexData(false);
        
        // ì´ˆê¸° íƒ€ì´ë¨¸ ì •ë¦¬
        refreshTimerInitial = null;
        
        // ì´í›„ ì •ê¸°ì ì¸ ìƒˆë¡œê³ ì¹¨ ì„¤ì •
        refreshTimerInterval = setInterval(() => {
          if (DEBUG_MODE) {
            console.log('â° ìë™ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ (ìƒˆ í•¸ë“œ ê°ì§€ í¬í•¨)');
          }
          loadIndexData(false); // false = ìƒˆë¡œìš´ í•¸ë“œì— ëŒ€í•´ì„œëŠ” ì•Œë¦¼ í—ˆìš©
        }, CONFIG.REFRESH_INTERVAL);
      }, CONFIG.REFRESH_INTERVAL); // ì²« ì‹¤í–‰ë„ REFRESH_INTERVAL í›„ì—
      
      console.log('ì´ˆê¸°í™” ì™„ë£Œ');
    }
    
    // ì•± ì‹œì‘
    init();
    
    // í˜ì´ì§€ ì¢…ë£Œ ì‹œ íƒ€ì´ë¨¸ ì •ë¦¬
    window.addEventListener('beforeunload', () => {
      if (refreshTimerInitial) {
        clearTimeout(refreshTimerInitial);
      }
      if (refreshTimerInterval) {
        clearInterval(refreshTimerInterval);
      }
    });
  </script>
</body>
</html>
<!DOCTYPE html>
<!--
  í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ - ì»´íŒ©íŠ¸ ë²„ì „
  Version: 8.0.1-CACHE_BUST
  Last Updated: 2025-01-03
  Description: ìŠ¤í¬ë¡¤ ì—†ì´ ëª¨ë“  ì •ë³´ë¥¼ í•œ í™”ë©´ì— í‘œì‹œí•˜ëŠ” ì»´íŒ©íŠ¸ ë²„ì „
-->
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§ v8.0.0 - Compact</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .mono {
      font-family: 'JetBrains Mono', monospace;
    }
    
    /* ì»´íŒ©íŠ¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .card-mini {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 48px;
      background-color: #FFFFFF !important;
      color-scheme: light;
      border: 1px solid #6b7280;
      border-radius: 4px;
      font-weight: 800;
      font-size: 16px;
      margin: 0 1px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      position: relative;
    }
    
    /* ìŠ¤í˜ì´ë“œ, í´ëŸ½ - ì§„í•œ ê²€ì€ìƒ‰ */
    .card-mini.spade, .card-mini.club { 
      color: #000000 !important;
    }
    
    /* í•˜íŠ¸, ë‹¤ì´ì•„ëª¬ë“œ - ì§„í•œ ë¹¨ê°„ìƒ‰ */
    .card-mini.heart, .card-mini.diamond { 
      color: #dc2626 !important;
    }
    
    /* ë³´ë“œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .board-card {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 60px;
      background-color: #FFFFFF !important;
      color-scheme: light;
      border: 2px solid #f59e0b;
      border-radius: 6px;
      font-weight: 900;
      font-size: 20px;
      margin: 0 2px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      position: relative;
    }
    
    /* ìŠ¤í˜ì´ë“œ, í´ëŸ½ - ì§„í•œ ê²€ì€ìƒ‰ */
    .board-card.spade, .board-card.club { 
      color: #000000 !important;
    }
    
    /* í•˜íŠ¸, ë‹¤ì´ì•„ëª¬ë“œ - ì§„í•œ ë¹¨ê°„ìƒ‰ */
    .board-card.heart, .board-card.diamond { 
      color: #dc2626 !important;
    }
    
    /* ì•¡ì…˜ ë°°ì§€ ìŠ¤íƒ€ì¼ */
    .action-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .action-badge.fold { background: #64748b; color: white; }
    .action-badge.check { background: #0ea5e9; color: white; }
    .action-badge.call { background: #22c55e; color: white; }
    .action-badge.bet { background: #f97316; color: white; }
    .action-badge.raise { background: #ef4444; color: white; }
    .action-badge.allin { background: #fbbf24; color: #000; }
    
    /* í¬ì§€ì…˜ ë°°ì§€ */
    .pos-badge {
      display: inline-block;
      padding: 1px 4px;
      border-radius: 3px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
    }
    
    .pos-badge.btn { background: #fbbf24; color: #000; }
    .pos-badge.sb { background: #10b981; color: white; }
    .pos-badge.bb { background: #3b82f6; color: white; }
    .pos-badge.utg { background: #8b5cf6; color: white; }
    .pos-badge.mp { background: #ec4899; color: white; }
    .pos-badge.co { background: #f97316; color: white; }
    
    /* ìŠ¤í¬ë¡¤ë°” */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #1e293b;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #475569;
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #64748b;
    }
    
    /* ì»´íŒ©íŠ¸ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
    .compact-grid {
      display: grid;
      grid-template-columns: 280px 1fr 320px;
      gap: 12px;
      padding: 12px;
      height: 100vh;
      max-width: 1920px;
      margin: 0 auto;
    }
    
    @media (max-width: 1440px) {
      .compact-grid {
        grid-template-columns: 260px 1fr 300px;
      }
    }
    
    /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .section {
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 12px;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
    }
    
    .section-header {
      font-size: 13px;
      font-weight: 600;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid #334155;
    }
    
    /* í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ */
    .player-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .player-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 8px;
      background: rgba(15, 23, 42, 0.4);
      border: 1px solid #334155;
      border-radius: 6px;
      transition: all 0.2s;
    }
    
    .player-item:hover {
      background: rgba(59, 130, 246, 0.1);
      border-color: #3b82f6;
    }
    
    .player-item.folded {
      opacity: 0.5;
    }
    
    /* ì•¡ì…˜ íƒ€ì„ë¼ì¸ ì»´íŒ©íŠ¸ */
    .action-line {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      font-size: 12px;
      border-left: 2px solid transparent;
    }
    
    .action-line.preflop { border-left-color: #8b5cf6; }
    .action-line.flop { border-left-color: #3b82f6; }
    .action-line.turn { border-left-color: #10b981; }
    .action-line.river { border-left-color: #f97316; }
    .action-line.showdown { border-left-color: #fbbf24; }
    
    /* íŒŸ ë””ìŠ¤í”Œë ˆì´ */
    .pot-display {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: #000;
      border-radius: 6px;
      font-weight: 700;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <!-- í—¤ë” -->
  <div class="app-header" style="background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid #334155; padding: 10px 16px; position: sticky; top: 0; z-index: 100;">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <h1 class="text-lg font-bold">í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§</h1>
        <span class="text-xs text-gray-500">v8.0.0 Compact</span>
        <div class="flex items-center gap-2">
          <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
          <span class="text-xs text-gray-400">ì—°ê²°ë¨</span>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="refresh-btn" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">
          ìƒˆë¡œê³ ì¹¨
        </button>
        <button id="settings-btn" class="px-3 py-1 bg-gray-600 text-white rounded text-xs hover:bg-gray-700">
          ì„¤ì •
        </button>
      </div>
    </div>
  </div>

  <!-- ë©”ì¸ ì»¨í…ì¸  -->
  <div class="compact-grid">
    
    <!-- ì™¼ìª½: í•¸ë“œ ë¦¬ìŠ¤íŠ¸ -->
    <div class="section overflow-hidden">
      <div class="section-header flex items-center justify-between">
        <span>í•¸ë“œ ëª©ë¡</span>
        <span id="hand-count" class="text-xs">0</span>
      </div>
      <div class="flex gap-2 mb-2">
        <select id="table-filter" class="bg-gray-700 text-xs px-2 py-1 rounded flex-1">
          <option value="">ëª¨ë“  í…Œì´ë¸”</option>
        </select>
        <select id="status-filter" class="bg-gray-700 text-xs px-2 py-1 rounded">
          <option value="">ì „ì²´</option>
          <option value="pending">ëŒ€ê¸°</option>
          <option value="completed">ì™„ë£Œ</option>
        </select>
      </div>
      <div id="hand-list" class="flex-1 overflow-y-auto" style="max-height: calc(100vh - 180px);">
        <!-- í•¸ë“œ ë¦¬ìŠ¤íŠ¸ ë™ì  ìƒì„± -->
      </div>
    </div>

    <!-- ì¤‘ì•™: í•¸ë“œ ìƒì„¸ ì •ë³´ -->
    <div class="section overflow-hidden">
      <!-- í•¸ë“œ í—¤ë” ì •ë³´ -->
      <div class="flex items-center justify-between mb-3 pb-2 border-b border-gray-700">
        <div class="flex flex-col gap-1">
          <div class="flex items-center gap-3">
            <span class="text-sm font-bold">Hand #<span id="hand-number">-</span></span>
            <span class="text-xs text-gray-400">Table: <span id="table-name">-</span></span>
            <span class="text-xs text-gray-400">Blinds: <span id="blinds">-</span></span>
          </div>
          <div class="text-xs text-blue-300">
            ğŸ“¹ <span id="camera-files">-</span>
          </div>
        </div>
        <div class="flex gap-2">
          <button id="edit-btn" class="px-2 py-1 bg-yellow-600 text-xs rounded">í¸ì§‘</button>
          <button id="complete-btn" class="px-2 py-1 bg-green-600 text-xs rounded">ì™„ë£Œ</button>
        </div>
      </div>

      <!-- íŒŸ ì •ë³´ -->
      <div class="pot-display mb-3">
        POT: <span id="pot-amount">0</span>
      </div>

      <!-- ë³´ë“œ ì¹´ë“œ -->
      <div class="mb-3">
        <div class="section-header">Board</div>
        <div id="board-cards" class="flex justify-center gap-1">
          <!-- ë³´ë“œ ì¹´ë“œ ë™ì  ìƒì„± -->
        </div>
      </div>

      <!-- í”Œë ˆì´ì–´ ì¹´ë“œ ì„¹ì…˜ -->
      <div class="mb-3">
        <div class="section-header">Players</div>
        <div id="players-section" class="player-list" style="max-height: 180px; overflow-y: auto;">
          <!-- í”Œë ˆì´ì–´ ì •ë³´ ë™ì  ìƒì„± -->
        </div>
      </div>

      <!-- ì•¡ì…˜ íˆìŠ¤í† ë¦¬ -->
      <div class="flex-1">
        <div class="section-header">Actions</div>
        <div id="action-history" style="max-height: calc(100vh - 520px); overflow-y: auto;">
          <!-- ì•¡ì…˜ íˆìŠ¤í† ë¦¬ ë™ì  ìƒì„± -->
        </div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ìš”ì•½ ì •ë³´ -->
    <div class="section">
      <!-- í†µê³„ -->
      <div class="mb-3">
        <div class="section-header">í†µê³„</div>
        <div class="grid grid-cols-2 gap-2">
          <div class="bg-gray-800 rounded p-2">
            <div class="text-xs text-gray-400">ì´ í•¸ë“œ</div>
            <div class="text-lg font-bold" id="total-hands">0</div>
          </div>
          <div class="bg-gray-800 rounded p-2">
            <div class="text-xs text-gray-400">ì™„ë£Œ</div>
            <div class="text-lg font-bold text-green-400" id="completed-hands">0</div>
          </div>
        </div>
      </div>

      <!-- í•¸ë“œ ê²°ê³¼ -->
      <div class="mb-3">
        <div class="section-header">ê²°ê³¼</div>
        <div id="hand-result" class="bg-gray-800 rounded p-3">
          <div class="text-xs text-gray-400">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>

      <!-- í¸ì§‘ ë…¸íŠ¸ -->
      <div class="flex-1">
        <div class="section-header">ë…¸íŠ¸</div>
        <textarea id="hand-notes" 
          class="w-full flex-1 bg-gray-800 rounded p-2 text-xs resize-none" 
          style="min-height: 100px;"
          placeholder="í•¸ë“œ ë¶„ì„ ë…¸íŠ¸..."></textarea>
        <button id="save-notes" class="mt-2 w-full px-3 py-1 bg-blue-600 text-white rounded text-xs">
          ë…¸íŠ¸ ì €ì¥
        </button>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div id="settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full">
      <h2 class="text-lg font-bold mb-4">ì„¤ì •</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm mb-2">ìƒˆë¡œê³ ì¹¨ ê°„ê²©</label>
          <select id="refresh-interval" class="w-full bg-gray-700 rounded px-3 py-2">
            <option value="5000">5ì´ˆ</option>
            <option value="10000" selected>10ì´ˆ</option>
            <option value="30000">30ì´ˆ</option>
            <option value="60000">1ë¶„</option>
          </select>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="enable-notifications" checked>
          <label for="enable-notifications" class="text-sm">ìƒˆ í•¸ë“œ ì•Œë¦¼ í™œì„±í™”</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="enable-sound" checked>
          <label for="enable-sound" class="text-sm">ì†Œë¦¬ ì•Œë¦¼ í™œì„±í™”</label>
        </div>
        <div class="mt-4 pt-4 border-t border-gray-700">
          <button id="clear-notification-history" class="w-full px-4 py-2 bg-red-600 rounded text-sm hover:bg-red-700 transition">
            ğŸ”„ ì•Œë¦¼ ê¸°ë¡ ì´ˆê¸°í™”
          </button>
          <p class="text-xs text-gray-400 mt-2">
            ëª¨ë“  í•¸ë“œì— ëŒ€í•œ ì•Œë¦¼ ê¸°ë¡ì´ ì‚­ì œë˜ë©°, ê¸°ì¡´ í•¸ë“œë„ ìƒˆë¡œìš´ í•¸ë“œë¡œ ì¸ì‹ë©ë‹ˆë‹¤.
          </p>
        </div>
      </div>
      <div class="flex justify-end gap-2 mt-6">
        <button id="cancel-settings" class="px-4 py-2 bg-gray-600 rounded text-sm">ì·¨ì†Œ</button>
        <button id="save-settings" class="px-4 py-2 bg-blue-600 rounded text-sm">ì €ì¥</button>
      </div>
    </div>
  </div>

  <script>
    // ====================================
    // í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ v8.0.0 - Compact
    // ====================================
    
    const CONFIG = {
      // Google Sheets CSV URLs
      CSV_HAND_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=1906746276&single=true&output=csv',
      CSV_INDEX_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=1354012271&single=true&output=csv',
      APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzWfe_4CAKcMAzzoHzJBstQIC7jQxSVC1BO23nYwlU23Pd5vLPLjfUi-gKyqzDYvPRT/exec',
      
      // ì„¤ì •
      REFRESH_INTERVAL: 10000,
      ENABLE_NOTIFICATIONS: true,
      ENABLE_SOUND: true
    };
    
    // ì „ì—­ ìƒíƒœ
    let currentHand = null;
    let allHands = [];
    let handData = {};
    let refreshTimerInitial = null;  // ì´ˆê¸° setTimeoutìš©
    let refreshTimerInterval = null;  // ë°˜ë³µ setIntervalìš©
    let lastHandCount = 0;
    let isInitialLoad = true; // ì²« ë¡œë”©ì¸ì§€ í™•ì¸
    
    // localStorageë¥¼ ì‚¬ìš©í•œ ì˜êµ¬ ì €ì¥ì†Œë¡œ ì•Œë¦¼ ê¸°ë¡ ê´€ë¦¬
    const STORAGE_KEY = 'poker_notified_hands_v2'; // ë²„ì „ ì—…ê·¸ë ˆì´ë“œ
    const MAX_STORED_HANDS = 500; // ë” ë§ì€ ê¸°ë¡ ì €ì¥
    const NOTIFICATION_COOLDOWN = 30000; // 30ì´ˆ ì¿¨ë‹¤ìš´ (ê°™ì€ í•¸ë“œì— ëŒ€í•œ ì¬ì•Œë¦¼ ë°©ì§€)
    
    // ë””ë²„ê·¸ ëª¨ë“œ
    const DEBUG_MODE = true; // ì½˜ì†”ì— ìƒì„¸ ë¡œê·¸ ì¶œë ¥
    
    // ì•Œë¦¼ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì‹œê°„ ì •ë³´ í¬í•¨)
    function getNotifiedHands() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          const data = JSON.parse(stored);
          // ê°ì²´ í˜•íƒœë¡œ ì €ì¥ (handNumber: timestamp)
          return data.hands || {};
        }
      } catch (e) {
        console.error('ì•Œë¦¼ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }
      return {};
    }
    
    // ì•Œë¦¼ ê¸°ë¡ ì €ì¥ (ì‹œê°„ ì •ë³´ í¬í•¨)
    // ì¤‘ìš”: í•œ ë²ˆ ì•Œë¦¼ì„ í‘œì‹œí•œ í•¸ë“œëŠ” CSVì—ì„œ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ë¼ì ¸ë„ 
    // ìµœì†Œ 24ì‹œê°„ ë™ì•ˆì€ ê¸°ë¡ì„ ìœ ì§€í•˜ì—¬ ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€
    function saveNotifiedHands(handsMap) {
      try {
        // ë„ˆë¬´ ì˜¤ë˜ëœ ê¸°ë¡ë§Œ ì œê±° (24ì‹œê°„ ì´ìƒ)
        // CSV ì§€ì—°ìœ¼ë¡œ ì¸í•´ í•¸ë“œê°€ ì ì‹œ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ
        // 7ì¼ì´ ì•„ë‹Œ 24ì‹œê°„ìœ¼ë¡œ ë‹¨ì¶•í•˜ì—¬ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± í–¥ìƒ
        const now = Date.now();
        const oneDayAgo = now - (24 * 60 * 60 * 1000);
        const cleanedHands = {};
        
        // ê¸°ì¡´ ì €ì¥ëœ ëª¨ë“  í•¸ë“œ ìœ ì§€ (24ì‹œê°„ ë‚´)
        const existingData = getNotifiedHands();
        for (const [handNumber, timestamp] of Object.entries(existingData)) {
          if (timestamp > oneDayAgo) {
            cleanedHands[handNumber] = timestamp;
          }
        }
        
        // ìƒˆë¡œìš´ í•¸ë“œ ì¶”ê°€/ì—…ë°ì´íŠ¸
        for (const [handNumber, timestamp] of Object.entries(handsMap)) {
          cleanedHands[handNumber] = timestamp;
        }
        
        // ìµœëŒ€ ê°œìˆ˜ ì œí•œ
        const entries = Object.entries(cleanedHands);
        if (entries.length > MAX_STORED_HANDS) {
          // ê°€ì¥ ì˜¤ë˜ëœ ê²ƒë“¤ ì œê±°
          entries.sort((a, b) => a[1] - b[1]);
          const toKeep = entries.slice(-MAX_STORED_HANDS);
          const finalHands = {};
          toKeep.forEach(([handNumber, timestamp]) => {
            finalHands[handNumber] = timestamp;
          });
          
          localStorage.setItem(STORAGE_KEY, JSON.stringify({
            hands: finalHands,
            lastUpdated: new Date().toISOString()
          }));
        } else {
          localStorage.setItem(STORAGE_KEY, JSON.stringify({
            hands: cleanedHands,
            lastUpdated: new Date().toISOString()
          }));
        }
        
        if (DEBUG_MODE) {
          console.log(`ğŸ’¾ ì•Œë¦¼ ê¸°ë¡ ì €ì¥: ì´ ${Object.keys(cleanedHands).length}ê°œ í•¸ë“œ ê¸°ë¡ ìœ ì§€`);
        }
      } catch (e) {
        console.error('ì•Œë¦¼ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨:', e);
      }
    }
    
    // ì•Œë¦¼ ê¸°ë¡ ì´ˆê¸°í™” (ê°ì²´ í˜•íƒœ: {handNumber: timestamp})
    let notifiedHands = getNotifiedHands();
    let lastDataSnapshot = ''; // ë§ˆì§€ë§‰ ë°ì´í„° ìŠ¤ëƒ…ìƒ· (ë°ì´í„° ë³€ê²½ ê°ì§€ìš©)
    
    // ====================================
    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    // ====================================
    
    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const rows = [];
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const row = [];
        let inQuotes = false;
        let currentField = '';
        
        for (let j = 0; j < line.length; j++) {
          const char = line[j];
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            row.push(currentField.trim());
            currentField = '';
          } else {
            currentField += char;
          }
        }
        row.push(currentField.trim());
        rows.push(row);
      }
      
      return rows;
    }
    
    function formatNumber(num) {
      return new Intl.NumberFormat('ko-KR').format(num);
    }
    
    function getSuitSymbol(suit) {
      const symbols = {
        's': 'â™ ', 'h': 'â™¥', 'd': 'â™¦', 'c': 'â™£'
      };
      return symbols[suit.toLowerCase()] || '';
    }
    
    function getSuitClass(suit) {
      const classes = {
        's': 'spade', 'h': 'heart', 'd': 'diamond', 'c': 'club'
      };
      return classes[suit.toLowerCase()] || '';
    }
    
    function createCardElement(card, type = 'mini') {
      if (!card || card === '?' || card.length < 2) {
        // ì•Œ ìˆ˜ ì—†ëŠ” ì¹´ë“œë„ í°ìƒ‰ ë°”íƒ•ìœ¼ë¡œ í‘œì‹œ (ë‹¤í¬ëª¨ë“œ ë¬´ì‹œ)
        return `<div class="${type === 'board' ? 'board-card' : 'card-mini'}" style="background-color: #FFFFFF !important; color: #6b7280; border-style: dashed; color-scheme: light;">?</div>`;
      }
      
      const rank = card.slice(0, -1);
      const suit = card.slice(-1);
      const suitClass = getSuitClass(suit);
      const suitSymbol = getSuitSymbol(suit);
      
      // ìŠ¤í˜ì´ë“œ/í´ë¡œë²„ëŠ” ê²€ì€ìƒ‰, í•˜íŠ¸/ë‹¤ì´ì•„ëŠ” ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ê°•ì œ ì„¤ì •
      const textColor = (suit === 's' || suit === 'c') ? '#000000' : '#dc2626';
      
      // ì¹´ë“œì— ë­í¬ì™€ ë¬¸ì–‘ í‘œì‹œ
      return `<div class="${type === 'board' ? 'board-card' : 'card-mini'} ${suitClass}" style="background-color: #FFFFFF !important; color: ${textColor} !important; color-scheme: light;">
        <div style="display: flex; align-items: center; gap: 2px; color: ${textColor} !important;">
          <span style="font-weight: 900; color: ${textColor} !important;">${rank}</span>
          <span style="font-size: ${type === 'board' ? '16px' : '12px'}; color: ${textColor} !important;">${suitSymbol}</span>
        </div>
      </div>`;
    }
    
    function getActionBadgeClass(action) {
      const actionMap = {
        'FOLD': 'fold',
        'CHECK': 'check',
        'CALL': 'call',
        'CHECK/CALL': 'call',  // CHECK/CALL í†µí•© ì²˜ë¦¬
        'BET': 'bet',
        'RAISE': 'raise',
        'RAISE TO': 'raise',
        'ALL-IN': 'allin',
        'ALLIN': 'allin'
      };
      return actionMap[action.toUpperCase()] || 'check';
    }
    
    // ì•¡ì…˜ í‘œì‹œ í…ìŠ¤íŠ¸ ë³€í™˜ í•¨ìˆ˜ (ì´ë¯¸ ë³€í™˜ëœ ë°ì´í„°ì´ë¯€ë¡œ ê·¸ëŒ€ë¡œ ë°˜í™˜)
    function getActionDisplayText(action) {
      if (!action) return '-';
      // ì´ë¯¸ íŒŒì‹± ë‹¨ê³„ì—ì„œ CHECK/CALLë¡œ ë³€í™˜ë˜ì—ˆìŒ
      return action.toUpperCase();
    }
    
    function getPositionBadgeClass(position) {
      const posMap = {
        'BTN': 'btn',
        'SB': 'sb',
        'BB': 'bb',
        'UTG': 'utg',
        'MP': 'mp',
        'CO': 'co'
      };
      return posMap[position] || '';
    }
    
    // ì¹´ë©”ë¼ íŒŒì¼ëª… ë³€í™˜ í•¨ìˆ˜
    function formatCameraFileName(camFiles) {
      if (!camFiles || camFiles.length === 0) return [];
      
      const formattedFiles = [];
      
      // ì¹´ë©”ë¼ ì´ë¦„ê³¼ ë²ˆí˜¸ë¥¼ í˜ì–´ë¡œ ì²˜ë¦¬
      for (let i = 0; i < camFiles.length; i += 2) {
        const camName = camFiles[i];
        const camNumber = camFiles[i + 1];
        
        if (camName && camNumber) {
          // ìˆ«ìë¥¼ 4ìë¦¬ë¡œ íŒ¨ë”© (ì˜ˆ: 115 -> 0115)
          const paddedNumber = String(camNumber).padStart(4, '0');
          formattedFiles.push(camName + paddedNumber);
        } else if (camName && !camNumber) {
          // ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ ê·¸ëŒ€ë¡œ ì¶”ê°€
          formattedFiles.push(camName);
        }
      }
      
      return formattedFiles;
    }
    
    // ====================================
    // ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
    // ====================================
    
    async function loadIndexData(suppressNotification = false) {
      try {
        const response = await fetch(CONFIG.CSV_INDEX_URL + '&t=' + Date.now());
        const text = await response.text();
        const rows = parseCSV(text);
        
        const dataRows = rows.slice(1);
        
        // CSVì—ì„œ ì½ì€ ìƒˆë¡œìš´ í•¸ë“œ ë°ì´í„°
        const newHandsFromCSV = dataRows.map(row => {
          // lastActionì—ì„œë„ CHECK/CALL í†µí•©
          let lastAction = row[15];
          if (lastAction === 'CHECK' || lastAction === 'CALL') {
            lastAction = 'CHECK/CALL';
          }
          
          return {
            handNumber: row[0],
            startRow: parseInt(row[1]),
            endRow: parseInt(row[2]),
            handUpdatedAt: row[3],
            handEdit: row[4] === 'TRUE',
            handEditTime: row[5],
            table: row[7],
            cam: row[9], // Jì—´ - Cam ì •ë³´
            camFiles: formatCameraFileName([row[10], row[11], row[12], row[13]].filter(file => file && file.trim())), // K-Nì—´ - CamFile ì •ë³´ë¥¼ ë³€í™˜
            lastStreet: row[14],
            lastAction: lastAction,
            workStatus: row[16] || 'ëŒ€ê¸°ì¤‘'
          };
        });
        
        // ê¸°ì¡´ allHandsì—ì„œ CSV ì§€ì—°ìœ¼ë¡œ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ë¼ì§„ ìµœê·¼ í•¸ë“œë“¤ ë³´ì¡´
        const preservedHands = [];
        
        if (!isInitialLoad && allHands.length > 0) {
          // CSVì— ì—†ì§€ë§Œ ìµœê·¼ì— ë³¸ í•¸ë“œë“¤ ë³´ì¡´ (CSV ì—…ë°ì´íŠ¸ ì§€ì—° ëŒ€ì‘)
          const csvHandNumbers = new Set(newHandsFromCSV.map(h => h.handNumber));
          const now = Date.now();
          
          for (const hand of allHands) {
            // CSVì— ì—†ì§€ë§Œ ê¸°ì¡´ì— ìˆë˜ í•¸ë“œ
            if (!csvHandNumbers.has(hand.handNumber)) {
              // handUpdatedAtì´ ì˜¤ëŠ˜ ë‚ ì§œì¸ ê²½ìš° ë³´ì¡´ (CSV ì§€ì—°ìœ¼ë¡œ ê°„ì£¼)
              const today = new Date().toISOString().split('T')[0];
              const handDate = hand.handUpdatedAt ? hand.handUpdatedAt.split('T')[0] : '';
              
              if (handDate === today) {
                preservedHands.push(hand);
                if (DEBUG_MODE) {
                  console.log(`ğŸ”’ CSV ì§€ì—°ìœ¼ë¡œ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ë¼ì§„ í•¸ë“œ ë³´ì¡´: #${hand.handNumber}`);
                }
              }
            }
          }
        }
        
        // ë³´ì¡´ëœ í•¸ë“œì™€ CSV ë°ì´í„° ë³‘í•© (ì¤‘ë³µ ì œê±°)
        const mergedHandsMap = {};
        
        // ë¨¼ì € ë³´ì¡´ëœ í•¸ë“œ ì¶”ê°€
        for (const hand of preservedHands) {
          mergedHandsMap[hand.handNumber] = hand;
        }
        
        // CSV ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸ (CSVê°€ ë” ìµœì‹ ì´ë¯€ë¡œ ë®ì–´ì”€)
        for (const hand of newHandsFromCSV) {
          mergedHandsMap[hand.handNumber] = hand;
        }
        
        allHands = Object.values(mergedHandsMap);
        allHands.reverse();
        
        // ë°ì´í„° ìŠ¤ëƒ…ìƒ· ë¹„êµë¡œ ì‹¤ì œ ë³€ê²½ ê°ì§€
        const currentDataSnapshot = JSON.stringify(allHands.map(h => h.handNumber).sort());
        const dataChanged = currentDataSnapshot !== lastDataSnapshot;
        
        if (DEBUG_MODE && dataChanged) {
          console.log(`ğŸ” ë°ì´í„° ë³€ê²½ ê°ì§€ - í•¸ë“œ ìˆ˜: ${allHands.length}`);
        }
        
        // ìƒˆë¡œìš´ í•¸ë“œ ê°ì§€ ë° ì•Œë¦¼ (ìë™ ìƒˆë¡œê³ ì¹¨ì—ì„œë„ ì•Œë¦¼ í™œì„±í™”)
        if (!isInitialLoad && allHands.length > 0 && dataChanged) {
          const now = Date.now();
          const newHandNumbers = [];
          const recentlyAddedHands = [];
          
          // í˜„ì¬ ìˆëŠ” ëª¨ë“  í•¸ë“œ í™•ì¸
          for (const hand of allHands) {
            const handNumber = hand.handNumber;
            const lastNotified = notifiedHands[handNumber];
            
            // ìƒˆë¡œìš´ í•¸ë“œë¼ë©´ (ì•Œë¦¼ ê¸°ë¡ì´ ì—†ìŒ)
            if (!lastNotified) {
              // ì‹œê°„ ì œí•œ ì—†ì´ ëª¨ë“  ìƒˆ í•¸ë“œë¥¼ ì•Œë¦¼ ëŒ€ìƒìœ¼ë¡œ
              newHandNumbers.push(handNumber);
              notifiedHands[handNumber] = now;
              
              // í•¸ë“œ ì‹œê°„ í™•ì¸ (ë””ë²„ê·¸ìš©)
              if (hand.handUpdatedAt) {
                const handTime = new Date(hand.handUpdatedAt).getTime();
                const minutesAgo = Math.floor((now - handTime) / (60 * 1000));
                
                if (DEBUG_MODE) {
                  console.log(`âœ… ìƒˆ í•¸ë“œ ë°œê²¬: ${handNumber} (${minutesAgo}ë¶„ ì „ ì¶”ê°€)`);
                }
                
                // 30ë¶„ ì´ë‚´ ì¶”ê°€ëœ í•¸ë“œë§Œ ì•Œë¦¼
                if (minutesAgo <= 30) {
                  recentlyAddedHands.push(handNumber);
                }
              } else {
                // handUpdatedAtì´ ì—†ìœ¼ë©´ ë¬´ì¡°ê±´ ìƒˆ í•¸ë“œë¡œ ê°„ì£¼
                recentlyAddedHands.push(handNumber);
                if (DEBUG_MODE) {
                  console.log(`âœ… ìƒˆ í•¸ë“œ ë°œê²¬: ${handNumber} (ì‹œê°„ ì •ë³´ ì—†ìŒ)`);
                }
              }
            } 
            // ì´ë¯¸ ì•Œë¦¼ì„ ë³´ë‚¸ í•¸ë“œë¼ë„ ì¿¨ë‹¤ìš´ì´ ì§€ë‚¬ìœ¼ë©´ ì¬ì•Œë¦¼ ê°€ëŠ¥
            else if (now - lastNotified > NOTIFICATION_COOLDOWN) {
              // ì¿¨ë‹¤ìš´ì´ ì§€ë‚¬ê³ , ìµœê·¼ì— ì—…ë°ì´íŠ¸ ëœ í•¸ë“œë§Œ
              if (hand.handUpdatedAt) {
                const handTime = new Date(hand.handUpdatedAt).getTime();
                const minutesAgo = Math.floor((now - handTime) / (60 * 1000));
                
                // 30ë¶„ ì´ë‚´ ì—…ë°ì´íŠ¸ëœ í•¸ë“œë§Œ ì¬ì•Œë¦¼
                if (minutesAgo <= 30) {
                  recentlyAddedHands.push(handNumber);
                  notifiedHands[handNumber] = now;
                  
                  if (DEBUG_MODE) {
                    console.log(`ğŸ”„ í•¸ë“œ ì¬ì•Œë¦¼: ${handNumber} (ì¿¨ë‹¤ìš´ ì¢…ë£Œ, ${minutesAgo}ë¶„ ì „ ì—…ë°ì´íŠ¸)`);
                  }
                }
              }
            } else if (DEBUG_MODE) {
              const cooldownRemaining = Math.ceil((NOTIFICATION_COOLDOWN - (now - lastNotified)) / 1000);
              console.log(`â³ í•¸ë“œ ${handNumber}: ì¿¨ë‹¤ìš´ ì¤‘ (${cooldownRemaining}ì´ˆ ë‚¨ìŒ)`);
            }
          }
          
          // ì•Œë¦¼ ë°œì†¡ (ìë™ ìƒˆë¡œê³ ì¹¨ì´ë¼ë„ suppressNotificationì´ falseë©´ ì•Œë¦¼)
          const shouldNotify = !suppressNotification || recentlyAddedHands.length > 0;
          
          if (shouldNotify && recentlyAddedHands.length > 0) {
            console.log(`ğŸ”” ìƒˆë¡œìš´ í•¸ë“œ ì•Œë¦¼: ${recentlyAddedHands.join(', ')}`);
            showNotification(`${recentlyAddedHands.length}ê°œì˜ ìƒˆë¡œìš´ í•¸ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! (${recentlyAddedHands.join(', ')})`);
            playSound('chime');
          }
          
          // ë°ì´í„° ë³€ê²½ì´ ìˆì—ˆìœ¼ë©´ localStorageì— ì €ì¥
          if (newHandNumbers.length > 0) {
            saveNotifiedHands(notifiedHands);
          }
        }
        
        // ë°ì´í„° ìŠ¤ëƒ…ìƒ· ì—…ë°ì´íŠ¸
        lastDataSnapshot = currentDataSnapshot;
        
        // ì´ˆê¸° ë¡œë”© ì™„ë£Œ í›„ì—ëŠ” falseë¡œ ì„¤ì •
        if (isInitialLoad) {
          isInitialLoad = false;
          const now = Date.now();
          console.log(`ğŸš€ ì´ˆê¸° ë¡œë”© ì™„ë£Œ. í˜„ì¬ í•¸ë“œ ìˆ˜: ${allHands.length}`);
          console.log(`ğŸ’¾ ê¸°ì¡´ ì•Œë¦¼ ê¸°ë¡: ${Object.keys(notifiedHands).length}ê°œ`);
          
          // ì´ˆê¸° ë¡œë”© ì‹œ í˜„ì¬ ìˆëŠ” ëª¨ë“  í•¸ë“œë¥¼ ì•Œë¦¼ ê¸°ë¡ì— ì¶”ê°€
          // í•˜ì§€ë§Œ ì‹œê°„ì€ í˜„ì¬ ì‹œê°„ë³´ë‹¤ 1ì‹œê°„ ì „ìœ¼ë¡œ ì„¤ì • (ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€)
          let hasNewHands = false;
          const oneHourAgo = now - (60 * 60 * 1000);
          
          allHands.forEach(hand => {
            if (!notifiedHands[hand.handNumber]) {
              notifiedHands[hand.handNumber] = oneHourAgo; // 1ì‹œê°„ ì „ìœ¼ë¡œ ì„¤ì •
              hasNewHands = true;
            }
          });
          
          // ë³€ê²½ì‚¬í•­ì´ ìˆìœ¼ë©´ ì €ì¥
          if (hasNewHands) {
            saveNotifiedHands(notifiedHands);
            console.log(`ğŸ’¾ ì•Œë¦¼ ê¸°ë¡ ì—…ë°ì´íŠ¸: ${Object.keys(notifiedHands).length}ê°œ`);
          }
          
          // ì´ˆê¸° ë°ì´í„° ìŠ¤ëƒ…ìƒ· ì €ì¥
          lastDataSnapshot = JSON.stringify(allHands.map(h => h.handNumber).sort());
        }
        
        lastHandCount = allHands.length;
        
        updateHandList();
        updateStats();
        
      } catch (error) {
        console.error('Index ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }
    
    async function loadHandData(handNumber) {
      try {
        const response = await fetch(CONFIG.CSV_HAND_URL + '&t=' + Date.now());
        const text = await response.text();
        const rows = parseCSV(text);
        
        const hand = allHands.find(h => h.handNumber === handNumber);
        if (!hand) return null;
        
        const handRows = rows.slice(hand.startRow - 1, hand.endRow);
        return parseHandDetails(handRows);
        
      } catch (error) {
        console.error('Hand ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        return null;
      }
    }
    
    function parseHandDetails(rows) {
      const hand = {
        number: '',
        table: '',
        blinds: { sb: 0, bb: 0 },
        players: [],
        actions: [],
        communityCards: [],
        pot: 0,
        winner: null,
        streets: {
          preflop: [],
          flop: [],
          turn: [],
          river: [],
          showdown: []
        }
      };
      
      let currentStreet = 'preflop';
      let streetBetAmount = {}; // ê° ìŠ¤íŠ¸ë¦¬íŠ¸ì˜ í˜„ì¬ ë² íŒ… ê¸ˆì•¡ ì¶”ì 
      streetBetAmount['preflop'] = 0;
      streetBetAmount['flop'] = 0;
      streetBetAmount['turn'] = 0;
      streetBetAmount['river'] = 0;
      
      for (const row of rows) {
        const rowType = row[1];
        
        switch (rowType) {
          case 'HAND':
            hand.number = row[2];
            hand.timestamp = row[3];
            if (row[11] && row[12]) {
              hand.blinds.sb = parseInt(row[11]) || 0;
              hand.blinds.bb = parseInt(row[12]) || 0;
            }
            hand.table = row[16] || '';
            break;
          
          case 'PLAYER':
            const playerName = row[2];
            const seat = parseInt(row[3]) || 0;
            const chips = parseInt(row[5]) || parseInt(row[6]) || 0;
            const cards = row[7] ? row[7].split(' ') : ['?', '?'];
            
            hand.players.push({
              seat: seat,
              name: playerName,
              chips: chips,
              cards: cards.length >= 2 ? cards : [cards[0] || '?', cards[1] || '?'],
              position: '',
              status: 'active'
            });
            break;
          
          case 'EVENT':
            const eventType = row[2];
            
            if (eventType === 'BOARD') {
              const boardNum = parseInt(row[3]) || 0;
              const card = row[4];
              
              if (boardNum === 1) {
                currentStreet = 'flop';
                streetBetAmount['flop'] = 0; // í”Œë¡­ ì‹œì‘ì‹œ ë² íŒ… ê¸ˆì•¡ ì´ˆê¸°í™”
                // ì²« ë²ˆì§¸ í”Œë¡­ ì¹´ë“œ ì¶”ê°€ (ë°°ì—´ ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ)
                hand.communityCards.push(card);
              } else if (boardNum === 2 || boardNum === 3) {
                // ë‘ ë²ˆì§¸, ì„¸ ë²ˆì§¸ í”Œë¡­ ì¹´ë“œ ì¶”ê°€
                hand.communityCards.push(card);
              } else if (boardNum === 4) {
                currentStreet = 'turn';
                streetBetAmount['turn'] = 0; // í„´ ì‹œì‘ì‹œ ë² íŒ… ê¸ˆì•¡ ì´ˆê¸°í™”
                hand.communityCards.push(card);
              } else if (boardNum === 5) {
                currentStreet = 'river';
                streetBetAmount['river'] = 0; // ë¦¬ë²„ ì‹œì‘ì‹œ ë² íŒ… ê¸ˆì•¡ ì´ˆê¸°í™”
                hand.communityCards.push(card);
              }
            } else {
              const playerNum = row[3];
              const amount = parseInt(row[4]) || 0;
              
              const playerObj = hand.players.find(p => p.seat === parseInt(playerNum));
              const playerName = playerObj ? playerObj.name : `Player ${playerNum}`;
              
              // CHECKì™€ CALLì„ ìŠ¤ë§ˆíŠ¸í•˜ê²Œ êµ¬ë¶„
              let displayAction = eventType;
              const currentBet = streetBetAmount[currentStreet] || 0;
              
              // CALL ì•¡ì…˜ ì²˜ë¦¬
              if (eventType === 'CALL') {
                // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ…ì´ ì—†ê³  amountê°€ 0ì´ê±°ë‚˜ ì‘ìœ¼ë©´ CHECK
                // ë˜ëŠ” CALLí•˜ë ¤ëŠ” ê¸ˆì•¡ì´ í˜„ì¬ ë² íŒ…ê³¼ ê°™ìœ¼ë©´ CHECK
                if ((currentBet === 0 && amount <= hand.blinds.bb) || amount === currentBet) {
                  displayAction = 'CHECK/CALL';
                  if (DEBUG_MODE) {
                    console.log(`âœ… CHECK ê°ì§€: ${playerName} (${currentStreet}, bet=${currentBet}, amount=${amount})`);
                  }
                } else {
                  // ì§„ì§œ CALL
                  displayAction = 'CHECK/CALL';
                  if (DEBUG_MODE) {
                    console.log(`ğŸ“ CALL ê°ì§€: ${playerName} ${amount} (${currentStreet}, bet=${currentBet})`);
                  }
                }
              } else if (eventType === 'CHECK') {
                displayAction = 'CHECK/CALL';
              }
              
              // BETì´ë‚˜ RAISEê°€ ë°œìƒí•˜ë©´ í•´ë‹¹ ìŠ¤íŠ¸ë¦¬íŠ¸ì˜ ë² íŒ… ê¸ˆì•¡ ì—…ë°ì´íŠ¸
              if (eventType === 'BET' || eventType === 'RAISE' || eventType === 'RAISE TO') {
                streetBetAmount[currentStreet] = amount;
                if (DEBUG_MODE) {
                  console.log(`ğŸ“Š ${currentStreet} ë² íŒ… ì—…ë°ì´íŠ¸: ${amount}`);
                }
              }
              
              const action = {
                player: playerName,
                action: displayAction,
                amount: amount,
                street: currentStreet
              };
              
              hand.actions.push(action);
              hand.streets[currentStreet].push(action);
              
              // pot ê³„ì‚°: amountê°€ ìˆëŠ” ê²½ìš°ë§Œ ì¶”ê°€
              if (amount > 0) {
                // BET, CALL (with amount), RAISE, RAISE TO, ALL-IN ë“±
                if (eventType === 'BET' || eventType === 'CALL' || eventType === 'RAISE' || eventType === 'RAISE TO' || eventType === 'ALL-IN' || eventType === 'ALLIN') {
                  hand.pot += amount;
                  
                  if (DEBUG_MODE) {
                    console.log(`ğŸ’° POT ì¶”ê°€: ${playerName} ${displayAction} ${amount} (í˜„ì¬ POT: ${hand.pot})`);
                  }
                }
              }
              
              if (eventType === 'FOLD' && playerObj) {
                playerObj.status = 'folded';
              }
            }
            break;
          
          case 'WIN':
            const winnerNum = row[2];
            const winAmount = parseInt(row[3]) || 0;
            const winnerObj = hand.players.find(p => p.seat === parseInt(winnerNum));
            
            hand.winner = {
              player: winnerObj ? winnerObj.name : `Player ${winnerNum}`,
              amount: winAmount,
              hand: row[4] || ''
            };
            break;
        }
      }
      
      calculatePositions(hand);
      return hand;
    }
    
    function calculatePositions(hand) {
      const playerCount = hand.players.length;
      if (playerCount < 2) return;
      
      const positions = getPositionNames(playerCount);
      hand.players.forEach((player, index) => {
        player.position = positions[index];
      });
    }
    
    function getPositionNames(playerCount) {
      const positions = {
        2: ['BTN', 'BB'],
        3: ['BTN', 'SB', 'BB'],
        4: ['BTN', 'SB', 'BB', 'CO'],
        5: ['BTN', 'SB', 'BB', 'UTG', 'CO'],
        6: ['BTN', 'SB', 'BB', 'UTG', 'MP', 'CO'],
        7: ['BTN', 'SB', 'BB', 'UTG', 'UTG+1', 'MP', 'CO'],
        8: ['BTN', 'SB', 'BB', 'UTG', 'UTG+1', 'MP', 'MP+1', 'CO'],
        9: ['BTN', 'SB', 'BB', 'UTG', 'UTG+1', 'UTG+2', 'MP', 'MP+1', 'CO']
      };
      
      return positions[playerCount] || Array(playerCount).fill('').map((_, i) => `Seat ${i + 1}`);
    }
    
    // ====================================
    // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    // ====================================
    
    function updateHandList() {
      const listEl = document.getElementById('hand-list');
      const tableFilter = document.getElementById('table-filter').value;
      const statusFilter = document.getElementById('status-filter').value;
      
      let filteredHands = allHands;
      
      if (tableFilter) {
        filteredHands = filteredHands.filter(h => h.table === tableFilter);
      }
      
      if (statusFilter) {
        filteredHands = filteredHands.filter(h => {
          if (statusFilter === 'completed') return h.handEdit;
          if (statusFilter === 'pending') return !h.handEdit;
          return true;
        });
      }
      
      listEl.innerHTML = filteredHands.map(hand => {
        // ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
        const statusColor = hand.handEdit ? 'border-green-500 bg-green-900/20' : 
                          hand.workStatus === 'ì§„í–‰ì¤‘' ? 'border-yellow-500 bg-yellow-900/20' : 
                          'border-gray-600 bg-gray-800';
        
        // ìŠ¤íŠ¸ë¦¬íŠ¸ë³„ ìƒ‰ìƒ
        const streetColors = {
          'preflop': 'text-purple-400',
          'flop': 'text-blue-400', 
          'turn': 'text-green-400',
          'river': 'text-orange-400',
          'showdown': 'text-yellow-400'
        };
        const streetColor = streetColors[hand.lastStreet?.toLowerCase()] || 'text-gray-400';
        
        // ì‹œê°„ í‘œì‹œ í¬ë§·
        const time = hand.handUpdatedAt ? new Date(hand.handUpdatedAt).toLocaleTimeString('ko-KR', {
          hour: '2-digit',
          minute: '2-digit'
        }) : '-';
        
        // ì¹´ë©”ë¼ íŒŒì¼ëª… ì •ë³´ (ì´ë¯¸ ë³€í™˜ëœ í˜•íƒœ)
        const camFilesText = hand.camFiles && hand.camFiles.length > 0 ? 
          hand.camFiles.slice(0, 2).join(', ') + 
          (hand.camFiles.length > 2 ? ` (+${hand.camFiles.length - 2})` : '') : 
          'íŒŒì¼ ì—†ìŒ';

        return `
        <div class="rounded-lg p-3 cursor-pointer hover:scale-105 transition-all border ${statusColor}" 
             onclick="selectHand('${hand.handNumber}')">
          <div class="flex items-center justify-between mb-1">
            <span class="text-sm font-bold text-white">Hand #${hand.handNumber}</span>
            ${hand.handEdit ? '<span class="text-green-400">âœ“</span>' : 
              hand.workStatus === 'ì§„í–‰ì¤‘' ? '<span class="text-yellow-400">âš¡</span>' : ''}
          </div>
          <div class="flex items-center justify-between text-xs">
            <span class="text-gray-300">${hand.table || 'í…Œì´ë¸” -'}</span>
            <span class="${streetColor} font-semibold">${hand.lastStreet || 'Preflop'}</span>
          </div>
          <div class="flex items-center justify-between text-xs mt-1">
            <span class="text-gray-500">${hand.lastAction || '-'}</span>
            <span class="text-gray-500">${time}</span>
          </div>
          <div class="text-xs text-blue-300 mt-1 truncate" title="${hand.camFiles?.join(', ') || ''}">
            ğŸ“¹ ${camFilesText}
          </div>
        </div>
      `;
      }).join('');
      
      document.getElementById('hand-count').textContent = filteredHands.length;
      
      // í…Œì´ë¸” í•„í„° ì˜µì…˜ ì—…ë°ì´íŠ¸ (í˜„ì¬ ì„ íƒëœ ê°’ ìœ ì§€)
      const tables = [...new Set(allHands.map(h => h.table).filter(t => t))];
      const tableFilterEl = document.getElementById('table-filter');
      const currentTable = tableFilterEl.value;
      
      // í…Œì´ë¸” ëª©ë¡ì´ ë‹¬ë¼ì¡Œì„ ë•Œë§Œ ì—…ë°ì´íŠ¸
      const currentOptions = Array.from(tableFilterEl.options).slice(1).map(opt => opt.value);
      const hasChanged = tables.length !== currentOptions.length || 
                        tables.some(t => !currentOptions.includes(t));
      
      if (hasChanged) {
        tableFilterEl.innerHTML = '<option value="">ëª¨ë“  í…Œì´ë¸”</option>' +
          tables.map(table => `<option value="${table}">${table}</option>`).join('');
      }
      
      // í˜„ì¬ ì„ íƒëœ ê°’ ë³µì›
      if (currentTable && tables.includes(currentTable)) {
        tableFilterEl.value = currentTable;
      }
    }
    
    function updateStats() {
      document.getElementById('total-hands').textContent = allHands.length;
      document.getElementById('completed-hands').textContent = allHands.filter(h => h.handEdit).length;
    }
    
    async function selectHand(handNumber) {
      currentHand = handNumber;
      
      const hand = await loadHandData(handNumber);
      if (!hand) return;
      
      // ì¸ë±ìŠ¤ì—ì„œ ì¹´ë©”ë¼ íŒŒì¼ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      const indexHand = allHands.find(h => h.handNumber === handNumber);
      
      // í—¤ë” ì •ë³´ ì—…ë°ì´íŠ¸
      document.getElementById('hand-number').textContent = hand.number;
      document.getElementById('table-name').textContent = hand.table || '-';
      document.getElementById('blinds').textContent = `${hand.blinds.sb}/${hand.blinds.bb}`;
      document.getElementById('pot-amount').textContent = formatNumber(hand.pot);
      
      // ì¹´ë©”ë¼ íŒŒì¼ëª… ì—…ë°ì´íŠ¸ (ì´ë¯¸ ë³€í™˜ëœ í˜•íƒœ)
      const cameraFilesEl = document.getElementById('camera-files');
      if (indexHand && indexHand.camFiles && indexHand.camFiles.length > 0) {
        cameraFilesEl.textContent = indexHand.camFiles.join(', ');
        cameraFilesEl.title = indexHand.camFiles.join('\n');
      } else {
        cameraFilesEl.textContent = 'íŒŒì¼ ì—†ìŒ';
        cameraFilesEl.title = '';
      }
      
      // ë³´ë“œ ì¹´ë“œ í‘œì‹œ
      updateBoardCards(hand.communityCards);
      
      // í”Œë ˆì´ì–´ ì¹´ë“œ í‘œì‹œ
      updatePlayersSection(hand.players);
      
      // ì•¡ì…˜ íˆìŠ¤í† ë¦¬ í‘œì‹œ
      updateActionHistory(hand);
      
      // í•¸ë“œ ê²°ê³¼ í‘œì‹œ
      updateHandResult(hand);
      
      // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì™„ë£Œ ìƒíƒœì— ë”°ë¼)
      updateHandStatus(indexHand ? indexHand.handEdit : false);
    }
    
    function updateBoardCards(cards) {
      const container = document.getElementById('board-cards');
      
      // 5ì¥ì˜ ì¹´ë“œ ìŠ¬ë¡¯ í‘œì‹œ (ë¹„ì–´ìˆëŠ” ê²ƒì€ í°ìƒ‰ ì ì„ )
      let html = '';
      for (let i = 0; i < 5; i++) {
        if (cards && cards[i]) {
          html += createCardElement(cards[i], 'board');
        } else {
          html += '<div class="board-card" style="background-color: #FFFFFF !important; color: #9ca3af; border: 2px dashed #d1d5db; color-scheme: light;">?</div>';
        }
      }
      
      container.innerHTML = html;
    }
    
    function updatePlayersSection(players) {
      const container = document.getElementById('players-section');
      
      container.innerHTML = players.map(player => `
        <div class="player-item ${player.status === 'folded' ? 'folded' : ''}">
          <div class="flex items-center gap-2">
            <span class="pos-badge ${getPositionBadgeClass(player.position)}">${player.position}</span>
            <span class="text-xs font-semibold">${player.name}</span>
          </div>
          <div class="flex items-center gap-2">
            ${player.cards.map(card => createCardElement(card)).join('')}
            <span class="text-xs text-gray-400">${formatNumber(player.chips)}</span>
          </div>
        </div>
      `).join('');
    }
    
    function updateActionHistory(hand) {
      const container = document.getElementById('action-history');
      const streets = ['preflop', 'flop', 'turn', 'river', 'showdown'];
      
      let html = '';
      
      streets.forEach(street => {
        if (hand.streets[street] && hand.streets[street].length > 0) {
          html += `<div class="mb-2">`;
          html += `<div class="text-xs font-semibold text-gray-400 uppercase mb-1">${street}</div>`;
          hand.streets[street].forEach(action => {
            html += `
              <div class="action-line ${street}">
                <span class="text-xs">${action.player}</span>
                <span class="action-badge ${getActionBadgeClass(action.action)}">${action.action}</span>
                ${action.amount > 0 ? `<span class="text-xs text-gray-400">${formatNumber(action.amount)}</span>` : ''}
              </div>
            `;
          });
          html += `</div>`;
        }
      });
      
      container.innerHTML = html || '<div class="text-xs text-gray-500">ì•¡ì…˜ ê¸°ë¡ ì—†ìŒ</div>';
    }
    
    function updateHandResult(hand) {
      const container = document.getElementById('hand-result');
      
      if (!hand.winner) {
        container.innerHTML = '<div class="text-xs text-gray-400">ê²°ê³¼ ì—†ìŒ</div>';
        return;
      }
      
      container.innerHTML = `
        <div class="text-sm font-bold text-green-400">${hand.winner.player}</div>
        <div class="text-xs text-gray-300">Win: ${formatNumber(hand.winner.amount)}</div>
        ${hand.winner.hand ? `<div class="text-xs text-gray-400">${hand.winner.hand}</div>` : ''}
      `;
    }
    
    // ====================================
    // ì•Œë¦¼ í•¨ìˆ˜
    // ====================================
    
    function showNotification(message) {
      if (!CONFIG.ENABLE_NOTIFICATIONS) return;
      
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification('í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§', {
          body: message,
          icon: '/favicon.ico'
        });
      }
    }
    
    function playSound(type = 'notification') {
      if (!CONFIG.ENABLE_SOUND) return;
      
      const soundMap = {
        // ë¶€ë“œëŸ¬ìš´ ë²¨ ì†Œë¦¬ (ìƒˆ í•¸ë“œ ì•Œë¦¼ìš©)
        notification: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+zPDTgjMGHm7A7+OZURE',
        
        // ì„±ê³µ ì†Œë¦¬ (ì™„ë£Œ/ì—…ë°ì´íŠ¸ ì„±ê³µì‹œ)
        success: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+zPDTgjMGHm7A7+OZURE',
        
        // ì°¨ì„ë²¨ ì†Œë¦¬ (ë” ë¶€ë“œëŸ¬ìš´ ì•Œë¦¼)
        chime: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSl+zPDTgjMGHm7A7+OZURE'
      };
      
      // Web Audio APIë¥¼ ì‚¬ìš©í•œ ë” ì˜ˆìœ ì†Œë¦¬ ìƒì„±
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        if (type === 'chime') {
          // ë¶€ë“œëŸ¬ìš´ ì°¨ì„ë²¨ ì†Œë¦¬
          playChimeSound(audioContext);
        } else if (type === 'success') {
          // ì„±ê³µ ì†Œë¦¬ (ìƒìŠ¹í•˜ëŠ” í†¤)
          playSuccessSound(audioContext);
        } else {
          // ê¸°ë³¸ ì•Œë¦¼ ì†Œë¦¬ (ë¶€ë“œëŸ¬ìš´ ë²¨)
          playBellSound(audioContext);
        }
      } catch (error) {
        // Web Audio API ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ì˜¤ë””ì˜¤ ì‚¬ìš©
        const audio = new Audio(soundMap[type] || soundMap.notification);
        audio.volume = 0.5;
        audio.play().catch(e => console.log('ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e));
      }
    }
    
    // ë¶€ë“œëŸ¬ìš´ ë²¨ ì†Œë¦¬ ìƒì„±
    function playBellSound(audioContext) {
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.3);
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
      
      oscillator.type = 'sine';
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.8);
    }
    
    // ì„±ê³µ ì†Œë¦¬ ìƒì„± (ìƒìŠ¹í•˜ëŠ” 3ìŒê³„)
    function playSuccessSound(audioContext) {
      const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
      const duration = 0.15;
      
      frequencies.forEach((freq, index) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime + (index * duration));
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime + (index * duration));
        gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + (index * duration) + 0.02);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + (index * duration) + duration);
        
        oscillator.start(audioContext.currentTime + (index * duration));
        oscillator.stop(audioContext.currentTime + (index * duration) + duration);
      });
    }
    
    // ì°¨ì„ë²¨ ì†Œë¦¬ ìƒì„± (í™”ìŒ)
    function playChimeSound(audioContext) {
      const frequencies = [523.25, 659.25, 783.99, 1046.5]; // C5, E5, G5, C6 í™”ìŒ
      
      frequencies.forEach((freq, index) => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
        oscillator.type = 'sine';
        
        const volume = 0.15 / (index + 1); // ë†’ì€ ìŒì¼ìˆ˜ë¡ ì‘ê²Œ
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.05);
        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1.2);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 1.2);
      });
    }
    
    // ====================================
    // í•¸ë“œ í¸ì§‘ ìƒíƒœ ì—…ë°ì´íŠ¸
    // ====================================
    
    async function updateHandEditStatus(handNumber, checked) {
      const completeBtn = document.getElementById('complete-btn');
      const editBtn = document.getElementById('edit-btn');
      
      // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      completeBtn.disabled = true;
      editBtn.disabled = true;
      completeBtn.textContent = checked ? 'ì™„ë£Œ ì¤‘...' : 'ì·¨ì†Œ ì¤‘...';
      
      try {
        const payload = {
          action: 'updateHandEdit',
          handNumber: handNumber,
          checked: checked
        };
        
        console.log('ğŸ”§ ì™„ë£Œ ë²„íŠ¼ í´ë¦­ - ì „ì†¡í•  ë°ì´í„°:', payload);
        console.log('ğŸ”§ í˜„ì¬ CONFIG.APPS_SCRIPT_URL:', CONFIG.APPS_SCRIPT_URL);
        
        const formData = new FormData();
        formData.append('payload', JSON.stringify(payload));
        
        console.log('ğŸ“¤ Google Apps Script ìš”ì²­ ì „ì†¡ ì¤‘...');
        console.log('ğŸ“¤ ì‚¬ìš© ì¤‘ì¸ URL:', CONFIG.APPS_SCRIPT_URL);
        const response = await fetch(CONFIG.APPS_SCRIPT_URL + '?_t=' + Date.now(), {
          method: 'POST',
          body: formData,
          cache: 'no-cache'
        });
        
        console.log('ğŸ“¨ ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
        console.log('ğŸ“¨ ì‘ë‹µ í—¤ë”:', Object.fromEntries(response.headers.entries()));
        
        const responseText = await response.text();
        console.log('ğŸ“¨ ì‘ë‹µ ì›ë³¸ í…ìŠ¤íŠ¸:', responseText);
        
        let result;
        try {
          result = JSON.parse(responseText);
          console.log('ğŸ“¨ íŒŒì‹±ëœ ê²°ê³¼:', result);
        } catch (parseError) {
          console.error('âŒ JSON íŒŒì‹± ì‹¤íŒ¨:', parseError);
          console.error('âŒ ì‘ë‹µì´ JSONì´ ì•„ë‹˜:', responseText);
          throw new Error('ì„œë²„ ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + responseText);
        }
        
        if (result.success === true || result.status === 'success') {
          console.log('í•¸ë“œ í¸ì§‘ ìƒíƒœ ì—…ë°ì´íŠ¸ ì„±ê³µ:', result);
          
          // ì„±ê³µ ì•Œë¦¼
          showNotification(
            checked ? 'âœ… í•¸ë“œ í¸ì§‘ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!' : 'ğŸ“ í•¸ë“œê°€ í¸ì§‘ ëŒ€ê¸° ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!',
            'success'
          );
          
          // ì„±ê³µ ì†Œë¦¬ ì¬ìƒ
          playSound('success');
          
          // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (ì•Œë¦¼ ì–µì œ)
          await loadIndexData(true);
          
          // í˜„ì¬ ì„ íƒëœ í•¸ë“œ ì—…ë°ì´íŠ¸
          if (currentHand === handNumber) {
            updateHandStatus(checked);
          }
        } else if (result.status === 'error') {
          console.error('í•¸ë“œ í¸ì§‘ ìƒíƒœ ì—…ë°ì´íŠ¸ ì—ëŸ¬:', result);
          showNotification('âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
        } else {
          console.error('í•¸ë“œ í¸ì§‘ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ - ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ:', result);
          showNotification('âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ì„œë²„ ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜', 'error');
        }
      } catch (error) {
        console.error('API ì˜¤ë¥˜:', error);
        showNotification('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
        completeBtn.disabled = false;
        editBtn.disabled = false;
        completeBtn.textContent = 'ì™„ë£Œ';
      }
    }
    
    // í˜„ì¬ í•¸ë“œì˜ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateHandStatus(isCompleted) {
      const completeBtn = document.getElementById('complete-btn');
      const editBtn = document.getElementById('edit-btn');
      
      if (isCompleted) {
        completeBtn.classList.add('bg-gray-600');
        completeBtn.classList.remove('bg-green-600');
        completeBtn.textContent = 'ì™„ë£Œë¨';
        completeBtn.disabled = true;
        
        editBtn.classList.remove('bg-gray-600');
        editBtn.classList.add('bg-yellow-600');
        editBtn.disabled = false;
      } else {
        completeBtn.classList.remove('bg-gray-600');
        completeBtn.classList.add('bg-green-600');
        completeBtn.textContent = 'ì™„ë£Œ';
        completeBtn.disabled = false;
        
        editBtn.classList.add('bg-gray-600');
        editBtn.classList.remove('bg-yellow-600');
        editBtn.disabled = true;
      }
    }
    
    // ====================================
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    // ====================================
    
    document.getElementById('refresh-btn').addEventListener('click', () => {
      console.log('ğŸ”„ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨');
      loadIndexData(false); // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ì€ ì•Œë¦¼ í—ˆìš©
    });
    
    document.getElementById('settings-btn').addEventListener('click', () => {
      document.getElementById('settings-modal').classList.remove('hidden');
    });
    
    document.getElementById('cancel-settings').addEventListener('click', () => {
      document.getElementById('settings-modal').classList.add('hidden');
    });
    
    document.getElementById('save-settings').addEventListener('click', () => {
      CONFIG.REFRESH_INTERVAL = parseInt(document.getElementById('refresh-interval').value);
      CONFIG.ENABLE_NOTIFICATIONS = document.getElementById('enable-notifications').checked;
      CONFIG.ENABLE_SOUND = document.getElementById('enable-sound').checked;
      
      // ëª¨ë“  íƒ€ì´ë¨¸ ì •ë¦¬
      if (refreshTimerInitial) {
        clearTimeout(refreshTimerInitial);
        refreshTimerInitial = null;
      }
      if (refreshTimerInterval) {
        clearInterval(refreshTimerInterval);
        refreshTimerInterval = null;
      }
      
      // ìƒˆë¡œìš´ íƒ€ì´ë¨¸ ì„¤ì •
      refreshTimerInterval = setInterval(() => loadIndexData(true), CONFIG.REFRESH_INTERVAL);
      
      document.getElementById('settings-modal').classList.add('hidden');
    });
    
    // ì•Œë¦¼ ê¸°ë¡ ì´ˆê¸°í™” ë²„íŠ¼
    document.getElementById('clear-notification-history').addEventListener('click', () => {
      if (confirm('ì •ë§ë¡œ ëª¨ë“  ì•Œë¦¼ ê¸°ë¡ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸°ì¡´ í•¸ë“œë„ ìƒˆë¡œìš´ í•¸ë“œë¡œ ì¸ì‹ë˜ì–´ ì•Œë¦¼ì´ ë‹¤ì‹œ ë°œìƒí•©ë‹ˆë‹¤.')) {
        // localStorage ì´ˆê¸°í™”
        localStorage.removeItem(STORAGE_KEY);
        notifiedHands = {};
        lastDataSnapshot = '';
        
        showNotification('âœ… ì•Œë¦¼ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        console.log('ğŸ”„ ì•Œë¦¼ ê¸°ë¡ ì´ˆê¸°í™” ì™„ë£Œ');
        console.log('ğŸ”„ ë‹¤ìŒ ìƒˆë¡œê³ ì¹¨ë¶€í„° ìƒˆë¡œìš´ í•¸ë“œ ì•Œë¦¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤.');
        
        // ì„¤ì • ì°½ ë‹«ê¸°
        document.getElementById('settings-modal').classList.add('hidden');
      }
    });
    
    document.getElementById('table-filter').addEventListener('change', updateHandList);
    document.getElementById('status-filter').addEventListener('change', updateHandList);
    
    document.getElementById('edit-btn').addEventListener('click', () => {
      if (currentHand) {
        const confirmed = confirm('ì´ í•¸ë“œë¥¼ í¸ì§‘ ëŒ€ê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?');
        if (confirmed) {
          updateHandEditStatus(currentHand, false);
        }
      }
    });
    
    document.getElementById('complete-btn').addEventListener('click', () => {
      if (currentHand) {
        const confirmed = confirm('ì´ í•¸ë“œ í¸ì§‘ì„ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì™„ë£Œ í›„ì—ëŠ” Index ì‹œíŠ¸ì˜ handEdit ì—´ì— ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë©ë‹ˆë‹¤.');
        if (confirmed) {
          updateHandEditStatus(currentHand, true);
        }
      }
    });
    
    // ====================================
    // ì´ˆê¸°í™”
    // ====================================
    
    async function init() {
      console.log('í¬ì»¤ í•¸ë“œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ v8.0.0 Compact ì‹œì‘');
      
      if ('Notification' in window && Notification.permission === 'default') {
        await Notification.requestPermission();
      }
      
      await loadIndexData();
      
      if (allHands.length > 0) {
        selectHand(allHands[0].handNumber);
      }
      
      // ìë™ ìƒˆë¡œê³ ì¹¨ - ì´ˆê¸° ë¡œë“œ ì§í›„ê°€ ì•„ë‹Œ REFRESH_INTERVAL í›„ì— ì‹œì‘
      // ì´ë ‡ê²Œ í•˜ë©´ í˜ì´ì§€ ë¡œë“œ ì‹œ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€
      refreshTimerInitial = setTimeout(() => {
        // ì²« ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰
        if (DEBUG_MODE) {
          console.log('â° ì²« ìë™ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ (ìƒˆ í•¸ë“œ ê°ì§€ í¬í•¨)');
        }
        loadIndexData(false);
        
        // ì´ˆê¸° íƒ€ì´ë¨¸ ì •ë¦¬
        refreshTimerInitial = null;
        
        // ì´í›„ ì •ê¸°ì ì¸ ìƒˆë¡œê³ ì¹¨ ì„¤ì •
        refreshTimerInterval = setInterval(() => {
          if (DEBUG_MODE) {
            console.log('â° ìë™ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰ (ìƒˆ í•¸ë“œ ê°ì§€ í¬í•¨)');
          }
          loadIndexData(false); // false = ìƒˆë¡œìš´ í•¸ë“œì— ëŒ€í•´ì„œëŠ” ì•Œë¦¼ í—ˆìš©
        }, CONFIG.REFRESH_INTERVAL);
      }, CONFIG.REFRESH_INTERVAL); // ì²« ì‹¤í–‰ë„ REFRESH_INTERVAL í›„ì—
      
      console.log('ì´ˆê¸°í™” ì™„ë£Œ');
    }
    
    // ì•± ì‹œì‘
    init();
    
    // í˜ì´ì§€ ì¢…ë£Œ ì‹œ íƒ€ì´ë¨¸ ì •ë¦¬
    window.addEventListener('beforeunload', () => {
      if (refreshTimerInitial) {
        clearTimeout(refreshTimerInitial);
      }
      if (refreshTimerInterval) {
        clearInterval(refreshTimerInterval);
      }
    });
  </script>
</body>
</html>
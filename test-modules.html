<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨ë“ˆ í†µí•© í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #ddd;
            background: #f9f9f9;
        }
        .success {
            border-color: #4CAF50;
            background: #e8f5e9;
        }
        .error {
            border-color: #f44336;
            background: #ffebee;
        }
        .warning {
            border-color: #ff9800;
            background: #fff3e0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .benchmark-result {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            background: #e3f2fd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Virtual Table DB ëª¨ë“ˆ í†µí•© í…ŒìŠ¤íŠ¸</h1>

    <!-- ëª¨ë“ˆ ë¡œë“œ -->
    <script src="src/modules/filename-manager.js"></script>
    <script src="src/modules/ai-analyzer.js"></script>
    <script src="src/modules/filename-adapter.js"></script>

    <div class="test-section">
        <h2>1ï¸âƒ£ ëª¨ë“ˆ ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testModuleLoad()">ëª¨ë“ˆ ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="module-load-results"></div>
    </div>

    <div class="test-section">
        <h2>2ï¸âƒ£ íŒŒì¼ëª… ìƒì„± í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testFilenameGeneration()">íŒŒì¼ëª… ìƒì„± í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="filename-gen-results"></div>
    </div>

    <div class="test-section">
        <h2>3ï¸âƒ£ í•¸ë“œë²ˆí˜¸ ì¶”ì¶œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testHandExtraction()">í•¸ë“œë²ˆí˜¸ ì¶”ì¶œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="hand-extract-results"></div>
    </div>

    <div class="test-section">
        <h2>4ï¸âƒ£ í˜¸í™˜ì„± ì–´ëŒ‘í„° í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testCompatibility()">í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="compat-results"></div>
    </div>

    <div class="test-section">
        <h2>5ï¸âƒ£ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬</h2>
        <button onclick="runBenchmark()">ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰</button>
        <div id="benchmark-results"></div>
    </div>

    <div class="test-section">
        <h2>6ï¸âƒ£ AI ë¶„ì„ í…ŒìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)</h2>
        <input type="text" id="gemini-api-key" placeholder="Gemini API í‚¤ ì…ë ¥ (ì„ íƒì‚¬í•­)" style="width: 300px; padding: 5px;">
        <button onclick="testAIAnalysis()">AI ë¶„ì„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="ai-results"></div>
    </div>

    <script>
        // í…ŒìŠ¤íŠ¸ í—¬í¼ í•¨ìˆ˜
        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.innerHTML = message;
            container.appendChild(result);
        }

        // 1. ëª¨ë“ˆ ë¡œë“œ í…ŒìŠ¤íŠ¸
        function testModuleLoad() {
            const results = document.getElementById('module-load-results');
            results.innerHTML = '';

            // FilenameManager í™•ì¸
            if (window.FilenameManager) {
                addResult('module-load-results', 'âœ… FilenameManager ëª¨ë“ˆ ë¡œë“œ ì„±ê³µ', 'success');
            } else {
                addResult('module-load-results', 'âŒ FilenameManager ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨', 'error');
            }

            // AIAnalyzer í™•ì¸
            if (window.AIAnalyzer) {
                addResult('module-load-results', 'âœ… AIAnalyzer ëª¨ë“ˆ ë¡œë“œ ì„±ê³µ', 'success');
            } else {
                addResult('module-load-results', 'âŒ AIAnalyzer ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨', 'error');
            }

            // í˜¸í™˜ì„± í•¨ìˆ˜ í™•ì¸
            if (window.generateCustomFilename) {
                addResult('module-load-results', 'âœ… í˜¸í™˜ì„± ì–´ëŒ‘í„° ë¡œë“œ ì„±ê³µ', 'success');
            } else {
                addResult('module-load-results', 'âŒ í˜¸í™˜ì„± ì–´ëŒ‘í„° ë¡œë“œ ì‹¤íŒ¨', 'error');
            }
        }

        // 2. íŒŒì¼ëª… ìƒì„± í…ŒìŠ¤íŠ¸
        async function testFilenameGeneration() {
            const results = document.getElementById('filename-gen-results');
            results.innerHTML = '';

            try {
                // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
                const testCases = [
                    { handNumber: 142, expected: 'contains 142' },
                    { handNumber: 1, expected: 'contains 1' },
                    { handNumber: 99999, expected: 'contains 99999' }
                ];

                for (const test of testCases) {
                    const filename = await window.FilenameManager.generateFilename(test.handNumber);
                    if (filename && filename.includes(test.handNumber.toString())) {
                        addResult('filename-gen-results',
                            `âœ… í•¸ë“œ #${test.handNumber}: "${filename}"`,
                            'success');
                    } else {
                        addResult('filename-gen-results',
                            `âŒ í•¸ë“œ #${test.handNumber}: ìƒì„± ì‹¤íŒ¨`,
                            'error');
                    }
                }
            } catch (error) {
                addResult('filename-gen-results',
                    `âŒ ì˜¤ë¥˜: ${error.message}`,
                    'error');
            }
        }

        // 3. í•¸ë“œë²ˆí˜¸ ì¶”ì¶œ í…ŒìŠ¤íŠ¸
        function testHandExtraction() {
            const results = document.getElementById('hand-extract-results');
            results.innerHTML = '';

            // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
            const testCases = [
                { filename: 'VT142_BTN_3bet_win', expected: 142 },
                { filename: 'H999_allin_fold', expected: 999 },
                { filename: '142_simple', expected: 142 },
                { filename: 'invalid_filename', expected: null }
            ];

            for (const test of testCases) {
                const result = window.FilenameManager.extractHandNumber(test.filename);

                if (result === test.expected) {
                    addResult('hand-extract-results',
                        `âœ… "${test.filename}" â†’ ${result}`,
                        'success');
                } else {
                    addResult('hand-extract-results',
                        `âŒ "${test.filename}" â†’ ${result} (ì˜ˆìƒ: ${test.expected})`,
                        'error');
                }
            }
        }

        // 4. í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸
        async function testCompatibility() {
            const results = document.getElementById('compat-results');
            results.innerHTML = '';

            try {
                // ë ˆê±°ì‹œ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
                const filename = await window.generateCustomFilename(777);
                if (filename) {
                    addResult('compat-results',
                        `âœ… generateCustomFilename() í˜¸í™˜ì„± ìœ ì§€: "${filename}"`,
                        'success');
                }

                const handNumber = window.extractHandNumberFromFilename('VT888_test');
                if (handNumber === 888) {
                    addResult('compat-results',
                        `âœ… extractHandNumberFromFilename() í˜¸í™˜ì„± ìœ ì§€: ${handNumber}`,
                        'success');
                } else {
                    addResult('compat-results',
                        `âš ï¸ extractHandNumberFromFilename() ê²°ê³¼ ë¶ˆì¼ì¹˜: ${handNumber}`,
                        'warning');
                }

            } catch (error) {
                addResult('compat-results',
                    `âŒ í˜¸í™˜ì„± ì˜¤ë¥˜: ${error.message}`,
                    'error');
            }
        }

        // 5. ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
        async function runBenchmark() {
            const results = document.getElementById('benchmark-results');
            results.innerHTML = '<h3>ğŸ“Š ì„±ëŠ¥ ì¸¡ì • ì¤‘...</h3>';

            // íŒŒì¼ëª… ìƒì„± ë²¤ì¹˜ë§ˆí¬
            const genStart = performance.now();
            for (let i = 0; i < 1000; i++) {
                await window.FilenameManager.generateFilename(i);
            }
            const genTime = performance.now() - genStart;

            // í•¸ë“œë²ˆí˜¸ ì¶”ì¶œ ë²¤ì¹˜ë§ˆí¬
            const extractStart = performance.now();
            for (let i = 0; i < 1000; i++) {
                window.FilenameManager.extractHandNumber(`VT${i}_test_file`);
            }
            const extractTime = performance.now() - extractStart;

            // Map ì¡°íšŒ ì„±ëŠ¥
            const mapStart = performance.now();
            for (let i = 0; i < 10000; i++) {
                window.FilenameManager.handToFilename.get(i);
            }
            const mapTime = performance.now() - mapStart;

            results.innerHTML = `
                <h3>ğŸ“Š ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼</h3>
                <div class="benchmark-result">íŒŒì¼ëª… ìƒì„± 1000íšŒ: ${genTime.toFixed(2)}ms</div>
                <div class="benchmark-result">í•¸ë“œë²ˆí˜¸ ì¶”ì¶œ 1000íšŒ: ${extractTime.toFixed(2)}ms</div>
                <div class="benchmark-result">Map ì¡°íšŒ 10000íšŒ: ${mapTime.toFixed(2)}ms</div>
                <br>
                <div class="benchmark-result">í‰ê·  íŒŒì¼ëª… ìƒì„±: ${(genTime/1000).toFixed(3)}ms</div>
                <div class="benchmark-result">í‰ê·  ì¶”ì¶œ: ${(extractTime/1000).toFixed(3)}ms</div>
                <div class="benchmark-result">Map ì¡°íšŒ: ${(mapTime/10000).toFixed(4)}ms (O(1) í™•ì¸)</div>
            `;

            // ì„±ëŠ¥ í‰ê°€
            if (mapTime / 10000 < 0.01) {
                addResult('benchmark-results',
                    'âœ… O(1) Map ì¡°íšŒ ì„±ëŠ¥ í™•ì¸ - ë§¤ìš° ë¹ ë¦„!',
                    'success');
            }
        }

        // 6. AI ë¶„ì„ í…ŒìŠ¤íŠ¸
        async function testAIAnalysis() {
            const results = document.getElementById('ai-results');
            results.innerHTML = '';

            const apiKey = document.getElementById('gemini-api-key').value;
            if (apiKey) {
                localStorage.setItem('geminiApiKey', apiKey);
                window.AIAnalyzer.config.apiKey = apiKey;
                addResult('ai-results', 'ğŸ”‘ API í‚¤ ì„¤ì •ë¨', 'success');
            }

            try {
                // ê°„ë‹¨í•œ AI ë¶„ì„ í…ŒìŠ¤íŠ¸
                const mockHandData = {
                    handNumber: 999,
                    hero: { name: 'Hero', cards: 'AK' },
                    villain: { name: 'Villain', cards: 'QQ' },
                    actions: [{ action: 'Hero raises to 3BB' }, { action: 'Villain 3-bets to 10BB' }],
                    board: 'A K 7 2 9',
                    result: 'Hero wins with two pair'
                };

                // loadHandData ëª¨í‚¹
                window.loadHandData = async () => mockHandData;

                const analysis = await window.AIAnalyzer.analyzeHand(999);

                if (analysis && !analysis.includes('ì˜¤ë¥˜')) {
                    addResult('ai-results',
                        `âœ… AI ë¶„ì„ ì„±ê³µ:<br><pre>${analysis}</pre>`,
                        'success');
                } else {
                    addResult('ai-results',
                        `âš ï¸ AI ë¶„ì„ í´ë°± ì‚¬ìš©: ${analysis}`,
                        'warning');
                }

                // íŒŒì¼ ìš”ì•½ í…ŒìŠ¤íŠ¸
                const summary = await window.AIAnalyzer.generateFileSummary(mockHandData);
                addResult('ai-results',
                    `ğŸ“ AI íŒŒì¼ ìš”ì•½: "${summary}"`,
                    'success');

            } catch (error) {
                addResult('ai-results',
                    `âŒ AI í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`,
                    'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', () => {
            console.log('ğŸš€ ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì¤€ë¹„ ì™„ë£Œ');

            // ìë™ìœ¼ë¡œ ëª¨ë“ˆ ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            setTimeout(() => {
                testModuleLoad();
            }, 500);
        });
    </script>
</body>
</html>
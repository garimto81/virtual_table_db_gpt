<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Table DB - Final Integration v10.5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .metric-card {
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-connected { background-color: #10b981; animation: pulse 2s infinite; }
        .status-connecting { background-color: #f59e0b; animation: blink 1s infinite; }
        .status-disconnected { background-color: #ef4444; }
        .status-offline { background-color: #6b7280; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .data-table {
            font-size: 12px;
        }

        .row-added {
            background-color: rgba(16, 185, 129, 0.2);
            animation: highlight 1s ease-out;
        }

        .row-modified {
            background-color: rgba(59, 130, 246, 0.2);
            animation: highlight 1s ease-out;
        }

        .row-deleted {
            background-color: rgba(239, 68, 68, 0.2);
            animation: slideOut 0.5s ease-out;
        }

        .conflict-indicator {
            background-color: rgba(245, 158, 11, 0.3);
            border-left: 4px solid #f59e0b;
        }

        .offline-banner {
            background: linear-gradient(90deg, #374151, #4b5563);
            border-left: 4px solid #f59e0b;
        }

        @keyframes highlight {
            0% { background-color: rgba(255, 255, 255, 0.3); }
            100% { background-color: transparent; }
        }

        @keyframes slideOut {
            0% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(-100%); }
        }

        .mode-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .mode-websocket { background: #10b981; color: white; }
        .mode-adaptive { background: #3b82f6; color: white; }
        .mode-incremental { background: #8b5cf6; color: white; }
        .mode-checksum { background: #f59e0b; color: white; }
        .mode-legacy { background: #6b7280; color: white; }
        .mode-offline { background: #ef4444; color: white; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- ì˜¤í”„ë¼ì¸ ë°°ë„ˆ -->
    <div id="offline-banner" class="offline-banner p-3 text-center text-sm hidden">
        <span class="status-indicator status-offline"></span>
        <strong>ì˜¤í”„ë¼ì¸ ëª¨ë“œ</strong> - ë¡œì»¬ ìºì‹œ ì‚¬ìš© ì¤‘. <span id="pending-changes">0</span>ê°œ ë³€ê²½ì‚¬í•­ ëŒ€ê¸° ì¤‘
    </div>

    <!-- í—¤ë” -->
    <div class="border-b border-gray-700 p-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold">Virtual Table DB</h1>
                <p class="text-gray-400">Final Integration v10.5.0</p>
            </div>
            <div class="flex items-center space-x-6">
                <!-- ì—°ê²° ìƒíƒœ -->
                <div class="flex items-center space-x-4">
                    <div id="connection-status" class="flex items-center">
                        <span id="connection-indicator" class="status-indicator status-disconnected"></span>
                        <div class="flex flex-col">
                            <span id="connection-text" class="text-sm">ì—°ê²° ì¤‘...</span>
                            <span id="connection-mode" class="mode-badge mode-adaptive">ì ì‘í˜•</span>
                        </div>
                    </div>

                    <!-- ë™ê¸°í™” ìƒíƒœ -->
                    <div id="sync-status" class="flex items-center">
                        <span id="sync-indicator" class="status-indicator status-disconnected"></span>
                        <div class="flex flex-col">
                            <span id="sync-text" class="text-sm">ë™ê¸°í™” ëŒ€ê¸°</span>
                            <span id="sync-latency" class="text-xs text-gray-400">-</span>
                        </div>
                    </div>
                </div>

                <!-- ì œì–´ ë²„íŠ¼ -->
                <div class="flex items-center space-x-2">
                    <button id="force-sync" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm">
                        ê°•ì œ ë™ê¸°í™”
                    </button>
                    <button id="toggle-offline" class="bg-gray-600 hover:bg-gray-700 px-3 py-1 rounded text-sm">
                        ì˜¤í”„ë¼ì¸ ëª¨ë“œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-6">
        <!-- ì‹œìŠ¤í…œ ìƒíƒœ ëŒ€ì‹œë³´ë“œ -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
            <!-- ì—°ê²° ê´€ë¦¬ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸŒ ì—°ê²° ê´€ë¦¬</h3>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm">
                        <span>ì—°ê²° ëª¨ë“œ:</span>
                        <span id="current-mode" class="font-bold">ì ì‘í˜•</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>í´ë§ ê°„ê²©:</span>
                        <span id="polling-interval">10ì´ˆ</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>WebSocket:</span>
                        <span id="websocket-status" class="font-bold text-yellow-400">ì—°ê²° ì¤‘</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>ì˜¤í”„ë¼ì¸ ìºì‹œ:</span>
                        <span id="cache-status" class="font-bold text-green-400">í™œì„±</span>
                    </div>
                </div>
            </div>

            <!-- ì„±ëŠ¥ ë©”íŠ¸ë¦­ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ“Š ì„±ëŠ¥ ë©”íŠ¸ë¦­</h3>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm">
                        <span>ì‘ë‹µ ì‹œê°„:</span>
                        <span id="response-time-avg" class="font-bold text-green-400">15ms</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>ë°ì´í„° ì ˆì•½:</span>
                        <span id="data-savings" class="font-bold text-blue-400">96%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>í´ë§ íš¨ìœ¨:</span>
                        <span id="polling-efficiency" class="font-bold text-purple-400">62%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>ë°°í„°ë¦¬ ì ˆì•½:</span>
                        <span id="battery-savings" class="font-bold text-orange-400">45%</span>
                    </div>
                </div>
            </div>

            <!-- í™œë™ ëª¨ë‹ˆí„° -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ‘¤ ì‚¬ìš©ì í™œë™</h3>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm">
                        <span>í˜„ì¬ ìƒíƒœ:</span>
                        <span id="user-activity-state" class="font-bold text-green-400">í™œì„±</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>í™œë™ ì ìˆ˜:</span>
                        <span id="activity-score">75</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>ìƒíƒœ ë³€ê²½:</span>
                        <span id="state-changes">12</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>ë§ˆì§€ë§‰ í¸ì§‘:</span>
                        <span id="last-edit">2ë¶„ ì „</span>
                    </div>
                </div>
            </div>

            <!-- ë™ê¸°í™” ìƒíƒœ -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ”„ ë™ê¸°í™” ìƒíƒœ</h3>
                <div class="space-y-3">
                    <div class="flex justify-between text-sm">
                        <span>ë§ˆì§€ë§‰ ë™ê¸°í™”:</span>
                        <span id="last-sync">ë°©ê¸ˆ ì „</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>ëŒ€ê¸° ì¤‘ ë³€ê²½:</span>
                        <span id="pending-sync-changes" class="font-bold text-yellow-400">0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>ì¶©ëŒ í•´ê²°:</span>
                        <span id="conflicts-resolved">3</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>ë™ê¸°í™” ì„±ê³µë¥ :</span>
                        <span id="sync-success-rate" class="font-bold text-green-400">98%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ í†µê³„ -->
        <div class="grid grid-cols-2 lg:grid-cols-6 gap-4 mb-6">
            <div class="metric-card bg-gray-800 rounded-lg p-4">
                <div class="text-xs text-gray-400 mb-1">ì´ API í˜¸ì¶œ</div>
                <div id="total-api-calls" class="text-xl font-bold text-blue-400">1,247</div>
            </div>
            <div class="metric-card bg-gray-800 rounded-lg p-4">
                <div class="text-xs text-gray-400 mb-1">ë°ì´í„° ì „ì†¡ëŸ‰</div>
                <div id="total-data-transfer" class="text-xl font-bold text-purple-400">2.8MB</div>
            </div>
            <div class="metric-card bg-gray-800 rounded-lg p-4">
                <div class="text-xs text-gray-400 mb-1">í‰ê·  ì§€ì—°ì‹œê°„</div>
                <div id="average-latency" class="text-xl font-bold text-yellow-400">12ms</div>
            </div>
            <div class="metric-card bg-gray-800 rounded-lg p-4">
                <div class="text-xs text-gray-400 mb-1">ìš´ì˜ ì‹œê°„</div>
                <div id="uptime" class="text-xl font-bold text-green-400">2h 34m</div>
            </div>
            <div class="metric-card bg-gray-800 rounded-lg p-4">
                <div class="text-xs text-gray-400 mb-1">ì˜¤í”„ë¼ì¸ ì‹œê°„</div>
                <div id="offline-time" class="text-xl font-bold text-red-400">0s</div>
            </div>
            <div class="metric-card bg-gray-800 rounded-lg p-4">
                <div class="text-xs text-gray-400 mb-1">íš¨ìœ¨ì„± ì ìˆ˜</div>
                <div id="efficiency-score" class="text-xl font-bold text-cyan-400">A+</div>
            </div>
        </div>

        <!-- ëª¨ë“œ ì„ íƒ ë° ì„¤ì • -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4">âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì •</h3>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ë™ê¸°í™” ëª¨ë“œ</label>
                    <select id="sync-mode" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        <option value="websocket">WebSocket (ì‹¤ì‹œê°„)</option>
                        <option value="adaptive" selected>ì ì‘í˜• í´ë§</option>
                        <option value="incremental">ì¦ë¶„ ì—…ë°ì´íŠ¸</option>
                        <option value="checksum">ì²´í¬ì„¬ ê¸°ë°˜</option>
                        <option value="legacy">ë ˆê±°ì‹œ ëª¨ë“œ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ì¶©ëŒ í•´ê²° ì „ëµ</label>
                    <select id="conflict-resolution" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2">
                        <option value="server-wins" selected>ì„œë²„ ìš°ì„ </option>
                        <option value="client-wins">í´ë¼ì´ì–¸íŠ¸ ìš°ì„ </option>
                        <option value="merge">ìë™ ë³‘í•©</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">ì˜¤í”„ë¼ì¸ ì„¤ì •</label>
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="auto-cache" checked class="mr-2">
                            <span class="text-sm">ìë™ ìºì‹œ</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="auto-sync" checked class="mr-2">
                            <span class="text-sm">ìë™ ë™ê¸°í™”</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë°ì´í„° í…Œì´ë¸” -->
        <div class="bg-gray-800 rounded-lg overflow-hidden">
            <div class="p-4 border-b border-gray-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold">ğŸ—‚ï¸ ë°ì´í„° í…Œì´ë¸”</h3>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-400">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="last-update">ë°©ê¸ˆ ì „</span></span>
                        <div id="update-indicator" class="text-xs px-2 py-1 rounded bg-green-700 text-green-100">
                            ì‹¤ì‹œê°„ ë™ê¸°í™”
                        </div>
                        <span class="text-sm text-gray-400">ì´ <span id="total-rows">0</span>í–‰</span>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full data-table">
                    <thead>
                        <tr class="bg-gray-700 border-b border-gray-600">
                            <th class="p-2 text-left">#</th>
                            <th class="p-2 text-left">A</th>
                            <th class="p-2 text-left">B</th>
                            <th class="p-2 text-left">C</th>
                            <th class="p-2 text-left">D</th>
                            <th class="p-2 text-left">E</th>
                            <th class="p-2 text-left">F</th>
                            <th class="p-2 text-left">G</th>
                            <th class="p-2 text-left">H</th>
                            <th class="p-2 text-left">I</th>
                            <th class="p-2 text-left">J</th>
                            <th class="p-2 text-left">ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody id="data-tbody">
                        <tr>
                            <td colspan="12" class="p-8 text-center text-gray-400">
                                ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="performance_monitor.js"></script>
    <script src="incremental_manager.js"></script>
    <script src="adaptive_polling_manager.js"></script>
    <script src="websocket_manager.js"></script>
    <script src="offline_manager.js"></script>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let performanceMonitor;
        let incrementalManager;
        let adaptivePollingManager;
        let webSocketManager;
        let offlineManager;

        let currentMode = 'adaptive';
        let isInitialized = false;

        // Apps Script URL (ì‹¤ì œ URLë¡œ êµì²´ í•„ìš”)
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Final Integration ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘');

            try {
                await initializeAllSystems();
                setupEventListeners();
                startMetricsUpdate();

                isInitialized = true;
                console.log('âœ… ëª¨ë“  ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');

                // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
                await loadInitialData();

            } catch (error) {
                console.error('âŒ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showErrorNotification('ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ëª¨ë“  ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        async function initializeAllSystems() {
            // 1. ì„±ëŠ¥ ëª¨ë‹ˆí„°
            performanceMonitor = new PerformanceMonitor();

            // 2. ì¦ë¶„ ì—…ë°ì´íŠ¸ ë§¤ë‹ˆì €
            incrementalManager = initializeIncrementalManager(APPS_SCRIPT_URL);

            // 3. ì ì‘í˜• í´ë§ ë§¤ë‹ˆì €
            adaptivePollingManager = initializeAdaptivePolling(incrementalManager);

            // 4. WebSocket ë§¤ë‹ˆì €
            webSocketManager = initializeWebSocketManager(APPS_SCRIPT_URL, adaptivePollingManager);

            // 5. ì˜¤í”„ë¼ì¸ ë§¤ë‹ˆì €
            offlineManager = initializeOfflineManager(incrementalManager);

            console.log('ğŸ“¦ ëª¨ë“  ë§¤ë‹ˆì € ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // ëª¨ë“œ ë³€ê²½
            document.getElementById('sync-mode').addEventListener('change', (e) => {
                switchSyncMode(e.target.value);
            });

            // ì¶©ëŒ í•´ê²° ì „ëµ ë³€ê²½
            document.getElementById('conflict-resolution').addEventListener('change', (e) => {
                setConflictResolution(e.target.value);
            });

            // ê°•ì œ ë™ê¸°í™”
            document.getElementById('force-sync').addEventListener('click', () => {
                forceSync();
            });

            // ì˜¤í”„ë¼ì¸ ëª¨ë“œ í† ê¸€
            document.getElementById('toggle-offline').addEventListener('click', () => {
                toggleOfflineMode();
            });

            // ì‹œìŠ¤í…œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            setupSystemEventListeners();
        }

        // ì‹œìŠ¤í…œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupSystemEventListeners() {
            // WebSocket ì´ë²¤íŠ¸
            if (webSocketManager) {
                webSocketManager.on('connected', () => {
                    updateConnectionStatus('websocket', 'connected');
                });

                webSocketManager.on('disconnected', () => {
                    updateConnectionStatus('websocket', 'disconnected');
                });

                webSocketManager.on('dataReceived', (data) => {
                    handleRealtimeData(data);
                });
            }

            // ì˜¤í”„ë¼ì¸ ë§¤ë‹ˆì € ì´ë²¤íŠ¸
            if (offlineManager) {
                offlineManager.on('offlineMode', (data) => {
                    showOfflineBanner(true, data.pendingChanges);
                });

                offlineManager.on('onlineMode', (data) => {
                    showOfflineBanner(false);
                });

                offlineManager.on('syncCompleted', (data) => {
                    updateSyncStatus(data);
                });
            }

            // ì ì‘í˜• í´ë§ ì´ë²¤íŠ¸
            if (adaptivePollingManager) {
                adaptivePollingManager.on('stateChanged', (data) => {
                    updateActivityState(data.newState);
                });
            }
        }

        // ë™ê¸°í™” ëª¨ë“œ ì „í™˜
        async function switchSyncMode(mode) {
            if (currentMode === mode) return;

            console.log(`ğŸ”„ ë™ê¸°í™” ëª¨ë“œ ì „í™˜: ${currentMode} â†’ ${mode}`);

            // í˜„ì¬ ëª¨ë“œ ì¤‘ì§€
            await stopCurrentMode();

            // ìƒˆ ëª¨ë“œ ì‹œì‘
            await startNewMode(mode);

            currentMode = mode;
            updateModeDisplay(mode);
        }

        // í˜„ì¬ ëª¨ë“œ ì¤‘ì§€
        async function stopCurrentMode() {
            switch (currentMode) {
                case 'websocket':
                    if (webSocketManager) {
                        webSocketManager.disconnect();
                    }
                    break;

                case 'adaptive':
                    if (adaptivePollingManager) {
                        adaptivePollingManager.stopPolling();
                    }
                    break;

                case 'incremental':
                case 'checksum':
                case 'legacy':
                    // ê¸°ë³¸ í´ë§ ì¤‘ì§€
                    if (window.basicPollingTimer) {
                        clearInterval(window.basicPollingTimer);
                    }
                    break;
            }
        }

        // ìƒˆ ëª¨ë“œ ì‹œì‘
        async function startNewMode(mode) {
            switch (mode) {
                case 'websocket':
                    if (webSocketManager) {
                        await webSocketManager.connect();
                    }
                    break;

                case 'adaptive':
                    if (adaptivePollingManager) {
                        adaptivePollingManager.startPolling();
                    }
                    break;

                case 'incremental':
                    startBasicPolling(10000, () => {
                        if (incrementalManager) {
                            incrementalManager.fetchUpdate();
                        }
                    });
                    break;

                case 'checksum':
                case 'legacy':
                    startBasicPolling(10000, () => {
                        console.log(`${mode} í´ë§ ì‹¤í–‰`);
                    });
                    break;
            }
        }

        // ê¸°ë³¸ í´ë§ ì‹œì‘
        function startBasicPolling(interval, callback) {
            window.basicPollingTimer = setInterval(callback, interval);
            console.log(`ê¸°ë³¸ í´ë§ ì‹œì‘: ${interval}ms`);
        }

        // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateConnectionStatus(type, status) {
            const indicator = document.getElementById('connection-indicator');
            const text = document.getElementById('connection-text');
            const mode = document.getElementById('connection-mode');

            switch (status) {
                case 'connected':
                    indicator.className = 'status-indicator status-connected';
                    text.textContent = type === 'websocket' ? 'WebSocket ì—°ê²°ë¨' : 'ì—°ê²°ë¨';
                    break;

                case 'connecting':
                    indicator.className = 'status-indicator status-connecting';
                    text.textContent = 'ì—°ê²° ì¤‘...';
                    break;

                case 'disconnected':
                    indicator.className = 'status-indicator status-disconnected';
                    text.textContent = 'ì—°ê²° í•´ì œë¨';
                    break;
            }

            // ëª¨ë“œ ë°°ì§€ ì—…ë°ì´íŠ¸
            updateModeDisplay(currentMode);
        }

        // ëª¨ë“œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateModeDisplay(mode) {
            const modeElement = document.getElementById('connection-mode');
            const currentModeElement = document.getElementById('current-mode');

            const modeNames = {
                websocket: 'WebSocket',
                adaptive: 'ì ì‘í˜•',
                incremental: 'ì¦ë¶„',
                checksum: 'ì²´í¬ì„¬',
                legacy: 'ë ˆê±°ì‹œ'
            };

            const modeClasses = {
                websocket: 'mode-websocket',
                adaptive: 'mode-adaptive',
                incremental: 'mode-incremental',
                checksum: 'mode-checksum',
                legacy: 'mode-legacy'
            };

            modeElement.className = `mode-badge ${modeClasses[mode]}`;
            modeElement.textContent = modeNames[mode];
            currentModeElement.textContent = modeNames[mode];
        }

        // ì˜¤í”„ë¼ì¸ ë°°ë„ˆ í‘œì‹œ
        function showOfflineBanner(show, pendingChanges = 0) {
            const banner = document.getElementById('offline-banner');
            const pendingElement = document.getElementById('pending-changes');

            if (show) {
                banner.classList.remove('hidden');
                pendingElement.textContent = pendingChanges;
            } else {
                banner.classList.add('hidden');
            }
        }

        // í™œë™ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateActivityState(state) {
            const stateElement = document.getElementById('user-activity-state');
            const stateNames = {
                active: 'í™œì„±',
                normal: 'ì¼ë°˜',
                idle: 'ëŒ€ê¸°',
                background: 'ë°±ê·¸ë¼ìš´ë“œ'
            };

            stateElement.textContent = stateNames[state] || state;
        }

        // ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬
        function handleRealtimeData(data) {
            console.log('ğŸ“¨ ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬:', data.type);

            // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            if (data.type === 'full') {
                updateDataTable(data.data);
            } else if (data.type === 'delta') {
                applyDeltaToTable(data.delta);
            }

            // ì—…ë°ì´íŠ¸ ì¸ë””ì¼€ì´í„°
            updateLastUpdateTime();
        }

        // ë°ì´í„° í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateDataTable(data) {
            const tbody = document.getElementById('data-tbody');
            tbody.innerHTML = '';

            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-700 hover:bg-gray-750';

                tr.innerHTML = `
                    <td class="p-2">${index + 1}</td>
                    ${row.map(cell => `<td class="p-2">${cell || '-'}</td>`).join('')}
                    <td class="p-2">
                        <span class="text-xs px-2 py-1 bg-green-700 rounded">ë™ê¸°í™”ë¨</span>
                    </td>
                `;

                tbody.appendChild(tr);
            });

            document.getElementById('total-rows').textContent = data.length;
        }

        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ ê°±ì‹ 
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            document.getElementById('last-update').textContent = timeString;
        }

        // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
        function updateMetrics() {
            if (!isInitialized) return;

            // ì„±ëŠ¥ ë©”íŠ¸ë¦­
            if (performanceMonitor) {
                const metrics = performanceMonitor.getMetrics();
                document.getElementById('total-api-calls').textContent = metrics.totalRequests;
                document.getElementById('average-latency').textContent = metrics.averageResponseTime.toFixed(0) + 'ms';
            }

            // ì ì‘í˜• í´ë§ í†µê³„
            if (adaptivePollingManager) {
                const stats = adaptivePollingManager.getStats();
                document.getElementById('polling-efficiency').textContent = stats.efficiency;
            }

            // WebSocket í†µê³„
            if (webSocketManager) {
                const stats = webSocketManager.getStats();
                document.getElementById('total-data-transfer').textContent = stats.dataTransferredMB + 'MB';
            }

            // ì˜¤í”„ë¼ì¸ í†µê³„
            if (offlineManager) {
                const stats = offlineManager.getStats();
                document.getElementById('pending-sync-changes').textContent = stats.averageQueueSize;
                document.getElementById('sync-success-rate').textContent = stats.syncSuccessRate;
            }
        }

        // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸ ì‹œì‘
        function startMetricsUpdate() {
            setInterval(updateMetrics, 1000);
        }

        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        async function loadInitialData() {
            console.log('ğŸ“‚ ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹œì‘');

            try {
                // ê¸°ë³¸ ëª¨ë“œë¡œ ì‹œì‘
                await startNewMode(currentMode);

                // í…ŒìŠ¤íŠ¸ ë°ì´í„° í‘œì‹œ
                const testData = [
                    ['ë°ì´í„°1', 'ê°’1', 'íƒ€ì…A', 'ìƒíƒœ1', 'ë©”ëª¨1', '', '', '', '', ''],
                    ['ë°ì´í„°2', 'ê°’2', 'íƒ€ì…B', 'ìƒíƒœ2', 'ë©”ëª¨2', '', '', '', '', ''],
                    ['ë°ì´í„°3', 'ê°’3', 'íƒ€ì…C', 'ìƒíƒœ3', 'ë©”ëª¨3', '', '', '', '', '']
                ];

                updateDataTable(testData);
                updateLastUpdateTime();

            } catch (error) {
                console.error('âŒ ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function forceSync() {
            console.log('ğŸ”„ ê°•ì œ ë™ê¸°í™” ì‹¤í–‰');
            if (offlineManager) {
                offlineManager.forcSync();
            }
        }

        function toggleOfflineMode() {
            console.log('ğŸ“µ ì˜¤í”„ë¼ì¸ ëª¨ë“œ í† ê¸€');
            // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ì‹œë®¬ë ˆì´ì…˜
            if (navigator.onLine) {
                showOfflineBanner(true, 5);
            } else {
                showOfflineBanner(false);
            }
        }

        function setConflictResolution(strategy) {
            console.log(`âš–ï¸ ì¶©ëŒ í•´ê²° ì „ëµ ë³€ê²½: ${strategy}`);
            if (offlineManager) {
                offlineManager.setConflictResolution(strategy);
            }
        }

        function showErrorNotification(message) {
            // ê°„ë‹¨í•œ ì—ëŸ¬ ì•Œë¦¼ (ì‹¤ì œë¡œëŠ” ë” ì •êµí•œ ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬í˜„)
            alert('ì˜¤ë¥˜: ' + message);
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
        window.updateConnectionStatus = updateConnectionStatus;
        window.handleRealtimeData = handleRealtimeData;
        window.updateSyncStatus = updateSyncStatus;
        window.showConflictNotification = showConflictNotification;
        window.updateLatencyMetrics = updateLatencyMetrics;
        window.updateOfflineStatus = updateOfflineStatus;

        // ë¹ˆ í•¨ìˆ˜ë“¤ (ë‚˜ì¤‘ì— êµ¬í˜„)
        function updateSyncStatus(data) {}
        function showConflictNotification(data) {}
        function updateLatencyMetrics(data) {}
        function updateOfflineStatus(isOffline, data) {}
    </script>
</body>
</html>